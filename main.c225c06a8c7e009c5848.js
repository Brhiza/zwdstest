"use strict";(self.webpackChunkreact_iztro=self.webpackChunkreact_iztro||[]).push([[792],{103:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,o){function l(e){try{i(n.next(e))}catch(e){o(e)}}function s(e){try{i(n.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(l,s)}i((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.useHistoryManager=void 0;const r=a(6540),o=a(1977);t.useHistoryManager=()=>{const[e,t]=(0,r.useState)([]),[a,l]=(0,r.useState)(!1),[s,i]=(0,r.useState)(""),[c,u]=(0,r.useState)(!1),[d,m]=(0,r.useState)(""),[f,h]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1),[y,v]=(0,r.useState)(null);(0,r.useEffect)(()=>{n(void 0,void 0,void 0,function*(){o.HistoryManager.initialize();const e=yield o.HistoryManager.getHistoryWithCloudSync();t(e),h(o.HistoryManager.isCloudStorageEnabled())})},[]);const b=(0,r.useCallback)(()=>n(void 0,void 0,void 0,function*(){if(d.trim()){g(!0);try{if(yield o.HistoryManager.enableCloudStorage(d)){h(!0),u(!1),m("");const e=yield o.HistoryManager.getHistoryWithCloudSync();t(e)}else alert("密码错误，请重试")}catch(e){alert("启用云存储失败，请稍后再试")}finally{g(!1)}}}),[d]),E=(0,r.useCallback)(e=>n(void 0,void 0,void 0,function*(){y?(yield o.HistoryManager.updateHistory(y,e),v(null)):yield o.HistoryManager.saveHistory(e),t(o.HistoryManager.getHistory())}),[y]),w=(0,r.useCallback)(e=>n(void 0,void 0,void 0,function*(){yield o.HistoryManager.deleteHistory(e),t(o.HistoryManager.getHistory())}),[]),S=(0,r.useCallback)(()=>n(void 0,void 0,void 0,function*(){f?alert("云存储已启用，无法清空历史记录"):confirm("确定要清空所有历史记录吗？")&&(yield o.HistoryManager.clearHistory(),t([]))}),[f]);return{history:e.filter(e=>{var t;return e.name.toLowerCase().includes(s.toLowerCase())||"synastry"===e.type&&(null===(t=e.person2)||void 0===t?void 0:t.name.toLowerCase().includes(s.toLowerCase()))||`${e.year}-${e.month}-${e.day}`.includes(s)}),showHistoryModal:a,setShowHistoryModal:l,searchTerm:s,setSearchTerm:i,showPasswordInput:c,setShowPasswordInput:u,password:d,setPassword:m,isCloudStorageEnabled:f,isLoading:p,editingHistoryId:y,setEditingHistoryId:v,handlePasswordSubmit:b,handleSaveHistory:E,handleDeleteHistory:w,handleClearHistory:S}}},141:(e,t,a)=>{a.r(t)},206:function(e,t,a){var n,r=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=n(e),l=0;l<a.length;l++)"default"!==a[l]&&r(t,e,a[l]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.useAIChat=t.AIChatProvider=void 0;const s=l(a(6540)),i="aiChatSessions",c=(0,s.createContext)(void 0);t.AIChatProvider=({children:e})=>{const[t,a]=(0,s.useState)([]),[n,r]=(0,s.useState)(null),[o,l]=(0,s.useState)(!1),[u,d]=(0,s.useState)(!1);(0,s.useEffect)(()=>{try{const e=localStorage.getItem(i);if(e){const t=JSON.parse(e);t.length>0&&(a(t),r(t[0].id))}}catch(e){}},[]),(0,s.useEffect)(()=>{try{localStorage.setItem(i,JSON.stringify(t))}catch(e){}},[t]);const m=(0,s.useCallback)(()=>{const e={id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),title:"新的对话",messages:[],createdAt:Date.now()};return a(t=>[e,...t]),r(e.id),e},[]),f=(0,s.useCallback)(e=>{t.some(t=>t.id===e)&&r(e)},[t]),h=(0,s.useCallback)(e=>{a(t=>{const a=t.filter(t=>t.id!==e);return n===e&&r(a.length>0?a[0].id:null),a})},[n]),p=(0,s.useCallback)(()=>{a([]),r(null)},[]),g=(0,s.useCallback)((e,t)=>{a(a=>a.map(a=>a.id===e?Object.assign(Object.assign({},a),{messages:"function"==typeof t?t(a.messages):t}):a))},[]),y=(0,s.useCallback)(e=>{n&&g(n,e)},[n,g]),v=(0,s.useCallback)(e=>{n&&g(n,t=>[...t,e])},[n,g]),b=(0,s.useCallback)(e=>{n&&g(n,t=>{if(0===t.length||"assistant"!==t[t.length-1].role)return t;const a=[...t];return a[a.length-1]=Object.assign(Object.assign({},a[a.length-1]),{content:e}),a})},[n,g]),E=(0,s.useCallback)(()=>{n&&g(n,[])},[n,g]),w=(0,s.useCallback)((e,t)=>{a(a=>a.map(a=>a.id===e?Object.assign(Object.assign({},a),{title:t}):a))},[]),S=(0,s.useMemo)(()=>{var e;return null!==(e=t.find(e=>e.id===n))&&void 0!==e?e:null},[t,n]),O={sessions:t,activeSessionId:n,activeSession:S,isLoading:o,isGeneratingInBackground:u,createSession:m,switchSession:f,deleteSession:h,setMessages:y,addMessage:v,updateLastMessage:b,updateSessionTitle:w,clearMessages:E,clearAllSessions:p,setIsLoading:l,setIsGeneratingInBackground:d};return s.default.createElement(c.Provider,{value:O},e)};t.useAIChat=()=>{const e=(0,s.useContext)(c);if(void 0===e)throw new Error("useAIChat must be used within an AIChatProvider");return e}},471:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__exportStar||function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||n(t,e,a)};Object.defineProperty(t,"__esModule",{value:!0}),r(a(8711),t)},521:function(e,t,a){var n,r=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=n(e),l=0;l<a.length;l++)"default"!==a[l]&&r(t,e,a[l]);return o(t,e),t}),s=this&&this.__rest||function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Izstar=void 0;const c=l(a(6540)),u=i(a(2485)),d=a(8874),m=a(3914),f=a(1887);t.Izstar=e=>{var{horoscopeMutagens:t,activeHeavenlyStem:a,hoverHeavenlyStem:n,palaceHeavenlyStem:r}=e,o=s(e,["horoscopeMutagens","activeHeavenlyStem","hoverHeavenlyStem","palaceHeavenlyStem"]);const l=(0,c.useMemo)(()=>{if(!a)return"";const e=(0,f.getMutagensByHeavenlyStem)((0,m.t)(a)).indexOf(o.name);return e<0?"":`iztro-star-mutagen-${e}`},[a,o.name]),i=(0,c.useMemo)(()=>{if(!n)return"";const e=(0,f.getMutagensByHeavenlyStem)((0,m.t)(n)).indexOf(o.name);return e<0?"":`iztro-star-hover-mutagen-${e}`},[n,o.name]),h=(0,c.useMemo)(()=>{if(!r||a||n)return;const e=(0,f.getMutagensByHeavenlyStem)((0,m.t)(r)).indexOf(o.name);return e<0?"":`iztro-star-self-mutagen-${e}`},[r,a,n]);return c.default.createElement("div",{className:(0,u.default)("iztro-star",`iztro-star-${o.type}`)},c.default.createElement("span",{className:(0,u.default)("star-with-mutagen",l,h,i,{"iztro-star-self-mutagen":!!h})},o.name),c.default.createElement("i",{className:(0,u.default)("iztro-star-brightness")},o.brightness),o.mutagen&&c.default.createElement("span",{className:(0,u.default)("iztro-star-mutagen",`mutagen-${d.MUTAGEN.indexOf((0,m.kot)(o.mutagen))}`)},o.mutagen),null==t?void 0:t.map(e=>{if(e.mutagen.includes(o.name)&&e.show)return c.default.createElement("span",{key:e.scope,className:(0,u.default)("iztro-star-mutagen",`mutagen-${e.scope}`)},(0,m.t)(d.MUTAGEN[e.mutagen.indexOf(o.name)]))}))}},724:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(a(6540));t.default=({type:e="message",count:t=1,animate:a=!0})=>{const n=()=>r.default.createElement("div",{className:"skeleton-message"},r.default.createElement("div",{className:"skeleton-avatar"}),r.default.createElement("div",{className:"skeleton-content"},r.default.createElement("div",{className:"skeleton-line skeleton-short"}),r.default.createElement("div",{className:"skeleton-line"}),r.default.createElement("div",{className:"skeleton-line skeleton-long"}))),o=()=>r.default.createElement("div",{className:"skeleton-chat"},r.default.createElement("div",{className:"skeleton-header"},r.default.createElement("div",{className:"skeleton-title"}),r.default.createElement("div",{className:"skeleton-subtitle"})),r.default.createElement("div",{className:"skeleton-messages"},Array.from({length:3}).map((e,t)=>r.default.createElement("div",{key:t,className:"skeleton-message-wrapper"},r.default.createElement("div",{className:"skeleton-message-avatar"}),r.default.createElement("div",{className:"skeleton-message-content"},r.default.createElement("div",{className:"skeleton-message-line"}),r.default.createElement("div",{className:"skeleton-message-line skeleton-short"}))))),r.default.createElement("div",{className:"skeleton-input"},r.default.createElement("div",{className:"skeleton-input-field"}),r.default.createElement("div",{className:"skeleton-input-button"}))),l=()=>r.default.createElement("div",{className:"skeleton-input-container"},r.default.createElement("div",{className:"skeleton-input-field"}),r.default.createElement("div",{className:"skeleton-input-button"}));return r.default.createElement("div",{className:"skeleton-loader "+(a?"skeleton-animate":"")},(()=>{const a=[];for(let r=0;r<t;r++)switch(e){case"message":default:a.push(n());break;case"chat":a.push(o());break;case"input":a.push(l())}return a})())}},1231:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__exportStar||function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||n(t,e,a)};Object.defineProperty(t,"__esModule",{value:!0}),r(a(4029),t),r(a(2553),t)},1355:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useVirtualScroll=void 0;const n=a(6540);t.useVirtualScroll=(e,t,a={})=>{const{itemHeight:r=80,overscan:o=5,defaultHeight:l=80}=a,[s,i]=(0,n.useState)(0),[c,u]=(0,n.useState)(0),[d,m]=(0,n.useState)(new Map),[f,h]=(0,n.useState)(!1),p=(0,n.useRef)(null),g=(0,n.useMemo)(()=>{let t=0;for(let a=0;a<e.length;a++){const n=e[a],r=d.get(`${n.role}-${a}`);t+=(null==r?void 0:r.height)||l}return t},[e,d,l]),y=(0,n.useMemo)(()=>{let t=0,a=0,n=e.length;for(let n=0;n<e.length;n++){const r=e[n],i=d.get(`${r.role}-${n}`),c=(null==i?void 0:i.height)||l;if(t+c>s){a=Math.max(0,n-o);break}t+=c}let r=t;for(let t=a;t<e.length;t++){const a=e[t],i=d.get(`${a.role}-${t}`),u=(null==i?void 0:i.height)||l;if(r>s+c){n=Math.min(e.length,t+o);break}r+=u}return{startIndex:a,endIndex:n,startOffset:t}},[e,s,c,d,l,o]),v=(0,n.useCallback)((t,a)=>{m(n=>{const r=new Map(n),o=r.get(t);if(!o||o.height!==a){r.set(t,{id:t,height:a,offset:(null==o?void 0:o.offset)||0});let n=0;for(let t=0;t<e.length;t++){const a=`${e[t].role}-${t}`,o=r.get(a);o?(r.set(a,Object.assign(Object.assign({},o),{offset:n})),n+=o.height):n+=l}}return r})},[e,l]),b=(0,n.useCallback)(()=>{t.current&&(i(t.current.scrollTop),h(!0),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{h(!1)},150))},[t]);(0,n.useEffect)(()=>{const e=()=>{t.current&&u(t.current.clientHeight)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e),p.current&&clearTimeout(p.current)}},[t]),(0,n.useEffect)(()=>{const e=t.current;if(e)return e.addEventListener("scroll",b,{passive:!0}),()=>{e.removeEventListener("scroll",b)}},[t,b]);const E=(0,n.useMemo)(()=>{const t=[];let a=0;for(let n=0;n<e.length;n++){const r=e[n],o=d.get(`${r.role}-${n}`),s=(null==o?void 0:o.height)||l;n>=y.startIndex&&n<y.endIndex&&t.push({item:r,index:n,offset:a,height:s}),a+=s}return t},[e,d,y,l]),w=(0,n.useCallback)(a=>{if(t.current){let n=0;for(let t=0;t<a&&t<e.length;t++){const a=d.get(`${e[t].role}-${t}`);n+=(null==a?void 0:a.height)||l}t.current.scrollTo({top:n,behavior:"smooth"})}},[t,e,d,l]),S=(0,n.useCallback)(()=>{t.current&&t.current.scrollTo({top:g,behavior:"smooth"})},[t,g]);return{visibleItems:E,totalHeight:g,isScrolling:f,measureItem:v,scrollToIndex:w,scrollToBottom:S,scrollTop:s}}},1779:function(e,t,a){var n,r=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=n(e),l=0;l<a.length;l++)"default"!==a[l]&&r(t,e,a[l]);return o(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=l(a(6540)),c=s(a(5898)),u=s(a(7314)),d=s(a(724)),m=a(9277),f=a(1355),h=i.default.memo(({messages:e,isLoading:t,generationFailed:a,lastFailedMessage:n,onRegenerate:r,messagesContainerRef:o,lastMessageRef:l,isStreaming:s=!1,useMessageStorage:h=!1,useVirtualScroll:p=!1})=>{const g=h?(0,m.useMessageStorage)({maxMessagesInMemory:200,pageSize:30}):null,{visibleMessages:y=e,isLoading:v=!1,hasMore:b=!1,addMessages:E=()=>{},loadMoreMessages:w=()=>{},resetToLatest:S=()=>{}}=g||{},O=h?y:e,_=p?(0,f.useVirtualScroll)(O,o,{itemHeight:80,overscan:3,defaultHeight:80}):null,{visibleItems:C=[],totalHeight:k=0,isScrolling:N=!1,measureItem:M=()=>{},scrollToIndex:j=()=>{},scrollToBottom:P=()=>{}}=_||{};(0,i.useEffect)(()=>{if(h&&e.length>0){const t=y[y.length-1]?e.filter(e=>!y.some(t=>t.role===e.role&&t.content===e.content)):e;t.length>0&&E(t)}},[e,y,h,E]);const T=(0,i.useRef)(null);(0,i.useEffect)(()=>{if(!h||!b||v)return;const e=new IntersectionObserver(e=>{e[0].isIntersecting&&w()},{root:o.current,threshold:.1,rootMargin:"100px"});return T.current&&e.observe(T.current),()=>{T.current&&e.unobserve(T.current)}},[h,b,v,w,o]),(0,i.useEffect)(()=>{!N&&O.length>0&&P()},[O.length,N,P]);const D=(0,i.useMemo)(()=>p?C.map(({item:e,index:t,offset:n,height:o})=>{const u=O.indexOf(e),d=u===O.length-1;return i.default.createElement("div",{key:`${e.role}-${u}-${e.content.slice(0,20)}`,className:"message-item-container",style:{position:"absolute",top:n,left:0,right:0,height:o||"auto"},ref:t=>{if(t){const a=t.getBoundingClientRect().height;M(`${e.role}-${u}`,a)}}},i.default.createElement(c.default,{message:e,isLastMessage:d,showRegenerate:a&&"assistant"===e.role&&d,onRegenerate:r,messageRef:d?l:void 0,isStreaming:s&&d&&"assistant"===e.role,showActions:"assistant"===e.role&&d&&!s}))}):O.map((e,t)=>{const n=t===O.length-1;return i.default.createElement(c.default,{key:`${e.role}-${t}-${e.content.slice(0,20)}`,message:e,isLastMessage:n,showRegenerate:a&&"assistant"===e.role&&n,onRegenerate:r,messageRef:n?l:void 0,isStreaming:s&&n&&"assistant"===e.role,showActions:"assistant"===e.role&&n&&!s})}),[O,C,p,t,a,s,r,l,M]);return i.default.createElement("div",{ref:o,className:"chat-messages"},p&&i.default.createElement("div",{className:"virtual-scroll-container"},D),!p&&i.default.createElement(i.default.Fragment,null,h&&b&&i.default.createElement("div",{ref:T,className:"load-more-trigger"},v?"加载中...":"向上滚动加载更多消息"),D),t&&i.default.createElement("div",{className:"message assistant-message"},i.default.createElement(u.default,null)),(v||t&&0===O.length)&&i.default.createElement("div",{className:"chat-skeleton-fallback"},i.default.createElement(d.default,{type:"message",count:3,animate:!0})),i.default.createElement("div",{ref:l,className:"bottom-observer"}))});t.default=h},1920:function(e,t,a){var n,r=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=n(e),l=0;l<a.length;l++)"default"!==a[l]&&r(t,e,a[l]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0});const s=l(a(6540));a(141),a(3186);const i=(0,s.lazy)(()=>Promise.resolve().then(()=>l(a(3865)))),c=(0,s.lazy)(()=>Promise.resolve().then(()=>l(a(724)))),u=()=>s.default.createElement("div",{className:"chat-loading-fallback"},s.default.createElement("div",null,"加载中...")),d=()=>s.default.createElement("div",{className:"chat-skeleton-fallback"},s.default.createElement(s.Suspense,{fallback:s.default.createElement(u,null)},s.default.createElement(c,{type:"chat",animate:!0})));t.default=s.default.memo(({formData:e,astrolabe:t,synastryAstrolabe:a,isSynastryMode:n=!1,personNames:r={person1:"第一个人",person2:"第二个人"},isVisible:o=!0})=>{const[l,c]=(0,s.useState)(o);return(0,s.useEffect)(()=>{o&&requestAnimationFrame(()=>{c(!0)})},[o]),o?s.default.createElement(s.Suspense,{fallback:s.default.createElement(d,null)},l&&s.default.createElement(i,{formData:e,astrolabe:t,synastryAstrolabe:a,isSynastryMode:n,personNames:r,isVisible:o})):null})},1974:function(e,t,a){var n,r=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=n(e),l=0;l<a.length;l++)"default"!==a[l]&&r(t,e,a[l]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0});const s=l(a(6540)),i=a(206);a(4498);t.default=({onSelectSession:e})=>{const{sessions:t,activeSessionId:a,switchSession:n,deleteSession:r,updateSessionTitle:o,clearAllSessions:l}=(0,i.useAIChat)(),[c,u]=(0,s.useState)(null),[d,m]=(0,s.useState)(""),f=e=>{m(e.target.value)},h=()=>{c&&d.trim()&&o(c,d.trim()),u(null),m("")},p=e=>{"Enter"===e.key?h():"Escape"===e.key&&(u(null),m(""))};return 0===t.length?s.default.createElement("div",{className:"history-panel empty-state"},s.default.createElement("p",null,"还没有历史记录"),s.default.createElement("span",null,"开始一段新的对话吧！")):s.default.createElement("div",{className:"history-panel"},s.default.createElement("ul",{className:"history-list"},t.map(t=>s.default.createElement("li",{key:t.id,className:"history-item "+(t.id===a?"active":""),onClick:()=>{return a=t.id,n(a),void e(a);var a}},s.default.createElement("div",{className:"history-item-content"},s.default.createElement("div",{className:"history-item-main"},c===t.id?s.default.createElement("input",{type:"text",value:d,onChange:f,onBlur:h,onKeyDown:p,className:"history-item-title-input",autoFocus:!0,onClick:e=>e.stopPropagation()}):s.default.createElement(s.default.Fragment,null,s.default.createElement("p",{className:"history-item-title"},t.title),s.default.createElement("span",{className:"history-item-date"},new Date(t.createdAt).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}))))),s.default.createElement("div",{className:"history-item-actions"},s.default.createElement("button",{className:"history-action-button history-edit-icon",onClick:e=>((e,t)=>{e.stopPropagation(),u(t.id),m(t.title)})(e,t),"aria-label":"编辑标题"},s.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},s.default.createElement("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),s.default.createElement("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"}))),s.default.createElement("button",{className:"history-action-button history-item-delete",onClick:e=>((e,t)=>{e.stopPropagation(),window.confirm("您确定要删除这条记录吗？")&&r(t)})(e,t.id),"aria-label":"删除记录"},s.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},s.default.createElement("polyline",{points:"3 6 5 6 21 6"}),s.default.createElement("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),s.default.createElement("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),s.default.createElement("line",{x1:"14",y1:"11",x2:"14",y2:"17"}))))))),t.length>0&&s.default.createElement("div",{className:"history-panel-footer"},s.default.createElement("button",{className:"history-clear-button",onClick:()=>{window.confirm("您确定要清空所有历史记录吗？此操作不可恢复。")&&l()}},"清空所有记录")))}},1977:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,o){function l(e){try{i(n.next(e))}catch(e){o(e)}}function s(e){try{i(n.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(l,s)}i((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryManager=void 0;const r=a(4930);class o{static initialize(){r.CloudStorageService.initialize(),this.isCloudEnabled=r.CloudStorageService.isAuth()}static enableCloudStorage(e){return n(this,void 0,void 0,function*(){try{return!!(yield r.CloudStorageService.authenticate(e))&&(this.isCloudEnabled=!0,!0)}catch(e){return!1}})}static isCloudStorageEnabled(){return this.isCloudEnabled=r.CloudStorageService.isAuth(),this.isCloudEnabled}static disableCloudStorage(){this.isCloudEnabled=!1,r.CloudStorageService.clearAuthentication()}static loadHistoryFromCloud(){return n(this,void 0,void 0,function*(){if(this.isCloudStorageEnabled())try{const e=yield r.CloudStorageService.getHistoryIds();if(0===e.length)return;const t=yield r.CloudStorageService.batchDownloadHistoryItems(e);t.forEach((e,t)=>{});const a=this.getHistory(),n=this.mergeHistories(a,t);n.length>50&&n.splice(50),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n))}catch(e){}})}static saveHistoryToCloud(){return n(this,void 0,void 0,function*(){if(this.isCloudEnabled)try{const e=this.getHistory();for(const t of e)yield r.CloudStorageService.uploadHistoryItem(t)}catch(e){}})}static mergeHistories(e,t){const a=new Map;t.forEach(e=>{a.set(e.id,e)}),e.forEach(e=>{const t=a.get(e.id);t?e.timestamp>t.timestamp&&a.set(e.id,e):a.set(e.id,e)});return Array.from(a.values()).sort((e,t)=>t.timestamp-e.timestamp)}static saveHistory(e){return n(this,void 0,void 0,function*(){try{const t=this.getHistory(),a=Object.assign(Object.assign({},e),{id:this.generateId(),timestamp:Date.now()});t.unshift(a),t.length>50&&t.splice(50),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t)),this.isCloudStorageEnabled()&&(yield r.CloudStorageService.uploadHistoryItem(a))}catch(e){}})}static getHistory(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):[]}catch(e){return[]}}static getHistoryWithCloudSync(){return n(this,void 0,void 0,function*(){this.isCloudStorageEnabled()&&(yield this.loadHistoryFromCloud());return this.getHistory()})}static updateHistory(e,t){return n(this,void 0,void 0,function*(){try{const a=this.getHistory(),n=a.findIndex(t=>t.id===e);if(-1===n)return;a[n]=Object.assign(Object.assign({},t),{id:e,timestamp:a[n].timestamp}),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(a)),this.isCloudStorageEnabled()&&(yield r.CloudStorageService.deleteHistoryItem(e),yield r.CloudStorageService.uploadHistoryItem(a[n]))}catch(e){}})}static deleteHistory(e){return n(this,void 0,void 0,function*(){try{const t=this.getHistory().filter(t=>t.id!==e);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t)),this.isCloudStorageEnabled()&&(yield r.CloudStorageService.deleteHistoryItem(e))}catch(e){}})}static clearHistory(){return n(this,void 0,void 0,function*(){try{localStorage.removeItem(this.STORAGE_KEY),this.isCloudStorageEnabled()&&(yield r.CloudStorageService.clearAllHistory())}catch(e){}})}static generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}static formatDate(e){const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`}}t.HistoryManager=o,o.STORAGE_KEY="iztro_history",o.isCloudEnabled=!1},2113:function(e,t,a){var n,r=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=n(e),l=0;l<a.length;l++)"default"!==a[l]&&r(t,e,a[l]);return o(t,e),t}),s=this&&this.__rest||function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=l(a(6540)),u=i(a(2826)),d=i(a(5625)),m=i(a(3940)),f=e=>{var{src:t,alt:a,className:n="markdown-img"}=e,r=s(e,["src","alt","className"]);const[o,l]=(0,c.useState)(!1),[i,u]=(0,c.useState)(!1),d=(0,c.useRef)(null);(0,c.useEffect)(()=>{const e=new IntersectionObserver(([t])=>{t.isIntersecting&&(u(!0),e.disconnect())},{rootMargin:"100px",threshold:.1});return d.current&&e.observe(d.current),()=>{d.current&&e.unobserve(d.current)}},[]);return c.default.createElement("div",{className:"markdown-img-container"},!o&&c.default.createElement("div",{className:"markdown-img-placeholder"},c.default.createElement("div",{className:"loading-spinner"})),c.default.createElement("img",Object.assign({ref:d,src:i?t:void 0,alt:a,className:`${n} ${o?"loaded":""}`,onLoad:()=>{l(!0)}},r)))};t.default=c.default.memo(({content:e})=>{const t=(0,c.useMemo)(()=>e.replace(/\n{3,}/g,"\n\n").replace(/^[\s─]*─{3,}[\s─]*$/gm,"\n\n---\n\n").replace(/^\s+|\s+$/g,""),[e]),a=(0,c.useMemo)(()=>({h1:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("h1",Object.assign({className:"markdown-h1"},a),t)},h2:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("h2",Object.assign({className:"markdown-h2"},a),t)},h3:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("h3",Object.assign({className:"markdown-h3"},a),t)},h4:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("h4",Object.assign({className:"markdown-h4"},a),t)},h5:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("h5",Object.assign({className:"markdown-h5"},a),t)},h6:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("h6",Object.assign({className:"markdown-h6"},a),t)},p:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("p",Object.assign({className:"markdown-p"},a),t)},ul:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("ul",Object.assign({className:"markdown-ul"},a),t)},ol:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("ol",Object.assign({className:"markdown-ol"},a),t)},li:e=>{var{children:t}=e,a=s(e,["children"]);const n=c.default.Children.toArray(t).some(e=>c.default.isValidElement(e)&&"input"===e.type);return c.default.createElement("li",Object.assign({className:"markdown-li "+(n?"task-list-item":"")},a),t)},a:e=>{var{href:t,children:a}=e,n=s(e,["href","children"]);return c.default.createElement("a",Object.assign({href:t,className:"markdown-a",target:"_blank",rel:"noopener noreferrer"},n),a)},code:e=>{const{inline:t,className:a,children:n}=e,r=s(e,["inline","className","children"]),o=/language-(\w+)/.exec(a||""),l=o?o[1]:"";return!t&&o?c.default.createElement("div",{className:"markdown-code-wrapper"},c.default.createElement("div",{className:"markdown-code-header"},c.default.createElement("span",{className:"markdown-code-language"},l)),c.default.createElement("code",Object.assign({className:`markdown-code-block ${a}`},r),n)):c.default.createElement("code",Object.assign({className:"markdown-code-inline"},r),n)},pre:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("pre",Object.assign({className:"markdown-pre"},a),t)},blockquote:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("blockquote",Object.assign({className:"markdown-blockquote"},a),t)},table:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("div",{className:"markdown-table-wrapper"},c.default.createElement("table",Object.assign({className:"markdown-table"},a),t))},thead:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("thead",Object.assign({className:"markdown-thead"},a),t)},tbody:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("tbody",Object.assign({className:"markdown-tbody"},a),t)},tr:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("tr",Object.assign({className:"markdown-tr"},a),t)},th:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("th",Object.assign({className:"markdown-th"},a),t)},td:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("td",Object.assign({className:"markdown-td"},a),t)},strong:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("strong",Object.assign({className:"markdown-strong"},a),t)},em:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("em",Object.assign({className:"markdown-em"},a),t)},hr:e=>{var t=s(e,[]);return c.default.createElement("hr",Object.assign({className:"markdown-hr"},t))},img:e=>{var{src:t,alt:a}=e,n=s(e,["src","alt"]);return c.default.createElement(f,Object.assign({src:t,alt:a||""},n))},del:e=>{var{children:t}=e,a=s(e,["children"]);return c.default.createElement("del",Object.assign({className:"markdown-del"},a),t)},input:e=>{var{checked:t,type:a}=e,n=s(e,["checked","type"]);return c.default.createElement("input",Object.assign({type:"checkbox",checked:t,readOnly:!0,className:"markdown-task-checkbox"},n))}}),[]),n=(0,c.useMemo)(()=>c.default.createElement(u.default,{remarkPlugins:[d.default,m.default],rehypePlugins:[],components:a},t),[t,a]);return c.default.createElement("div",{className:"markdown-content"},n)})},2383:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getLastUserMessage=t.filterValidMessages=t.isValidMessage=t.createErrorMessage=t.processRemainingBuffer=t.processStreamChunk=t.buildAIMessages=t.buildSystemPrompt=t.formatAstrolabeForSynastry=void 0;const n=a(6133);t.formatAstrolabeForSynastry=(e,t=new Date)=>{if(!e)return"暂无星盘数据";let a=`\n=== 紫微斗数星盘数据（精简版）===\n当前时间：${t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}\n\n基本信息：\n性别：${"male"===e.gender?"男":"女"}\n阳历日期：${e.solarDate}\n干支纪年：${e.chineseDate}\n出生时辰：${e.time}\n命宫地支：${e.earthlyBranchOfSoulPalace}\n身宫地支：${e.earthlyBranchOfBodyPalace}\n命主：${e.soul}\n身主：${e.body}\n五行局：${e.fiveElementsClass}\n\n关键宫位信息：\n`;const n=["命宫","身宫","夫妻宫","事业宫","财帛宫"];if(e.palaces&&e.palaces.length>0&&e.palaces.forEach(e=>{var t,r;if(n.includes(e.name)){const n=(null===(t=e.majorStars)||void 0===t?void 0:t.map(e=>e.name))||[],o=(null===(r=e.minorStars)||void 0===r?void 0:r.map(e=>e.name))||[];a+=`\n${e.name}：\n天干地支：${e.heavenlyStem}${e.earthlyBranch}\n主星：${n.join("、")||"无"}\n辅星：${o.join("、")||"无"}\n`}}),e.horoscope){const t=e.horoscope();t&&(a+=`\n当前运限：\n大限：${t.decadal.heavenlyStem}${t.decadal.earthlyBranch}\n流年：${t.yearly.heavenlyStem}${t.yearly.earthlyBranch}\n`)}return a.trim()};t.buildSystemPrompt=(e,a,r,o,l)=>{const s=new Date,i="你是一位精通古法传承与现代应用的紫微斗数宗师。你的论断不仅基于星盘数据，更融入了深刻的人生智慧。请牢记以下心法：\n1. **天人合一**：星盘是人生命运的蓝图，但人的意志和后天努力同样重要。你的解读应充满智慧和慈悲，旨在帮助问询者“知命而用命”，而非宿命论。\n2. **言必有据**：所有的论断都必须严格依据所提供的星盘数据，结合宫、星、四化进行严谨的逻辑推演。\n3. **结构清晰**：回答应有章法，先有“总论”概括全局，再“分项”详述，最后必须落脚于“建议”，为问询者提供具体、可行的趋吉避凶之道。\n4. **口吻沉稳**：以一位学识渊博、洞察世事的长者口吻进行叙述，语言简练、沉稳、富有哲理。\n\n";if(o&&r){const e=(0,t.formatAstrolabeForSynastry)(r,s),n=(0,t.formatAstrolabeForSynastry)(a,s);return i+`现在，请根据以下两个人的星盘数据，为他们进行专业的“合盘”论断。\n\n第一个人（${l.person1}）的星盘数据：\n${n}\n\n第二个人（${l.person2}）的星盘数据：\n${e}\n\n请运用你的全部学识，特别是“宫位互叠”与“飞星四化”等高级技法，深度剖析二人的缘分本质、互动模式与潜在的共业。你的分析需直指核心，点明关系中的关键，并提供维系与发展的智慧建议。`}{const t="male"===(null==e?void 0:e.gender)?"男":"女";return i+`现在，请根据以下用户的星盘数据和当前时间，结合他/她的问题，进行专业的“命盘”解读。\n\n${a?(0,n.formatAstrolabeForAI)(a,s,t):"暂无星盘数据"}\n\n请运用你的全部学识，洞察星盘背后的天机，为问询者指点迷津。`}};t.buildAIMessages=(e,t,a)=>[{role:"system",content:e},...t,{role:a.role,content:a.content}];t.processStreamChunk=(e,t,a)=>{let n="",r=t+e;const o=r.split("\n");r=o.pop()||"";for(const e of o)if(e.startsWith("data: ")){const t=e.slice(6).trim();if("[DONE]"===t)continue;if(!t)continue;try{if(t.startsWith("{")&&t.endsWith("}")){const e=JSON.parse(t);if(e.choices&&e.choices[0].delta&&e.choices[0].delta.content){const t=e.choices[0].delta.content;n+=t,a(t)}}}catch(e){}}return{newBuffer:r,assistantMessage:n}};t.processRemainingBuffer=(e,t)=>{let a="";if(e.trim()){const n=e.split("\n");let r="";for(const e of n)if(e.startsWith("data: ")){const n=e.slice(6).trim();if(n&&"[DONE]"!==n)try{if(n.startsWith("{")&&n.endsWith("}")){const e=JSON.parse(n);if(e.choices&&e.choices[0].delta&&e.choices[0].delta.content){const n=e.choices[0].delta.content;a+=n,t(n)}}}catch(e){}}return r}return e};t.createErrorMessage=e=>({role:"assistant",content:"抱歉，我在处理您的消息时遇到了问题。请稍后再试。"});t.isValidMessage=e=>e&&"string"==typeof e.role&&["user","assistant"].includes(e.role)&&"string"==typeof e.content&&e.content.trim().length>0;t.filterValidMessages=e=>e.filter(t.isValidMessage);t.getLastUserMessage=e=>{const a=(0,t.filterValidMessages)(e);for(let e=a.length-1;e>=0;e--)if("user"===a[e].role)return a[e];return null}},2553:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},2702:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(a(6540));t.default=({quickActions:e,onQuickActionClick:t,isLoading:a})=>r.default.createElement("div",{className:"quick-actions-container"},r.default.createElement("div",{className:"quick-actions"},e.map(e=>r.default.createElement("button",{key:e.id,className:"quick-action-button",onClick:()=>t(e.name,e.prompt),disabled:a},e.name))))},3179:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useVirtualKeyboard=void 0;const n=a(6540),r=a(4396);t.useVirtualKeyboard=()=>{const[e,t]=(0,n.useState)({isVisible:!1,height:0}),a=(0,n.useRef)((0,r.isMobileDevice)()),o=(0,n.useRef)((0,r.isAndroidDevice)()),l=(0,n.useRef)((0,r.getAndroidNavigationBarHeight)()),s=(0,n.useRef)(null),i=(0,n.useCallback)(e=>{const a=e.keyboardHeight>0;if(t(t=>t.isVisible!==a||t.height!==e.keyboardHeight?{isVisible:a,height:e.keyboardHeight}:t),document.documentElement.style.setProperty("--keyboard-height",`${e.keyboardHeight}px`),o.current){const e=(0,r.getAndroidNavigationBarHeight)();l.current=e,document.documentElement.style.setProperty("--android-navigation-bar-height",`${e}px`)}},[]),c=(0,n.useCallback)((0,r.throttle)(()=>{var e;if(!a.current)return;const t=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-area-inset-top"))||0,n=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-area-inset-bottom"))||0;let l=0;if(o.current){const t=(null===(e=window.visualViewport)||void 0===e?void 0:e.height)||window.innerHeight,a=window.screen.height,n=window.innerHeight,o=(0,r.getAndroidNavigationBarHeight)();t<.8*n&&(l=n-t-o),l=Math.max(0,Math.min(l,.5*a))}else l=(0,r.getKeyboardHeight)({isMobile:!0,headerHeight:60,keyboardHeight:0,safeAreaTop:t,safeAreaBottom:n});i({keyboardHeight:l})},200),[i]),u=(0,n.useCallback)(()=>{a.current&&setTimeout(c,300)},[c]),d=(0,n.useCallback)(()=>{a.current&&setTimeout(()=>{i({keyboardHeight:0})},100)},[i]),m=(0,n.useCallback)(e=>{if(e&&a.current)return e.addEventListener("focus",u),e.addEventListener("blur",d),()=>{e.removeEventListener("focus",u),e.removeEventListener("blur",d)}},[u,d]);return(0,n.useEffect)(()=>{if(a.current)return window.visualViewport?window.visualViewport.addEventListener("resize",c):window.addEventListener("resize",c),s.current=new ResizeObserver((0,r.debounce)(c,200)),s.current.observe(document.documentElement),c(),()=>{window.visualViewport?window.visualViewport.removeEventListener("resize",c):window.removeEventListener("resize",c),s.current&&s.current.disconnect()}},[c]),(0,n.useEffect)(()=>{e.isVisible?document.body.classList.add("keyboard-visible"):document.body.classList.remove("keyboard-visible")},[e.isVisible]),(0,n.useEffect)(()=>{if(o.current){document.body.classList.add("android-device");const e=(0,r.getAndroidNavigationBarHeight)();l.current=e,document.documentElement.style.setProperty("--android-navigation-bar-height",`${e}px`)}else document.body.classList.remove("android-device")},[]),{keyboardState:e,setupInputListeners:m,hideKeyboard:()=>i({keyboardHeight:0})}}},3186:(e,t,a)=>{a.r(t)},3865:function(e,t,a){var n,r=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=n(e),l=0;l<a.length;l++)"default"!==a[l]&&r(t,e,a[l]);return o(t,e),t}),s=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,o){function l(e){try{i(n.next(e))}catch(e){o(e)}}function s(e){try{i(n.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(l,s)}i((n=n.apply(e,t||[])).next())})},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=l(a(6540)),u=a(206),d=a(3919),m=a(3179),f=a(3962),h=a(7761),p=i(a(1779)),g=i(a(4716)),y=i(a(2702)),v=i(a(5539)),b=i(a(724)),E=i(a(8925)),w=c.default.memo(({formData:e,astrolabe:t,synastryAstrolabe:n,isSynastryMode:r=!1,personNames:o={person1:"第一个人",person2:"第二个人"},isVisible:i=!0})=>{const{activeSession:w,setMessages:S,isLoading:O,setIsLoading:_,updateLastMessage:C,updateSessionTitle:k}=(0,u.useAIChat)(),N=(0,c.useMemo)(()=>{var e;return null!==(e=null==w?void 0:w.messages)&&void 0!==e?e:[]},[w]),[M,j]=(0,c.useState)(""),[P,T]=(0,c.useState)(!1),[D,x]=(0,c.useState)(!1),[H,I]=(0,c.useState)(!1),[$,A]=(0,c.useState)(!1),[L,R]=(0,c.useState)(""),[z,B]=(0,c.useState)("感情"),q=c.default.useRef(null),[V,F]=(0,c.useState)([]),[U,W]=(0,c.useState)([]),[K,Y]=(0,c.useState)([]),[G,J]=(0,c.useState)(!1),{messagesContainerRef:Q,lastMessageRef:X,userScrolledUp:Z,setUserScrolledUp:ee,scrollToBottom:te}=(0,d.useMessageScroll)(N,i,H),{keyboardState:ae,setupInputListeners:ne}=(0,m.useVirtualKeyboard)(),{getContainerStyle:re,getMessagesContainerStyle:oe,getInputContainerStyle:le}=(0,h.useChatLayout)(),{sendMessage:se,regenerateResponse:ie,stopGeneration:ce}=(0,f.useAIChatService)({formData:e,astrolabe:t,synastryAstrolabe:n,isSynastryMode:r,personNames:o,onMessageUpdate:C,onMessagesChange:S,onLoadingChange:_,onGeneratingChange:x,onStreamingChange:I,onError:(e,t)=>{A(e),t&&R(t)}});(0,c.useEffect)(()=>{if(w&&"新的对话"===w.title&&w.messages.length>=2&&"user"===w.messages[0].role){const e=w.messages[0].content.substring(0,20);k(w.id,e)}},[w,k]),(0,c.useEffect)(()=>{s(void 0,void 0,void 0,function*(){try{const{quickActions:e,synastryQuickActions:t,questionCategories:n}=yield Promise.resolve().then(()=>l(a(4013)));F(e),W(t),Y(n),J(!0)}catch(e){J(!0)}})},[]),(0,c.useEffect)(()=>{ae.isVisible&&P&&T(!1)},[ae.isVisible,P]);const ue=(0,c.useCallback)(e=>s(void 0,void 0,void 0,function*(){if(!e.trim()||O)return;const t={role:"user",content:e},a=[...N,t];S(a),j(""),A(!1),R(e),T(!1),yield se(t,a)}),[O,N,se,S]),de=(0,c.useCallback)((e,t)=>s(void 0,void 0,void 0,function*(){if(!e.trim()||O)return;const a={role:"user",content:e},n=[...N,a];S(n),j(""),A(!1),R(e),T(!1),yield se(Object.assign(Object.assign({},a),{content:t}),n)}),[O,N,se,S]),me=(0,c.useCallback)(e=>{ue(e)},[ue]),fe=(0,c.useCallback)(e=>{e.preventDefault(),ue(M)},[ue,M]),he=(0,c.useCallback)(()=>{T(!P)},[P]),pe=(0,c.useCallback)(()=>s(void 0,void 0,void 0,function*(){L.trim()&&(A(!1),yield ie(L,N))}),[L,N,ie]);(0,c.useCallback)(()=>{P&&T(!1)},[P]);return i?c.default.createElement("div",{className:"ai-chat "+(i?"visible":"hidden")},c.default.createElement(p.default,{messages:N,isLoading:O,generationFailed:$,lastFailedMessage:L,onRegenerate:pe,messagesContainerRef:Q,lastMessageRef:X,isStreaming:H}),c.default.createElement("div",{className:"chat-input-container",onClick:e=>e.stopPropagation()},G?c.default.createElement(c.default.Fragment,null,c.default.createElement(y.default,{quickActions:r?U:V,onQuickActionClick:de,isLoading:O}),c.default.createElement(g.default,{inputValue:M,onInputChange:j,onSubmit:fe,onToggleQuestionPanel:he,onStopGeneration:ce,isGenerating:D,isLoading:O,showQuestionPanel:P,inputRef:q,setupInputListeners:ne}),c.default.createElement(v.default,{questionCategories:K,activeQuestionTab:z,onTabChange:B,onQuestionClick:me,showQuestionPanel:P})):c.default.createElement("div",{className:"chat-skeleton-fallback"},c.default.createElement(b.default,{type:"input",animate:!0}))),c.default.createElement(E.default,{isVisible:Z&&(H||O),onClick:()=>{te(!0),ee(!1)}})):null});t.default=w},3900:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(a(6540)),o=n(a(5338)),l=n(a(8577));o.default.createRoot(document.getElementById("root")).render(r.default.createElement(r.default.StrictMode,null,r.default.createElement(l.default,null))),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(e=>{}).catch(e=>{})})},3919:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useMessageScroll=void 0;const n=a(6540);t.useMessageScroll=(e,t,a=!1)=>{const[r,o]=(0,n.useState)(!1),[l,s]=(0,n.useState)(!1),i=(0,n.useRef)(null),c=(0,n.useRef)(null),u=(0,n.useRef)(null),d=(0,n.useRef)(null),m=(0,n.useRef)(null),f=(0,n.useCallback)(()=>{const e=i.current;if(!e)return!0;const{scrollTop:t,scrollHeight:a,clientHeight:n}=e;return a-t<=n+100},[]),h=(0,n.useCallback)((e=!1)=>{if(!t)return;if((l||r)&&!e)return;const a=i.current;a&&requestAnimationFrame(()=>{a.scrollTo({top:a.scrollHeight,behavior:e?"auto":"smooth"}),e&&setTimeout(()=>{a.scrollTo({top:a.scrollHeight,behavior:"auto"})},50)})},[t,r,l]),p=(0,n.useCallback)(()=>{d.current&&clearTimeout(d.current),m.current&&clearTimeout(m.current),s(!0),d.current=setTimeout(()=>{const e=f();o(!e),m.current=setTimeout(()=>{s(!1)},1500)},150)},[f]);(0,n.useEffect)(()=>{if(t)return u.current=new IntersectionObserver(([e])=>{e.isIntersecting&&(o(!1),s(!1))},{root:i.current,threshold:.1}),c.current&&u.current.observe(c.current),()=>{u.current&&u.current.disconnect()}},[t,e.length]),(0,n.useEffect)(()=>{const e=i.current;if(e&&t)return e.addEventListener("scroll",p,{passive:!0}),()=>{e.removeEventListener("scroll",p),d.current&&clearTimeout(d.current),m.current&&clearTimeout(m.current)}},[t,p]),(0,n.useEffect)(()=>{if(0===e.length)return;"user"===e[e.length-1].role?(o(!1),s(!1),setTimeout(()=>h(!0),100)):r||l||h()},[e,r,l,h]),(0,n.useEffect)(()=>{!t||r||l||h()},[t,r,l,h]),(0,n.useEffect)(()=>{a||s(!1)},[a]);const g=(0,n.useCallback)(()=>{o(!1),s(!1),h(!0)},[h]);return{messagesContainerRef:i,lastMessageRef:c,userScrolledUp:r,setUserScrolledUp:o,scrollToBottom:h,resetScrollState:g}}},3957:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AIChat=void 0;var r=a(1920);Object.defineProperty(t,"AIChat",{enumerable:!0,get:function(){return n(r).default}})},3962:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,o){function l(e){try{i(n.next(e))}catch(e){o(e)}}function s(e){try{i(n.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(l,s)}i((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.useAIChatService=void 0;const r=a(6540),o=a(2383),l=a(7362);t.useAIChatService=({formData:e,astrolabe:t,synastryAstrolabe:a,isSynastryMode:s=!1,personNames:i={person1:"第一个人",person2:"第二个人"},onMessageUpdate:c,onMessagesChange:u,onLoadingChange:d,onGeneratingChange:m,onStreamingChange:f,onError:h})=>{const[p,g]=(0,r.useState)(!1),y=(0,r.useRef)(null),{sendChatRequest:v,isLoading:b,error:E}=(0,l.useAIChatRequest)(),w=(0,r.useCallback)((e,t)=>n(void 0,void 0,void 0,function*(){var t;const a=null===(t=e.body)||void 0===t?void 0:t.getReader(),n=new TextDecoder;let r="",l="";if(a){f&&f(!0);try{for(;;){const{done:e,value:t}=yield a.read();if(e)break;const s=n.decode(t,{stream:!0});l=(0,o.processStreamChunk)(s,l,e=>{r+=e,c(r)}).newBuffer}}catch(e){if(e instanceof Error&&"AbortError"===e.name)return{content:"",shouldUpdate:!1};throw e}l=(0,o.processRemainingBuffer)(l,e=>{r+=e,c(r)}),f&&f(!1)}return{content:r,shouldUpdate:!0}}),[c,f]),S=(0,r.useCallback)(e=>n(void 0,void 0,void 0,function*(){var t;const a=yield fetch("https://flow.ovo.gs/ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"sydf-v1-250520",messages:e,temperature:.7}),signal:null===(t=y.current)||void 0===t?void 0:t.signal});if(!a.ok)throw new Error(`AI 服务错误: ${a.status}`);return a}),[]),O=(0,r.useCallback)((e,t,a)=>{var n,r;const l=[...a];"assistant"!==(null===(n=l[l.length-1])||void 0===n?void 0:n.role)||(null===(r=l[l.length-1])||void 0===r?void 0:r.content.trim())||l.pop();const s=(0,o.createErrorMessage)(e);l.push(s),u(l),h(!0,t.content)},[u,h]);return{isGenerating:p,sendMessage:(0,r.useCallback)((r,l)=>n(void 0,void 0,void 0,function*(){if(r.content.trim()){d(!0),g(!0),h(!1);try{y.current=new AbortController;const n={role:"assistant",content:""},c=[...l,n];u(c);const d=(0,o.buildSystemPrompt)(e,null!=t?t:null,null!=a?a:null,s,i),m=(0,o.buildAIMessages)(d,l,r),f=yield S(m),{content:h,shouldUpdate:p}=yield w(f,l);if(p&&h.trim()){const e=[...l,{role:"assistant",content:h}];u(e)}else u(l)}catch(e){O(e,r,l)}finally{d(!1),g(!1)}}}),[t,a,s,i,d,h,S,w,O,u]),regenerateResponse:(0,r.useCallback)((r,l)=>n(void 0,void 0,void 0,function*(){if(r.trim()){h(!1),d(!0),g(!0);try{y.current=new AbortController;const n={role:"assistant",content:""},c=[...l,n];u(c);const d=(0,o.buildSystemPrompt)(e,null!=t?t:null,null!=a?a:null,s,i),m=l.filter(e=>!("assistant"===e.role&&e===l[l.length-1])),f=[{role:"system",content:d},...m,{role:"user",content:r}],h=yield S(f),{content:p,shouldUpdate:g}=yield w(h,l);if(g&&p.trim()){const e=[...m,{role:"assistant",content:p}];u(e)}else u(l)}catch(e){const t=(0,o.createErrorMessage)(e),a=[...l,t];u(a),h(!0,r)}finally{d(!1),g(!1)}}}),[t,a,s,i,h,d,S,w,u]),stopGeneration:(0,r.useCallback)(()=>{y.current&&(y.current.abort(),y.current=null),g(!1),m(!1),d(!1)},[m,d])}}},4013:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.questionCategories=t.synastryQuickActions=t.quickActions=void 0,t.quickActions=[{id:"astro-analysis",name:"命盘分析",prompt:"请对我的紫微斗数星盘进行全面而深入的专业分析，包括：\n1. 命宫与身宫：深度解读命宫和身宫的主星、辅星组合，分析我的先天性格、后天发展、核心优势与潜在挑战。\n2. 十二宫位概览：逐一解析命宫、兄弟宫、夫妻宫、子女宫、财帛宫、疾厄宫、迁移宫、交友宫(奴仆宫)、事业宫(官禄宫)、田宅宫、福德宫、父母宫的星曜组合，揭示各个人生领域的状况。\n3. 核心星曜解读：重点分析我命盘中全部14颗主星（紫微、天机、太阳、武曲、天同、廉贞、天府、太阴、贪狼、巨门、天相、天梁、七杀、破军）的庙旺利陷和影响力。\n4. 格局分析：识别并解释我命盘中存在的特殊格局（如杀破狼、紫府同宫、机月同梁等），并阐述其对人生的整体影响。\n5. 四化星体系：详细解释本命四化（化禄、化权、化科、化忌）在命盘中的具体体现，并分析大运和流年的飞星四化对我运势的动态影响。\n6. 三方四正与两夹：分析命宫、财帛宫、事业宫的三方四正关系，以及命宫的两邻宫（兄弟宫、父母宫）对其的辅助或制约作用，揭示我的人生发展主线。\n7. 空宫分析：如果命盘中存在无主星的空宫，请分析其借对宫星曜后的意义和影响。\n8. 大运与流年：结合当前大运和流年运势，分析我当前所处的人生阶段和未来一年的发展趋势。\n9. 综合建议：基于以上分析，为我提供趋吉避凶的人生规划建议和发展方向指导。"},{id:"career-finance",name:"事业财运",prompt:"请从紫微斗数的角度，对我一生的事业发展和财富格局进行一次全面、深入的剖析，无需拘泥于形式，但求深刻洞见。请重点分析但不限于以下方面：\n1. **命格与职业方向**：结合我的命宫、身宫，分析我的性格天赋、能力倾向，推荐最能发挥我潜能的行业与职业道路。\n2. **事业宫（官禄宫）**：深度解读此宫的星曜组合、四化和格局，判断我的事业成就高度、工作环境、领导能力以及是否适合创业。\n3. **财帛宫**：详批此宫的星曜，揭示我的理财观念、赚钱能力、财富规模以及正财与偏财的比例。\n4. **迁移宫**：分析此宫对我事业的影响，判断我是否适合向外发展、变动工作，以及在外的人缘和机遇。\n5. **福德宫与田宅宫**：探究福德宫所显示的财富观念、享受层次，以及田宅宫所代表的资产积累能力和家业兴衰。\n6. **动态运势**：结合我当前所处的大运、流年，详论近十年及未来一年的事业和财运起伏、关键机遇和挑战，并指出需要特别注意的年份。\n7. **人际资源**：分析交友宫（奴仆宫）、父母宫和兄弟宫，判断我的事业贵人、合作伙伴、得力下属以及可能带来麻烦的小人。\n8. **风险与对策**：明确指出我命盘中在事业和财务上的主要风险点（如化忌、煞星的冲击），并提供趋吉避凶的策略和建议。"},{id:"love-marriage",name:"感情婚姻",prompt:"请从紫微斗数的角度，对我一生的感情世界与婚姻生活进行一次全面、深入的剖析，无需拘泥于形式，但求深刻洞见。请重点分析但不限于以下方面：\n1. **感情性格与模式**：结合我的命宫、福德宫和疾厄宫，深度分析我的感情观、恋爱模式、真实情感需求以及在亲密关系中的表现。\n2. **夫妻宫**：详批此宫的星曜组合、四化和格局，揭示我的择偶标准、正缘或配偶的详细特征（性格、外貌、职业等），以及婚姻生活的整体质量。\n3. **桃花与情缘**：全面分析命盘中的桃花星（如红鸾、天喜、咸池、天姚、廉贞、贪狼），判断我此生的桃花运旺衰、情缘深浅以及烂桃花的风险。\n4. **感情的动态演变**：结合我当前所处的大运、流年，详论近十年及未来一年的感情运势起伏，预测可能的恋爱、结婚、或感情波动的时间点。\n5. **婚姻的挑战与维系**：分析夫妻宫的三方四正及煞忌影响，揭示婚姻中可能出现的潜在问题、冲突点以及第三方介入的风险。\n6. **子女与家庭**：通过子女宫和田宅宫，分析与子女的缘分、亲子关系，以及婚后家庭生活的氛围。\n7. **趋吉避凶**：基于以上所有分析，为我提供提升感情运、选择合适伴侣、以及维系婚姻关系的具体、可操作的建议。"},{id:"academic-exam",name:"学业考试",prompt:"请从紫微斗数的角度，对我一生的学业发展和考试运势进行一次全面、深入的剖析，无需拘泥于形式，但求深刻洞见。请重点分析但不限于以下方面：\n1. **学习天赋与智慧**：结合命宫、父母宫和福德宫，分析我的先天学习能力、逻辑思维、记忆力和智慧层次。\n2. **科甲星曜**：深度解读文昌、文曲、化科、天才、龙池、凤阁等星曜在我命盘中的作用，判断我的学历高低和考试才能。\n3. **学业与事业宫**：分析事业宫（官禄宫）的星曜组合，判断学业对我事业的实际助益，以及我是否能学以致用。\n4. **适合的专业方向**：基于整体星盘的五行和星性，推荐最适合我攻读的学科领域和专业方向。\n5. **学业运势起伏**：结合大运和流年，分析我学业运势的高峰与低谷，指出考研、考公、升学等关键机会的有利年份。\n6. **学习策略建议**：根据我的命盘特点，提供最适合我的学习方法、备考策略和提升专注力的建议。"},{id:"health-status",name:"健康",prompt:"请从紫微斗数的角度，对我一生的健康状况和养生之道进行一次全面、深入的剖析，无需拘泥于形式，但求深刻洞见。请重点分析但不限于以下方面：\n1. **疾厄宫**：深度解读此宫的星曜、四化和煞曜，揭示我先天的体质强弱、遗传倾向以及最需要注意的身体器官。\n2. **命宫与身宫**：分析命宫和身宫的星曜组合，判断我总体的生命力、抵抗力以及对疾病的承受和恢复能力。\n3. **潜在病灶**：根据星盘中煞忌星曜（特别是擎羊、陀罗、火星、铃星、化忌）的落点，分析我一生中最容易出现的健康问题和疾病类型（包括生理和心理层面）。\n4. **健康运势演变**：结合大运和流年，分析我健康运势的起伏，预警需要特别注意保养或可能发生意外、手术的年份。\n5. **心理与情绪健康**：通过福德宫和疾厄宫的关联，分析我的精神状态、压力承受能力和常见的情绪困扰。\n6. **养生与保健**：基于我的命盘体质，提供个性化的养生建议，包括饮食、运动、作息以及情绪疏导等趋吉避凶的方法。"},{id:"fortune-analysis",name:"运势",prompt:"请从紫微斗数的角度，对我当前及未来的整体运势进行一次全面、深入的剖析，无需拘泥于形式，但求深刻洞见。请重点分析但不限于以下方面：\n1. **十年大运**：深度解读我当前所处大运的宫位、星曜和四化，论断这十年总体的机遇、挑战和人生主题。\n2. **流年详批**：详细分析今年的流年命宫、流年十二宫的状况，以及流年四化对我本命盘的冲击，具体到事业、财运、感情、健康等各方面的吉凶变化。\n3. **关键机遇与挑战**：明确指出在当前大运和流年中，我最值得把握的机遇在哪个领域（例如，是事业突破，还是财富增长，或是感情开花结果），以及最需要防范的风险是什么。\n4. **流月运势简析**：简要分析未来几个月的运势走向，并提示哪几个月是关键的转折点。\n5. **趋吉避凶**：针对当前运势中的不利因素（如流年化忌、煞星），提供具体、可操作的化解和应对策略，帮助我趋吉避凶，顺势而为。"},{id:"interpersonal",name:"人际",prompt:"请对我的人际关系进行专业的紫微斗数分析，包括：\n1. 交友宫(奴仆宫)分析：分析交友宫的星曜配置，揭示我与朋友、同事、下属的相处模式和人际关系质量。\n2. 兄弟宫分析：分析兄弟宫的星曜，判断我与同辈、挚友、兄弟姐妹的关系深浅。\n3. 社交特质：结合命宫与迁移宫，分析我的性格特点在社交场合中的表现和给人的第一印象。\n4. 贵人与小人：分析命盘中的贵人星（如天魁、天钺）和小人星（如擎羊、陀罗、化忌），判断贵人方向和小人来源。\n5. 人际网络质量：综合交友宫和兄弟宫，评估我社交圈的特点、人脉质量和广度。\n6. 沟通模式：分析巨门、文昌、文曲等星曜，判断我的沟通风格、表达能力和说服力。\n7. 人际冲突：识别交友宫或兄弟宫的煞忌组合，分析人际冲突的根源和处理方式。\n8. 改善建议：提供拓展人脉、改善特定人际关系（如与上司、同事）的实用技巧。"},{id:"family-relations",name:"家庭",prompt:"请从紫微斗数的角度，对我一生的家庭状况和人伦关系进行一次全面、深入的剖析，无需拘泥于形式，但求深刻洞见。请重点分析但不限于以下方面：\n1. **原生家庭与父母**：深度解读父母宫，分析我与父母的缘分深浅、相处模式，以及原生家庭对我性格和命运的深远影响。\n2. **兄弟手足情谊**：分析兄弟宫，判断我与兄弟姐妹、闺蜜或核心合作伙伴的关系质量和互动模式。\n3. **婚姻与配偶**：结合夫妻宫，论断我的婚姻生活、与配偶的相处方式，以及对方家庭对我的影响。\n4. **子女缘分与教育**：详批子女宫，判断我与子女的缘分、亲子互动模式，以及对子女的教育方式和他们的未来发展。\n5. **家宅与资产**：分析田宅宫，判断我的居住环境、家庭氛围、不动产运势以及家族的兴旺程度。\n6. **家庭关系的动态**：结合大运和流年，分析当前家庭关系的焦点、潜在的矛盾以及重要的家庭事件（如添丁、搬家等）。\n7. **改善之道**：针对家庭关系中可能存在的挑战，提供增进和谐、改善沟通的具体建议。"},{id:"psychology-personality",name:"心性",prompt:"请从紫微斗数的角度，对我的人格特质与精神世界进行一次全面、深入的剖析，无需拘泥于形式，但求深刻洞见。请重点分析但不限于以下方面：\n1. **表里人格**：深度解读命宫和身宫的组合，分析我外在表现（身）与内在真实自我（命）的异同，揭示我的人格核心。\n2. **精神世界与价值观**：详批福德宫，揭示我的思想深度、精神追求、兴趣爱好、人生观和幸福感的来源。\n3. **情绪与潜意识**：分析疾厄宫，判断我的情绪处理机制、抗压能力，以及潜意识中隐藏的焦虑或恐惧。\n4. **思维与智慧**：结合命宫、福德宫以及文昌、文曲等智慧星曜，分析我的思维模式、决策风格和学习能力。\n5. **性格优势与劣势**：全面总结我的性格优点和潜能，同时毫不避讳地指出我需要面对和修炼的人生课题与性格弱点。\n6. **个人成长建议**：基于命盘的整体格局，为我提供扬长避短、提升心性、实现更高层次自我价值的具体修行建议。"},{id:"yearly-prediction",name:"流年",prompt:"请从紫微斗数的角度，为我详批未来一年的流年运势，无需拘泥于形式，但求深刻洞见。请重点分析但不限于以下方面：\n1. **流年总论**：分析流年命宫、身宫的星曜和四化，对我未来一年的整体状态、机遇和挑战下一个总论。\n2. **事业财运**：详批流年事业宫和财帛宫，预测工作上的变动、升迁机遇，以及财运的起伏和重大开销。\n3. **感情人际**：详批流年夫妻宫和交友宫，预测感情生活的发展、新人出现的时机，以及人际关系的变化。\n4. **健康安全**：详批流年疾厄宫和迁移宫，预警需要注意的健康问题和外出安全事宜。\n5. **流月运势**：点出未来12个月中，运势最好和最需要注意的月份，并简要说明原因。\n6. **年度规划建议**：根据流年运势，为我提供趋吉避凶的年度规划建议。"},{id:"resolution-suggestions",name:"建议",prompt:"请从紫微斗数的角度，针对我命盘和当前运势中的主要挑战，提供一份全面、深入、可操作的趋吉避凶策略，无需拘泥于形式，但求深刻洞见。请重点分析但不限于以下方面：\n1. **核心挑战识别**：精准定位我命盘（本命、大运、流年）中最核心的不利因素，例如最凶的化忌在何宫、最需要注意的煞星组合是什么。\n2. **问题根源剖析**：分析这些不利因素所代表的人生课题，揭示其在性格、行为、运势等方面的具体表现。\n3. **分领域化解**：针对事业、财运、感情、健康等不同领域，提供具体的化解或改善建议。\n4. **“因果”层面的建议**：从事理、心性层面，提出能从根本上调整命运的修身养性之道（例如，针对特定星曜组合的性格优化建议）。\n5. **“时空”层面的建议**：在行为、风水、人际交往等方面，提供可以实际操作的趋吉避凶方法（例如，在特定年份应避免的决策，适合交往的人，有利的方位颜色等）。\n6. **关键时机提醒**：明确指出未来几年中，哪些年份是改运和提升的关键期，应该如何把握。"},{id:"life-planning",name:"规划",prompt:"请从紫微斗数的角度，为我提供一份全面、深入、贯穿一生的人生战略规划，无需拘泥于形式，但求深刻洞见。请重点分析但不限于以下方面：\n1. **人生定位与使命**：综合全盘，提炼我此生的核心人生课题与最终可以达成的生命格局，为我的人生进行战略定位。\n2. **大运详批**：逐一分析我从今往后的每一个十年大运，揭示每个阶段的人生主题、发展机遇、主要挑战和应该采取的核心策略。\n3. **事业蓝图**：规划我的长期事业发展路径，预测可能的事业高峰期，并对创业、跳槽等重大决策提供时机建议。\n4. **财富蓝图**：规划我的财富积累路径，包括适合的求财方式、投资策略，以及实现财务自由的可能性。\n5. **感情与家庭蓝图**：规划我的感情发展路径，包括正缘出现、结婚的有利时机，以及家庭生活的经营策略。\n6. **风险管控**：明确指出我人生各阶段（特别是重要大运、流年）需要防范的主要风险（事业、财务、感情、健康等），并提供相应的规避和化解方案。\n7. **行动指南**：将宏大的人生规划落实到当前，为我未来一年的具体行动提供清晰、可操作的指引。"}],t.synastryQuickActions=[{id:"friendship-compatibility",name:"交友",prompt:"请从紫微斗数的角度，对{person1}和{person2}的交友缘分进行一次全面、深入的剖析，无需拘泥于形式，但求深刻洞见。请重点分析但不限于以下方面：\n1. **性格与磁场**：对比双方命宫、福德宫，判断两人性格是否投缘，气场是否相合。\n2. **交友宫互动**：分析一方的交友宫（奴仆宫）星曜，是否为另一方命宫所喜，判断关系的初始吸引力。\n3. **缘分类型（飞星）**：通过分析一方交友宫宫干的飞星四化对另一方命盘的影响，判断这段友谊是益友还是损友，是贵人还是过客。\n4. **长期与短期关系**：结合兄弟宫（代表深交、同辈）和交友宫（代表广泛、普通朋友），判断这段友谊适合长期深交还是短期共事。\n5. **潜在的冲突**：识别双方命盘中可能导致友谊破裂的煞忌组合，预警潜在的矛盾点。\n6. **综合建议**：为如何维系和发展这段友谊提供具体建议。"},{id:"love-compatibility",name:"恋爱",prompt:"请对{person1}和{person2}的恋爱合盘进行专业的紫微斗数分析，包括：\n1. 命宫与夫妻宫匹配：分析双方命宫主星的性格是否融洽，以及一方的夫妻宫星曜是否是另一方喜欢的类型。\n2. 感情观与需求对比：比较双方的感情特质、恋爱模式和情感需求的异同。\n3. 宫位互动分析（飞星）：分析一方的命宫、夫妻宫宫干，对另一方命盘相应宫位产生的飞星四化影响，判断互动的吉凶。\n4. 吸引力与化学反应：基于星盘的桃花星曜和五行生克，分析两人之间的核心吸引力。\n5. 沟通与冲突：比较两人的沟通风格，并从疾厄宫、交友宫的煞忌情况，分析潜在的冲突点。\n6. 感情挑战：识别两人星盘中可能对关系造成负面影响的星曜组合（如孤辰、寡宿，或夫妻宫的煞忌）。\n7. 关系走向：结合双方当前的大运和流年，分析这段关系在近期的发展趋势和关键节点。\n8. 综合建议：基于以上分析，提供促进恋爱关系发展的具体建议。"},{id:"marriage-compatibility",name:"合婚",prompt:"请对{person1}和{person2}的婚姻缘分进行一次全面、深入的紫微斗数合盘分析，无需拘泥于形式，但求深刻洞见。请重点分析但不限于以下方面：\n1. **核心性格与价值观匹配**：深度对比两人的命宫、身宫、福德宫，判断其性格、人生追求和核心价值观是否能够琴瑟和鸣。\n2. **夫妻宫的相互吸引**：分析一方的夫妻宫星曜，是否为另一方的命宫星曜所喜；同时，判断一方的命宫星曜，是否能满足另一方夫妻宫的要求。\n3. **缘分的深度与类型（飞星四化）**：以双方的命宫、夫妻宫宫干，用飞星四化看其如何影响对方的命盘。重点分析禄、权、科、忌分别飞入对方何宫，以此判断双方是善缘、恶缘，还是债主、贵人关系。\n4. **宫位重叠的宿命连结**：检查双方是否存在关键的宫位重叠（例如，A的命宫是B的夫妻宫，A的财帛宫是B的事业宫等），并深度解读这些重叠所带来的特殊缘分和互动模式。\n5. **现实层面的和谐度**：对比双方的财帛宫、事业宫、田宅宫、子女宫，评估两人在金钱观、事业追求、家庭观念和子女教育上的一致性与互补性。\n6. **潜在的冲突与危机**：识别并分析双方星盘中所有可能对婚姻造成冲击的煞忌组合，以及运势不同步可能带来的挑战。\n7. **综合论断与建议**：综合以上所有信息，对这段姻缘的最终匹配度下一个结论，并为如何促进关系和谐、化解潜在矛盾提供具体、可行的建议。"},{id:"business-partnership",name:"合伙",prompt:"请对{person1}和{person2}的合伙合盘进行专业的紫微斗数分析，包括：\n1. 事业与财富匹配：分析双方事业宫、财帛宫的星曜组合，判断能力是否互补，财富目标是否一致。\n2. 性格与决策模式：分析双方的性格、决策风格和执行力的互补性。\n3. 宫位互动分析（飞星）：分析一方的事业宫、财帛宫宫干，对另一方命盘产生的飞星四化影响，判断合作的吉凶互动。\n4. 责任与权力：从星盘中断定双方在合作中适合扮演的角色（例如，谁主外，谁主内；谁是决策者，谁是执行者）。\n5. 运势同步性：比较两人未来十年的事业及财富大运走势，判断合作的黄金时期和需要谨慎的阶段。\n6. 潜在冲突：识别可能导致合作破裂的星盘因素（如财帛宫、交友宫的煞忌），并预警潜在的利益纠纷。\n7. 长期发展：评估两人星盘组合的长期稳定性与发展潜力。\n8. 综合建议：基于以上分析，提供促进合作成功的具体建议、权责划分方案和注意事项。"},{id:"family-harmony",name:"家庭",prompt:"请从紫微斗数的角度，对{person1}和{person2}的家庭关系（如亲子、婆媳、兄弟姐妹等）进行一次全面、深入的剖析，无需拘泥于形式，但求深刻洞见。请重点分析但不限于以下方面：\n1. **基本缘分**：对比双方的命宫、福德宫，判断两人基本的性格和价值观是否融洽。\n2. **关系定位**：根据双方在家庭中的角色（如父子、母女），重点分析相应的宫位（如父母宫、子女宫）的互动关系。\n3. **互动模式（飞星）**：通过分析一方相关宫位（如父母宫）的飞星四化对另一方命盘的影响，判断两人之间是关爱、扶持，还是冲突、疏离。\n4. **宫位重叠**：检查是否存在特殊的宫位重叠（如一方的命宫是另一方的子女宫），并解读其特殊的家庭联结。\n5. **潜在矛盾**：识别双方星盘中可能导致家庭矛盾的煞忌组合，并指出问题的根源。\n6. **和谐之道**：为改善这段家庭关系，促进家庭和谐，提供具体、可行的建议。"},{id:"communication-style",name:"沟通",prompt:"请从紫微斗数的角度，对{person1}和{person2}的沟通模式进行一次全面、深入的合盘分析，无需拘泥于形式，但求深刻洞见。请重点分析但不限于以下方面：\n1. **沟通星曜**：重点分析双方命盘中的巨门、文昌、文曲、化科、化忌等星曜，判断各自的沟通风格、表达能力和逻辑性。\n2. **思维方式**：对比双方的命宫、福德宫，分析两人思维模式的异同，是从宏观还是微观思考，是感性还是理性主导。\n3. **互动模式（飞星）**：通过分析一方命宫或福德宫的飞星四化对另一方命盘的影响，判断两人的沟通是有效、有益，还是会产生误解和冲突。\n4. **冲突根源**：识别双方星盘中导致沟通不畅的星曜组合，揭示争吵和误解的深层原因。\n5. **改善建议**：针对两人的沟通特点，提供如何有效沟通、避免冲突、增进理解的具体策略。"},{id:"life-path",name:"人生",prompt:"请从紫微斗数的角度，对{person1}和{person2}的人生道路进行一次全面、深入的合盘分析，无需拘泥于形式，但求深刻洞见。请重点分析但不限于以下方面：\n1. **人生格局与方向**：对比双方的命宫、身宫和整体格局，判断两人的人生追求、生命层次和最终发展方向是否一致。\n2. **大运同步性**：详细对比两人未来数个十年大运的走势，分析其人生高峰与低谷是否同步，能否在关键时期相互扶持。\n3. **宫位互动与影响**：通过飞星四化和宫位重叠技术，分析两人在人生重大领域（如事业、财富、家庭）的深层互动和相互影响。\n4. **共同的课题与挑战**：识别两人命盘中共有的弱点或挑战，揭示他们需要共同面对和修行的人生课题。\n5. **互为贵人或阻碍**：判断两人在人生旅途上是互为贵人、相互成就，还是会成为彼此的阻碍和消耗。\n6. **共同发展建议**：基于以上分析，为两人如何协调人生步调、实现共同成长提供战略性建议。"}],t.questionCategories=[{name:"感情",subCategories:[{name:"情感发展",questions:["我近期的桃花运怎么样？","我们目前的感情走向如何？","他/她对我的真实情感是什么？","我们之间有未来吗？","如何改善我们目前的关系？","这段感情对我的影响？","我该如何表达我的感情？","我们的感情会遇到什么考验？"]},{name:"正缘婚姻",questions:["我的正缘什么时候出现？","我的另一半是什么样的人？","我何时会结婚？","我适合和现在的对象结婚吗？","我的婚姻生活会幸福吗？","如何吸引我的正缘桃花？","我的配偶会来自哪个方向？","婚姻中需要注意什么问题？"]},{name:"关系难题",questions:["我们之间出了什么问题？","如何解决现在的感情危机？","我们有机会复合吗？","我应该放弃这段感情吗？","我和Ta的缘分有多深？","我的灵魂伴侣有什么特征？","如何处理感情中的第三者？","如何应对感情中的欺骗？"]},{name:"恋爱技巧",questions:["如何提高我的恋爱成功率？","我该如何追求喜欢的人？","如何让感情保持新鲜感？","恋爱中如何保持自我？","如何判断对方是否真心？","如何处理异地恋？","恋爱中如何避免争吵？","如何提升我的魅力值？"]},{name:"分手挽回",questions:["分手后还能复合吗？","如何有效挽回前任？","分手是我做错了吗？","什么时候是挽回的最佳时机？","分手后如何调整心态？","如何判断是否值得挽回？","分手后还能做朋友吗？","如何避免再次失恋？"]}]},{name:"事业",subCategories:[{name:"事业发展",questions:["我适合现在的工作/行业吗？","我的事业什么时候能成功？","我适合跳槽还是继续坚守？","我事业上的贵人会是谁？","我未来的事业走向怎么样？","我什么时候能找到如意的工作？","我的事业瓶颈期在什么时候？","如何突破事业发展的困境？"]},{name:"职场机遇",questions:["我今年有机会升职加薪吗？","如何得到领导的赏识和重用？","我在公司的发展前景如何？","如何改善当前的工作状态？","我最近的职场人际运如何？","什么时候是换工作的好时机？","我适合独立工作还是团队合作？","如何在职场中脱颖而出？"]},{name:"创业之路",questions:["我适合创业吗？","我的创业最佳时机是什么时候？","我该和什么样的人合作？","我的创业项目前景如何？","创业过程中需要注意哪些风险？","我的创业会成功吗？","我适合什么类型的创业？","如何解决创业初期的资金问题？"]},{name:"职场沟通",questions:["如何与难相处的同事相处？","我该如何向领导提出建议？","如何在会议中有效表达？","如何处理职场中的冲突？","如何建立良好的职场形象？","如何拒绝不合理的工作要求？","如何进行有效的绩效谈判？","如何提升我的职场说服力？"]},{name:"团队管理",questions:["我适合做管理岗位吗？","如何有效激励团队成员？","如何处理团队内部矛盾？","如何提升团队的执行力？","我适合带领什么样的团队？","如何培养团队的核心竞争力？","如何在管理中保持权威？","如何处理团队中的问题员工？"]}]},{name:"财富",subCategories:[{name:"财运趋势",questions:["我近期的财运怎么样？","我这辈子财运的整体趋势？","我什么时候能发财？","我适合靠什么方式赚钱？","如何有效提升我的财运？","我近期会有意外之财吗？","我的财运高峰期在什么时候？","如何避免财运波动的影响？"]},{name:"投资理财",questions:["我适合做投资吗？","我应该选择什么样的投资方向？","这个投资项目能赚钱吗？","如何才能守住我的财富？","我的投资风险大吗？","如何更好地管理我的财富？","我适合股票还是基金投资？","如何制定长期理财计划？"]},{name:"财务状况",questions:["我为什么总是存不住钱？","是什么原因导致我财务紧张？","我最近会有破财风险吗？","如何避免不必要的财务损失？","我需要注意哪些年份的破财？","我该如何处理我的债务问题？","如何建立良好的财务习惯？","我的收入什么时候能增加？"]},{name:"债务处理",questions:["我该如何处理现有债务？","什么时候能还清所有债务？","我适合贷款投资吗？","如何避免陷入债务危机？","债务会对我的生活产生什么影响？","如何与债权人协商？","我适合做担保人吗？","如何重建信用记录？"]},{name:"购房决策",questions:["我现在适合买房吗？","买房还是租房更适合我？","我该在哪个城市买房？","购房的最佳时机是什么时候？","我适合买什么类型的房子？","如何选择有升值潜力的房产？","贷款买房有什么风险？","如何处理房产投资中的纠纷？"]}]},{name:"人际",subCategories:[{name:"社交模式",questions:["我的人际交往模式有何优缺点？","如何拓展我的高质量社交圈？","我目前的人际关系状态如何？","我会吸引哪些人进入我的生活？","如何获得他人的信任与支持？","如何处理与朋友的矛盾？","我适合什么样的社交场合？","如何提升我的社交魅力？"]},{name:"贵人善缘",questions:["什么样的朋友是我的贵人？","我应该远离什么样的朋友？","如何结交更多志同道合的朋友？","我该如何维系重要的友谊？","我该信任我身边的朋友吗？","如何获得领导或长辈的赏识？","我的贵人会在什么时候出现？","如何识别真正的贵人？"]},{name:"职场人际",questions:["如何与难相处的上司相处？","我在职场中的人际关系如何？","如何处理同事间的竞争关系？","如何在职场中建立人脉？","我适合什么样的工作环境？","如何应对职场中的排挤？","如何获得同事的认可？","职场中如何保持适当的距离？"]},{name:"社交技巧",questions:["如何提高我的沟通能力？","我该如何打破社交尴尬？","如何在聚会中表现自然？","如何与陌生人建立联系？","如何进行有效的倾听？","如何拒绝他人的不合理要求？","如何提升我的说服力？","如何处理社交中的冲突？"]},{name:"冲突处理",questions:["我该如何处理人际冲突？","如何避免不必要的争论？","如何化解与他人的误会？","面对指责我该如何回应？","如何处理家庭矛盾？","如何在冲突中保持冷静？","如何修复破裂的关系？","如何设定健康的人际边界？"]}]},{name:"人生",subCategories:[{name:"学业规划",questions:["我的学业运势如何？","我适合考研/考公吗？","我适合继续深造还是工作？","如何提升我的学习效率？","我该选择哪个专业/学校？","我这次考试能通过吗？","我适合出国留学吗？","如何克服学习中的困难？"]},{name:"个人成长",questions:["我的性格优势和劣势是什么？","我的人生主要课题是什么？","如何找到我的人生方向？","如何克服我性格中的弱点？","如何有效提升自己的能量状态？","我的人生转折点在何时？","如何建立自信？","如何实现自我价值？"]},{name:"人生机遇",questions:["我未来十年的人生大运怎么样？","我该如何实现我的人生目标？","我的人生会有什么重大机遇？","我应该注意哪些健康问题？","如何才能活出更精彩的人生？","未来的人生之路走向如何？","我的人生贵人会在什么时候出现？","如何把握人生中的重要机会？"]},{name:"人生抉择",questions:["我该如何做出重要的人生决定？","我适合留在当前城市还是迁移？","我该选择稳定还是挑战？","如何判断一个机会是否值得把握？","我的人生道路该如何选择？","如何平衡工作与生活？","我适合什么样的生活方式？","如何面对人生的十字路口？"]},{name:"目标设定",questions:["如何设定适合我的人生目标？","我该制定短期还是长期目标？","如何确保目标的可实现性？","如何分解大目标为小步骤？","如何保持对目标的专注？","如何调整不合适的目标？","如何衡量目标的进展？","如何应对目标实现中的挫折？"]},{name:"时间管理",questions:["如何提高我的时间利用效率？","我该如何平衡各项事务？","如何避免拖延症？","如何制定有效的时间计划？","如何处理突发事务的干扰？","如何保证充足的休息时间？","如何区分事务的优先级？","如何在忙碌中保持生活质量？"]}]},{name:"健康",subCategories:[{name:"健康状况",questions:["我的整体健康状况如何？","我容易患哪些疾病？","我需要注意哪些健康问题？","我的体质属于什么类型？","如何提升我的免疫力？","我最近会有健康风险吗？","我的健康运势怎么样？","如何预防常见疾病？"]},{name:"养生保健",questions:["我适合什么样的养生方式？","如何根据季节调整养生方法？","我该注意哪些饮食禁忌？","如何改善我的睡眠质量？","我适合什么类型的运动？","如何缓解工作压力？","如何进行有效的排毒？","如何保持年轻态？"]},{name:"疾病预防",questions:["我该如何预防慢性疾病？","哪些疾病我需要特别警惕？","如何通过饮食预防疾病？","我的身体哪些部位需要重点保养？","如何避免亚健康状态？","定期体检有必要吗？","如何识别疾病的早期信号？","如何建立健康的生活习惯？"]},{name:"心理健康",questions:["我的心理状态健康吗？","如何缓解焦虑和压力？","我该如何调节情绪？","如何避免抑郁情绪？","如何提升心理韧性？","我适合什么样的减压方式？","如何保持积极的心态？","如何处理心理创伤？"]},{name:"运动健身",questions:["我适合什么类型的运动？","如何制定科学的健身计划？","运动时需要注意什么？","如何避免运动损伤？","我适合晨练还是晚练？","如何坚持运动习惯？","运动对我的健康有什么好处？","如何选择适合的健身场所？"]}]},{name:"家庭",subCategories:[{name:"家庭和谐",questions:["我的家庭关系和谐吗？","如何改善家庭氛围？","我该如何处理家庭矛盾？","如何增进家庭成员的感情？","家庭中如何有效沟通？","如何平衡家庭与工作？","如何建立幸福的家庭？","家庭对我的影响是什么？"]},{name:"亲子关系",questions:["我该如何教育孩子？","如何与孩子建立良好关系？","孩子的教育问题该如何处理？","如何培养孩子的独立性？","我适合什么样的教育方式？","如何处理孩子的叛逆期？","如何帮助孩子健康成长？","如何平衡严格与宽容？"]},{name:"婚姻生活",questions:["我的婚姻生活幸福吗？","如何保持婚姻的新鲜感？","如何处理婚姻中的矛盾？","我该如何与配偶沟通？","如何平衡婚姻与个人空间？","婚姻中需要避免什么问题？","如何经营长久的婚姻？","如何应对婚姻危机？"]},{name:"老人赡养",questions:["我该如何赡养老人？","如何与老人和谐相处？","老人的健康问题该如何处理？","如何平衡工作与照顾老人？","我适合什么样的养老方式？","如何让老人安享晚年？","如何处理老人的固执？","如何关注老人的心理健康？"]},{name:"家族关系",questions:["我在家族中的地位如何？","如何处理复杂的家族关系？","家族对我的发展有什么影响？","如何维护家族和谐？","我该如何面对家族期望？","如何处理家族财产问题？","如何平衡小家庭与大家族？","如何建立良好的家族声誉？"]}]},{name:"运势",subCategories:[{name:"流年运势",questions:["我今年的整体运势如何？","今年的事业运势怎么样？","今年的财运会有什么变化？","今年的感情运势如何？","今年的健康状况需要注意什么？","今年我会有什么机遇？","今年需要防范什么风险？","如何把握今年的好运势？"]},{name:"大运分析",questions:["我当前的大运怎么样？","这个大运会持续多久？","大运期间我需要注意什么？","如何把握大运的机遇？","大运对事业有什么影响？","大运对感情有什么影响？","大运对健康有什么影响？","如何顺利度过不利大运？"]},{name:"时机选择",questions:["什么时候是做重要决定的最佳时机？","我什么时候适合换工作？","什么时候适合投资创业？","什么时候适合结婚？","什么时候适合搬家？","什么时候适合出国？","什么时候适合开始新项目？","如何识别有利时机？"]},{name:"运势提升",questions:["如何提升我的整体运势？","什么方法可以改善我的运势？","我适合佩戴什么吉祥物？","如何通过风水改善运势？","什么颜色对我的运势有利？","什么方位对我的运势有帮助？","如何通过行为改善运势？","如何保持好运的持续性？"]},{name:"风险预警",questions:["我近期会遇到什么风险？","哪些年份我需要特别注意？","如何防范事业风险？","如何防范财务风险？","如何防范感情风险？","如何防范健康风险？","如何识别潜在的危险？","如何应对突发的不利事件？"]}]}]},4029:function(e,t,a){var n,r=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=n(e),l=0;l<a.length;l++)"default"!==a[l]&&r(t,e,a[l]);return o(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Iztrolabe=void 0;const i=l(a(6540)),c=a(5069),u=a(471),d=s(a(2485)),m=a(9755);a(3186);const f=a(3877);t.Iztrolabe=e=>{const[t,a]=(0,i.useState)(-1),[n,r]=(0,i.useState)(),[o,l]=(0,i.useState)(),[s,h]=(0,i.useState)(),[p,g]=(0,i.useState)(),[y,v]=(0,i.useState)(!1),[b,E]=(0,i.useState)(!1),[w,S]=(0,i.useState)(!1),[O,_]=(0,i.useState)(!1),[C,k]=(0,i.useState)(!1),[N,M]=(0,i.useState)(),[j,P]=(0,i.useState)(),{astrolabe:T,horoscope:D,setHoroscope:x}=(0,m.useIztro)({birthday:e.birthday,birthTime:e.birthTime,gender:e.gender,birthdayType:e.birthdayType,fixLeap:e.fixLeap,isLeapMonth:e.isLeapMonth,lang:e.lang,astroType:e.astroType,options:e.options}),H=e=>{switch(e){case"decadal":v(!y);break;case"yearly":E(!b);break;case"monthly":S(!w);break;case"daily":_(!O);break;case"hourly":k(!C)}},I=e=>{l(e===o?void 0:e)},$=(0,i.useMemo)(()=>C?{arrowIndex:null==D?void 0:D.hourly.index,arrowScope:"hourly"}:O?{arrowIndex:null==D?void 0:D.daily.index,arrowScope:"daily"}:w?{arrowIndex:null==D?void 0:D.monthly.index,arrowScope:"monthly"}:b?{arrowIndex:null==D?void 0:D.yearly.index,arrowScope:"yearly"}:y?{arrowIndex:null==D?void 0:D.decadal.index,arrowScope:"decadal"}:void 0,[y,b,w,O,C,D]);(0,i.useEffect)(()=>{var t,a;M(null!==(t=e.horoscopeDate)&&void 0!==t?t:new Date),P(null!==(a=e.horoscopeHour)&&void 0!==a?a:0)},[e.horoscopeDate,e.horoscopeHour]),(0,i.useEffect)(()=>{x(null!=N?N:new Date,j)},[N,j]),(0,i.useEffect)(()=>{if(t<0)r(void 0);else{const e=(0,f.getPalaceNames)(t);r(e)}},[t]);const A=e=>{a(t===e?-1:e)};return i.default.createElement("div",{className:(0,d.default)("iztro-astrolabe","iztro-astrolabe-theme-default")},null==T?void 0:T.palaces.map(e=>i.default.createElement(c.Izpalace,Object.assign({key:e.earthlyBranch,focusedIndex:p,onFocused:g,horoscope:D,showDecadalScope:y,showYearlyScope:b,showMonthlyScope:w,showDailyScope:O,showHourlyScope:C,taichiPalace:null==n?void 0:n[e.index],toggleScope:H,activeHeavenlyStem:o,toggleActiveHeavenlyStem:I,hoverHeavenlyStem:s,setHoverHeavenlyStem:h,toggleTaichiPoint:A},e))),i.default.createElement(u.IzpalaceCenter,Object.assign({astrolabe:T,horoscope:D,horoscopeDate:N,horoscopeHour:j,setHoroscopeDate:M,setHoroscopeHour:P,centerPalaceAlign:e.centerPalaceAlign},$)))}},4396:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.throttle=t.debounce=t.createLayoutObserver=t.updateLayoutCSSVariables=t.getKeyboardHeight=t.isKeyboardVisible=t.calculateAvailableHeight=t.getSafeAreaInset=t.getLayoutConfig=t.getAndroidNavigationBarHeight=t.isAndroidDevice=t.isMobileDevice=void 0;t.isMobileDevice=()=>/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);t.isAndroidDevice=()=>/Android/i.test(navigator.userAgent);t.getAndroidNavigationBarHeight=()=>{var e;if(!(0,t.isAndroidDevice)())return 0;const a=(0,t.getSafeAreaInset)("bottom"),n=window.screen.height,r=window.innerHeight,o=(null===(e=window.visualViewport)||void 0===e||e.height,n-r),l=window.screen.width,s=window.innerWidth,i=Math.abs(l-s);return a>0?a:o>0&&o<=100?o:o>100?0:i>0?48:0};t.getLayoutConfig=()=>{const e=(0,t.isMobileDevice)();return{isMobile:e,headerHeight:e?60:0,keyboardHeight:0,safeAreaTop:(0,t.getSafeAreaInset)("top"),safeAreaBottom:(0,t.getSafeAreaInset)("bottom")}};t.getSafeAreaInset=e=>{if("undefined"!=typeof CSS&&CSS.supports&&CSS.supports("env","safe-area-inset-top")){const t=getComputedStyle(document.documentElement).getPropertyValue(`env(safe-area-inset-${e})`);return parseInt(t)||0}return 0};t.calculateAvailableHeight=e=>{var t;return((null===(t=window.visualViewport)||void 0===t?void 0:t.height)||window.innerHeight)-e.headerHeight-e.safeAreaTop-e.safeAreaBottom};t.isKeyboardVisible=e=>{var t;if(!e.isMobile)return!1;return((null===(t=window.visualViewport)||void 0===t?void 0:t.height)||window.innerHeight)<.75*window.innerHeight};t.getKeyboardHeight=e=>{var a;if(!(0,t.isKeyboardVisible)(e))return 0;const n=(null===(a=window.visualViewport)||void 0===a?void 0:a.height)||window.innerHeight;return window.innerHeight-n};t.updateLayoutCSSVariables=e=>{const t=document.documentElement;t.style.setProperty("--keyboard-height",`${e.keyboardHeight}px`),t.style.setProperty("--safe-area-top",`${e.safeAreaTop}px`),t.style.setProperty("--safe-area-bottom",`${e.safeAreaBottom}px`),t.style.setProperty("--header-height",`${e.headerHeight}px`)};t.createLayoutObserver=e=>new ResizeObserver(()=>{const a=(0,t.getLayoutConfig)();a.keyboardHeight=(0,t.getKeyboardHeight)(a),(0,t.updateLayoutCSSVariables)(a),e(a)});t.debounce=(e,t)=>{let a;return(...n)=>{clearTimeout(a),a=setTimeout(()=>e.apply(null,n),t)}};t.throttle=(e,t)=>{let a=0;return(...n)=>{const r=Date.now();r-a>=t&&(a=r,e.apply(null,n))}}},4483:function(e,t,a){var n,r=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=n(e),l=0;l<a.length;l++)"default"!==a[l]&&r(t,e,a[l]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ResultContainer=void 0;const s=l(a(6540)),i=a(1231),c=a(5169),u=a(206),d=(0,s.lazy)(()=>Promise.resolve().then(()=>l(a(3957))).then(e=>({default:e.AIChat}))),m=(0,s.lazy)(()=>Promise.resolve().then(()=>l(a(9034)))),f=(0,s.lazy)(()=>Promise.resolve().then(()=>l(a(1974)))),h=({chartMode:e,formData:t,synastryData:a,astrolabe:n,astrolabe1:r,astrolabe2:o,onShowInputPanel:l})=>{const[h,p]=(0,s.useState)("ai"),{createSession:g,sessions:y,activeSessionId:v,switchSession:b}=(0,u.useAIChat)(),E=(0,s.useRef)(!0);(0,s.useEffect)(()=>{if(E.current)return E.current=!1,void(0===y.length&&g());g(),p("ai")},[t,a]);return s.default.createElement("div",{className:"result-section"},s.default.createElement("div",{className:"tab-navigation"},s.default.createElement("div",{className:"tab-navigation-spacer"}),s.default.createElement("div",{className:"tab-navigation-center"},s.default.createElement(c.SegmentedControl,{name:"activeTab",options:[{label:"星盘",value:"astrolabe"},{label:"AI 解读",value:"ai"},{label:"历史",value:"history"}],value:h,onChange:e=>p(e)})),s.default.createElement("div",{className:"tab-navigation-actions"},s.default.createElement("button",{onClick:()=>{g(),p("ai")},className:"new-chat-button","aria-label":"新建记录"},s.default.createElement("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},s.default.createElement("path",{d:"M14.5 2H6C4.89543 2 4 2.89543 4 4V20C4 21.1046 4.89543 22 6 22H18C19.1046 22 20 21.1046 20 20V7.5L14.5 2Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.default.createElement("path",{d:"M14 2V8H20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.default.createElement("path",{d:"M12 18V12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.default.createElement("path",{d:"M9 15H15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))),s.default.createElement(s.Suspense,{fallback:null},s.default.createElement(m,null)))),s.default.createElement("div",{className:"tab-content"},"astrolabe"===h&&s.default.createElement("div",{className:"astrolabe-content"},s.default.createElement("div",{className:"astrolabe-container"},"single"===e?s.default.createElement(i.Iztrolabe,{birthday:`${t.year}-${String(t.month).padStart(2,"0")}-${String(t.day).padStart(2,"0")}`,birthTime:t.birthTime,birthdayType:t.birthdayType,gender:t.gender}):s.default.createElement("div",{className:"synastry-container"},s.default.createElement("div",{className:"synastry-person"},s.default.createElement("h3",null,a.person1.name||"第一个人"),s.default.createElement(i.Iztrolabe,{birthday:`${a.person1.year}-${String(a.person1.month).padStart(2,"0")}-${String(a.person1.day).padStart(2,"0")}`,birthTime:a.person1.birthTime,birthdayType:a.person1.birthdayType,gender:a.person1.gender})),s.default.createElement("div",{className:"synastry-person"},s.default.createElement("h3",null,a.person2.name||"第二个人"),s.default.createElement(i.Iztrolabe,{birthday:`${a.person2.year}-${String(a.person2.month).padStart(2,"0")}-${String(a.person2.day).padStart(2,"0")}`,birthTime:a.person2.birthTime,birthdayType:a.person2.birthdayType,gender:a.person2.gender}))),s.default.createElement("div",{className:"rechart-button-container"},s.default.createElement("button",{onClick:l,className:"rechart-button"},"single"===e?"重新排盘":"重新合盘")))),s.default.createElement("div",{className:"ai-content "+("ai"===h?"visible":"hidden")},s.default.createElement(s.Suspense,{fallback:s.default.createElement("div",{className:"loading-indicator"},"加载AI聊天功能中...")},s.default.createElement(d,{formData:t,astrolabe:"single"===e?n:r,synastryAstrolabe:"synastry"===e?o:void 0,isSynastryMode:"synastry"===e,personNames:{person1:a.person1.name||"第一个人",person2:a.person2.name||"第二个人"},isVisible:"ai"===h&&!!v}))),"history"===h&&s.default.createElement(s.Suspense,{fallback:s.default.createElement("div",{className:"loading-indicator"},"加载历史记录中...")},s.default.createElement(f,{onSelectSession:()=>p("ai")}))))};t.ResultContainer=e=>s.default.createElement(u.AIChatProvider,null,s.default.createElement(h,Object.assign({},e))),t.default=t.ResultContainer},4498:(e,t,a)=>{a.r(t)},4716:function(e,t,a){var n,r=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=n(e),l=0;l<a.length;l++)"default"!==a[l]&&r(t,e,a[l]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0});const s=l(a(6540)),i=s.default.memo(({inputValue:e,onInputChange:t,onSubmit:a,onToggleQuestionPanel:n,onStopGeneration:r,isGenerating:o,isLoading:l,showQuestionPanel:i,inputRef:c,setupInputListeners:u})=>{const[d,m]=(0,s.useState)(!1),[f,h]=(0,s.useState)(!1),[p,g]=(0,s.useState)(!1),[y,v]=(0,s.useState)(0),[b,E]=(0,s.useState)(0),w=(0,s.useMemo)(()=>({isIOSDevice:/iPhone|iPad|iPod/i.test(navigator.userAgent),isAndroidDevice:/Android/i.test(navigator.userAgent),isStandalone:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://")}),[]),S=(0,s.useMemo)(()=>({iosNotchHeight:(()=>{if(!w.isIOSDevice)return 0;const e=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-area-inset-top"))||0;return e>0?Math.max(e,20):0})(),androidNavBarHeight:(()=>{if(!w.isAndroidDevice)return 0;const e=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-area-inset-bottom"))||0,t=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--android-navigation-bar-height"))||0;return Math.max(e,t)})()}),[w]),O=(0,s.useCallback)(e=>{t(e.target.value)},[t]),_=(0,s.useCallback)(()=>{o?r():e.trim()?a(new Event("submit")):n()},[o,e,r,a,n]);return(0,s.useEffect)(()=>{m(w.isStandalone),h(w.isIOSDevice),g(w.isAndroidDevice),E(S.iosNotchHeight),v(S.androidNavBarHeight)},[w,S]),(0,s.useEffect)(()=>{const e=window.matchMedia("(display-mode: standalone)"),t=()=>m(e.matches);e.addEventListener("change",t);const a=new MutationObserver(()=>{if(w.isAndroidDevice){const e=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-area-inset-bottom"))||0,t=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--android-navigation-bar-height"))||0;v(Math.max(e,t))}});return a.observe(document.documentElement,{attributes:!0,attributeFilter:["style"]}),()=>{e.removeEventListener("change",t),a.disconnect()}},[w]),(0,s.useEffect)(()=>{c.current&&u(c.current)},[c,u]),s.default.createElement("form",{className:`chat-input chat-input-form ${d?"pwa-mode":""} ${f?"ios-mode":""} ${p?"android-mode":""}`,onSubmit:a},s.default.createElement("input",{ref:c,type:"text",value:e,onChange:O,placeholder:"输入您的问题...",disabled:l,className:"chat-input-field"}),s.default.createElement("button",{type:o?"button":e.trim()?"submit":"button",onClick:_,disabled:l&&!o,className:"chat-action-button chat-send-button"},o?s.default.createElement("span",{className:"chat-stop-icon"},"■"):e.trim()?s.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"#ffffff",stroke:"#ffffff",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chat-send-icon"},s.default.createElement("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),s.default.createElement("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})):s.default.createElement("span",{className:"chat-toggle-icon"},i?"✕":"+")))});t.default=i},4914:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__exportStar||function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||n(t,e,a)};Object.defineProperty(t,"__esModule",{value:!0}),r(a(521),t)},4930:function(e,t){var a=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,o){function l(e){try{i(n.next(e))}catch(e){o(e)}}function s(e){try{i(n.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(l,s)}i((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.CloudStorageService=void 0;class n{static initialize(){}static isAuth(){return"true"===localStorage.getItem(this.CLOUD_ENABLED_KEY)}static authenticate(e){return a(this,void 0,void 0,function*(){try{return e===this.CLOUD_PASSWORD?(localStorage.setItem(this.CLOUD_ENABLED_KEY,"true"),!0):(localStorage.removeItem(this.CLOUD_ENABLED_KEY),!1)}catch(e){return!1}})}static clearAuthentication(){localStorage.removeItem(this.CLOUD_ENABLED_KEY)}static uploadHistoryItem(e){return a(this,void 0,void 0,function*(){if(!this.isAuth())throw new Error("未认证，请先输入密码");try{const t=yield fetch(`${this.WORKER_URL}/api/history/item`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.CLOUD_PASSWORD}`},body:JSON.stringify({item:e})});if(!t.ok)throw new Error(`上传失败: ${t.status} ${t.statusText}`);return(yield t.json()).success}catch(e){throw e}})}static downloadHistoryItem(e){return a(this,void 0,void 0,function*(){if(!this.isAuth())throw new Error("未认证，请先输入密码");try{const t=yield fetch(`${this.WORKER_URL}/api/history/item/${e}`,{method:"GET",headers:{Authorization:`Bearer ${this.CLOUD_PASSWORD}`}});if(!t.ok)throw new Error(`下载失败: ${t.status} ${t.statusText}`);return(yield t.json()).item}catch(e){throw e}})}static deleteHistoryItem(e){return a(this,void 0,void 0,function*(){if(!this.isAuth())throw new Error("未认证，请先输入密码");try{const t=yield fetch(`${this.WORKER_URL}/api/history/item/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${this.CLOUD_PASSWORD}`}});if(!t.ok)throw new Error(`删除失败: ${t.status} ${t.statusText}`);return(yield t.json()).success}catch(e){throw e}})}static getHistoryIds(){return a(this,void 0,void 0,function*(){if(!this.isAuth())throw new Error("未认证，请先输入密码");try{const e=yield fetch(`${this.WORKER_URL}/api/history/ids`,{method:"GET",headers:{Authorization:`Bearer ${this.CLOUD_PASSWORD}`}});if(!e.ok)throw new Error(`获取ID列表失败: ${e.status} ${e.statusText}`);return(yield e.json()).ids||[]}catch(e){throw e}})}static batchDownloadHistoryItems(e){return a(this,void 0,void 0,function*(){if(!this.isAuth())throw new Error("未认证，请先输入密码");try{const t=yield fetch(`${this.WORKER_URL}/api/history/batch`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.CLOUD_PASSWORD}`},body:JSON.stringify({ids:e})});if(!t.ok)throw new Error(`批量下载失败: ${t.status} ${t.statusText}`);return(yield t.json()).items||[]}catch(e){throw e}})}static clearAllHistory(){return a(this,void 0,void 0,function*(){if(!this.isAuth())throw new Error("未认证，请先输入密码");try{const e=yield fetch(`${this.WORKER_URL}/api/history/clear`,{method:"DELETE",headers:{Authorization:`Bearer ${this.CLOUD_PASSWORD}`}});if(!e.ok)throw new Error(`清空失败: ${e.status} ${e.statusText}`);return(yield e.json()).success}catch(e){throw e}})}static isOnline(){return a(this,void 0,void 0,function*(){try{yield fetch(`${this.WORKER_URL}/api/health`,{method:"GET",mode:"no-cors",cache:"no-cache"});return!0}catch(e){return!1}})}}t.CloudStorageService=n,n.WORKER_URL="https://ziwei.sydf.cc",n.CLOUD_PASSWORD="ovo",n.CLOUD_ENABLED_KEY="iztro_cloud_enabled"},5069:function(e,t,a){var n,r=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=n(e),l=0;l<a.length;l++)"default"!==a[l]&&r(t,e,a[l]);return o(t,e),t}),s=this&&this.__rest||function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Izpalace=void 0;const c=l(a(6540)),u=i(a(2485));a(3186);const d=a(4914),m=a(3914),f=a(1887);t.Izpalace=e=>{var t,a,n,r,{index:o,taichiPalace:l,focusedIndex:i,onFocused:h,horoscope:p,activeHeavenlyStem:g,toggleActiveHeavenlyStem:y,hoverHeavenlyStem:v,setHoverHeavenlyStem:b,showDecadalScope:E=!1,showYearlyScope:w=!1,showMonthlyScope:S=!1,showDailyScope:O=!1,showHourlyScope:_=!1,toggleScope:C,toggleTaichiPoint:k}=e,N=s(e,["index","taichiPalace","focusedIndex","onFocused","horoscope","activeHeavenlyStem","toggleActiveHeavenlyStem","hoverHeavenlyStem","setHoverHeavenlyStem","showDecadalScope","showYearlyScope","showMonthlyScope","showDailyScope","showHourlyScope","toggleScope","toggleTaichiPoint"]);const M=(0,c.useMemo)(()=>{const e=[];return(null==p?void 0:p.decadal.index)===o&&e.push(Object.assign(Object.assign({},p.decadal),{scope:"decadal",show:E})),(null==p?void 0:p.yearly.index)===o&&e.push(Object.assign(Object.assign({},p.yearly),{scope:"yearly",show:w})),(null==p?void 0:p.monthly.index)===o&&e.push(Object.assign(Object.assign({},p.monthly),{scope:"monthly",show:S})),(null==p?void 0:p.daily.index)===o&&e.push(Object.assign(Object.assign({},p.daily),{scope:"daily",show:O})),(null==p?void 0:p.hourly.index)===o&&e.push(Object.assign(Object.assign({},p.hourly),{scope:"hourly",show:_})),(null==p?void 0:p.age.index)===o&&e.push({name:p.age.name,heavenlyStem:void 0,scope:"age",show:!1}),e},[p,E,w,S,O,_]),j=(0,c.useMemo)(()=>p?[{mutagen:p.decadal.mutagen,scope:"decadal",show:E},{mutagen:p.yearly.mutagen,scope:"yearly",show:w},{mutagen:p.monthly.mutagen,scope:"monthly",show:S},{mutagen:p.daily.mutagen,scope:"daily",show:O},{mutagen:p.hourly.mutagen,scope:"hourly",show:_}]:[],[p,E,w,S,O,_]);return c.default.createElement("div",{className:(0,u.default)(`iztro-palace g${o}`,{"focused-palace":i===o,"opposite-palace":null!=i&&o===(0,f.fixIndex)(i+6),"surrounded-palace":null!=i&&(o===(0,f.fixIndex)(i+4)||o===(0,f.fixIndex)(i-4))}),onMouseEnter:()=>null==h?void 0:h(o),onMouseLeave:()=>null==h?void 0:h(void 0)},c.default.createElement("div",{className:(0,u.default)("iztro-palace-major")},N.majorStars.map(e=>c.default.createElement(d.Izstar,Object.assign({key:e.name,activeHeavenlyStem:g,hoverHeavenlyStem:v,palaceHeavenlyStem:(0,m.kot)(N.heavenlyStem,"Heavenly"),horoscopeMutagens:j},e)))),c.default.createElement("div",{className:(0,u.default)("iztro-palace-minor")},N.minorStars.map(e=>c.default.createElement(d.Izstar,Object.assign({key:e.name,activeHeavenlyStem:g,hoverHeavenlyStem:v,palaceHeavenlyStem:(0,m.kot)(N.heavenlyStem,"Heavenly"),horoscopeMutagens:j},e)))),c.default.createElement("div",{className:(0,u.default)("iztro-palace-adj")},c.default.createElement("div",null,N.adjectiveStars.slice(5).map(e=>c.default.createElement(d.Izstar,Object.assign({key:e.name},e)))),c.default.createElement("div",null,N.adjectiveStars.slice(0,5).map(e=>c.default.createElement(d.Izstar,Object.assign({key:e.name},e))))),c.default.createElement("div",{className:(0,u.default)("iztro-palace-horo-star")},c.default.createElement("div",{className:(0,u.default)("stars")},(null===(t=null==p?void 0:p.decadal)||void 0===t?void 0:t.stars)&&(null===(a=null==p?void 0:p.decadal)||void 0===a?void 0:a.stars[o].map(e=>c.default.createElement(d.Izstar,Object.assign({key:e.name},e))))),c.default.createElement("div",{className:(0,u.default)("stars")},(null===(n=null==p?void 0:p.yearly)||void 0===n?void 0:n.stars)&&(null===(r=null==p?void 0:p.yearly)||void 0===r?void 0:r.stars[o].map(e=>c.default.createElement(d.Izstar,Object.assign({key:e.name},e)))))),c.default.createElement("div",{className:(0,u.default)("iztro-palace-fate")},null==M?void 0:M.map(e=>c.default.createElement("span",{key:e.name,className:(0,u.default)({[`iztro-palace-${e.scope}-active`]:e.show}),onClick:e.scope?()=>null==C?void 0:C(e.scope):void 0},e.name,e.heavenlyStem&&`·${e.heavenlyStem}`))),c.default.createElement("div",{className:(0,u.default)("iztro-palace-footer")},c.default.createElement("div",null,c.default.createElement("div",{className:(0,u.default)("iztro-palace-lft24")},c.default.createElement("div",null,N.changsheng12),c.default.createElement("div",null,N.boshi12)),c.default.createElement("div",{className:(0,u.default)("iztro-palace-name"),onClick:()=>null==k?void 0:k(o)},c.default.createElement("span",{className:"iztro-palace-name-wrapper"},N.name,c.default.createElement("span",{className:"iztro-palace-name-taichi"},l&&((0,m.kot)(l)===(0,m.kot)("命宫")?"☯":l))),N.isBodyPalace&&c.default.createElement("span",{className:(0,u.default)("iztro-palace-name-body")},"·",(0,m.t)("bodyPalace")))),c.default.createElement("div",null,c.default.createElement("div",{className:(0,u.default)("iztro-palace-scope")},c.default.createElement("div",{className:(0,u.default)("iztro-palace-scope-age")},N.ages.slice(0,7).join(" ")),c.default.createElement("div",{className:(0,u.default)("iztro-palace-scope-decadal")},N.decadal.range.join(" - "))),c.default.createElement("div",{className:(0,u.default)("iztro-palace-dynamic-name")},E&&c.default.createElement("span",{className:"iztro-palace-dynamic-name-decadal"},null==p?void 0:p.decadal.palaceNames[o]),w&&c.default.createElement("span",{className:"iztro-palace-dynamic-name-yearly"},null==p?void 0:p.yearly.palaceNames[o]),S&&c.default.createElement("span",{className:"iztro-palace-dynamic-name-monthly"},null==p?void 0:p.monthly.palaceNames[o]),O&&c.default.createElement("span",{className:"iztro-palace-dynamic-name-daily"},null==p?void 0:p.daily.palaceNames[o]),_&&c.default.createElement("span",{className:"iztro-palace-dynamic-name-hourly"},null==p?void 0:p.hourly.palaceNames[o]))),c.default.createElement("div",null,c.default.createElement("div",{className:(0,u.default)("iztro-palace-rgt24")},c.default.createElement("div",null,w?null==p?void 0:p.yearly.yearlyDecStar.suiqian12[o]:N.suiqian12),c.default.createElement("div",null,w?null==p?void 0:p.yearly.yearlyDecStar.jiangqian12[o]:N.jiangqian12)),c.default.createElement("div",{className:(0,u.default)("iztro-palace-gz",{"iztro-palace-gz-active":g===(0,m.kot)(N.heavenlyStem,"Heavenly")}),onClick:()=>null==y?void 0:y((0,m.kot)(N.heavenlyStem,"Heavenly")),onMouseEnter:()=>null==b?void 0:b((0,m.kot)(N.heavenlyStem,"Heavenly")),onMouseLeave:()=>null==b?void 0:b(void 0)},c.default.createElement("span",{className:(0,u.default)({"iztro-palace-gz-active":g===(0,m.kot)(N.heavenlyStem,"Heavenly")})},N.heavenlyStem,N.earthlyBranch)))))}},5169:function(e,t,a){var n,r=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=n(e),l=0;l<a.length;l++)"default"!==a[l]&&r(t,e,a[l]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.SegmentedControl=void 0;const s=l(a(6540));a(3186);t.SegmentedControl=({name:e,options:t,value:a,onChange:n})=>{const r=(0,s.useRef)(null),o=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!r.current)return;const e=r.current.querySelector(".segmented-control-input:checked");if(!e)return;const t=e.nextElementSibling;if(!t||!o.current)return;const a=()=>{const e=t.getBoundingClientRect(),a=r.current.getBoundingClientRect();o.current.style.width=`${e.width}px`,o.current.style.left=e.left-a.left+"px",o.current.style.opacity="1"};a();const n=requestAnimationFrame(a),l=new ResizeObserver(()=>{a()});return l.observe(r.current),()=>{cancelAnimationFrame(n),l.disconnect()}},[a,t]);const l=e=>t=>{t.preventDefault(),t.stopPropagation(),n(e)};return s.default.createElement("div",{className:"segmented-control",ref:r,onTouchStart:e=>{e.touches.length>1&&e.preventDefault(),e.stopPropagation();const t=e.touches[0];e.currentTarget.dataset.touchStartX=t.clientX.toString(),e.currentTarget.dataset.touchStartY=t.clientY.toString()},onTouchMove:e=>{e.touches.length>1&&e.preventDefault();const t=parseFloat(e.currentTarget.dataset.touchStartX||"0"),a=parseFloat(e.currentTarget.dataset.touchStartY||"0"),n=e.touches[0],r=Math.abs(n.clientX-t),o=Math.abs(n.clientY-a);(r>5||o>5)&&e.preventDefault(),e.stopPropagation()},onTouchEnd:e=>{e.stopPropagation(),delete e.currentTarget.dataset.touchStartX,delete e.currentTarget.dataset.touchStartY}},s.default.createElement("div",{className:"segmented-control-slider",ref:o}),t.map(t=>s.default.createElement("label",{key:t.value,className:"segmented-control-label"},s.default.createElement("input",{type:"radio",name:e,value:t.value,checked:a===t.value,onChange:()=>n(t.value),className:"segmented-control-input"}),s.default.createElement("span",{className:"segmented-control-button",onClick:l(t.value),onTouchEnd:l(t.value)},t.label))))}},5246:(e,t,a)=>{a.r(t)},5539:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(a(6540));t.default=({questionCategories:e,activeQuestionTab:t,onTabChange:a,onQuestionClick:n,showQuestionPanel:o})=>{if(!o)return null;const l=e.find(e=>e.name===t);return r.default.createElement("div",{className:"question-panel"},r.default.createElement("div",{className:"question-tabs"},e.map(e=>r.default.createElement("button",{key:e.name,className:"tab-button question-tab-button "+(t===e.name?"active":""),onClick:()=>a(e.name)},e.name))),r.default.createElement("div",{className:"question-content"},null==l?void 0:l.subCategories.map(e=>r.default.createElement("div",{key:e.name,className:"question-group"},r.default.createElement("h4",{className:"category-heading"},e.name),r.default.createElement("div",{className:"questions-wrapper"},e.questions.map((e,t)=>r.default.createElement("p",{key:t,onClick:()=>n(e),className:"question-text"},e)))))))}},5898:function(e,t,a){var n,r=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=n(e),l=0;l<a.length;l++)"default"!==a[l]&&r(t,e,a[l]);return o(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=l(a(6540)),c=s(a(2113)),u=i.default.memo(({message:e,isLastMessage:t=!1,showRegenerate:a=!1,onRegenerate:n,messageRef:r,isStreaming:o=!1,showActions:l=!1})=>{const s="user"===e.role,[u,d]=(0,i.useState)(""),[m,f]=(0,i.useState)(!1),h=(0,i.useRef)(null),p=(0,i.useCallback)(()=>{navigator.clipboard.writeText(e.content).then(()=>{}).catch(e=>{})},[e.content]),g=(0,i.useCallback)(()=>{if(navigator.share){const t={title:"紫微斗数AI回复",text:e.content};navigator.share(t).catch(e=>{p()})}else p()},[e.content,p]),y=(0,i.useMemo)(()=>l&&!o&&!s&&m,[l,o,s,m]);return(0,i.useEffect)(()=>{d(e.content),!s&&o&&f(!0)},[e.content,s,o]),i.default.createElement("div",{ref:r,className:"message-item "+(s?"user-message":"assistant-message")},i.default.createElement("div",{className:"message-wrapper "+(s?"user-message":"assistant-message")},i.default.createElement("div",{className:"message-content "+(s?"user-message":"assistant-message")},s?u:i.default.createElement("div",{ref:h,className:"markdown-content message-markdown"},i.default.createElement(c.default,{content:u}))),a&&i.default.createElement(i.default.Fragment,null,i.default.createElement("div",{className:"message-spacer"}),i.default.createElement("div",{className:"regenerate-container"},i.default.createElement("button",{className:"regenerate-button quick-action-button",onClick:n,title:"重新生成"},i.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},i.default.createElement("path",{d:"M1 4v6h6"}),i.default.createElement("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})),i.default.createElement("span",null,"重新生成")))),y&&i.default.createElement(i.default.Fragment,null,i.default.createElement("div",{className:"message-spacer"}),i.default.createElement("div",{className:"message-actions-container"},i.default.createElement("button",{className:"copy-button",onClick:p,title:"复制","aria-label":"复制"},i.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},i.default.createElement("rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}),i.default.createElement("path",{d:"m4 16c-1.1 0-2-.9-2-2v-10c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"}))),i.default.createElement("button",{className:"share-button",onClick:g,title:"分享","aria-label":"分享"},i.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},i.default.createElement("circle",{cx:"18",cy:"5",r:"3"}),i.default.createElement("circle",{cx:"6",cy:"12",r:"3"}),i.default.createElement("circle",{cx:"18",cy:"19",r:"3"}),i.default.createElement("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),i.default.createElement("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})))))))});t.default=u},6133:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.formatAstrolabeForAI=void 0;const a=e=>e&&0!==e.length?e.join("、"):"无";t.formatAstrolabeForAI=(e,t=new Date,n)=>{if(!e)return"暂无星盘数据";let r=`\n=== 紫微斗数星盘数据 ===\n当前时间：${t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}\n\n基本信息：\n性别：${n}\n阳历日期：${e.solarDate}\n农历日期：${e.lunarDate}\n干支纪年：${e.chineseDate}\n出生时辰：${e.time}（${e.timeRange}）\n星座：${e.sign}\n生肖：${e.zodiac}\n命宫地支：${e.earthlyBranchOfSoulPalace}\n身宫地支：${e.earthlyBranchOfBodyPalace}\n命主：${e.soul}\n身主：${e.body}\n五行局：${e.fiveElementsClass}\n\n十二宫位详情：\n`;if(e.palaces&&e.palaces.length>0&&e.palaces.forEach((e,t)=>{r+=`\n--- 第${t+1}宫 ---\n`,r+=(e=>{var t,n,r,o,l,s,i,c;const u=(null===(t=e.majorStars)||void 0===t?void 0:t.map(e=>e.name))||[],d=(null===(n=e.minorStars)||void 0===n?void 0:n.map(e=>e.name))||[],m=(null===(r=e.adjectiveStars)||void 0===r?void 0:r.map(e=>e.name))||[];return`\n宫位：${e.name}\n天干地支：${e.heavenlyStem}${e.earthlyBranch}\n主星：${a(u)}\n辅星：${a(d)}\n杂耀：${a(m)}\n长生12神：${e.changsheng12||"无"}\n博士12神：${e.boshi12||"无"}\n将前12神：${e.jiangqian12||"无"}\n岁前12神：${e.suiqian12||"无"}\n大限：${null===(l=null===(o=e.decadal)||void 0===o?void 0:o.range)||void 0===l?void 0:l[0]}-${null===(i=null===(s=e.decadal)||void 0===s?void 0:s.range)||void 0===i?void 0:i[1]}岁\n小限：${(null===(c=e.ages)||void 0===c?void 0:c.join("、"))||"无"}\n${e.isBodyPalace?"【身宫】":""}\n${e.isOriginalPalace?"【来因宫】":""}\n  `.trim()})(e),r+="\n\n"}),e.horoscope){const t=e.horoscope();t&&(r+=`\n=== 当前运限信息 ===\n查询日期：${t.solarDate}\n农历日期：${t.lunarDate}\n\n大限：\n天干地支：${t.decadal.heavenlyStem}${t.decadal.earthlyBranch}\n四化星：${a(t.decadal.mutagen||[])}\n\n小限：\n虚岁：${t.age.nominalAge}\n天干地支：${t.age.heavenlyStem}${t.age.earthlyBranch}\n\n流年：\n天干地支：${t.yearly.heavenlyStem}${t.yearly.earthlyBranch}\n四化星：${a(t.yearly.mutagen||[])}\n\n流月：\n天干地支：${t.monthly.heavenlyStem}${t.monthly.earthlyBranch}\n\n流日：\n天干地支：${t.daily.heavenlyStem}${t.daily.earthlyBranch}\n\n流时：\n天干地支：${t.hourly.heavenlyStem}${t.hourly.earthlyBranch}\n`)}return r.trim()}},6755:function(e,t,a){var n,r=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=n(e),l=0;l<a.length;l++)"default"!==a[l]&&r(t,e,a[l]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.Line=void 0;const s=l(a(6540)),i=a(1887);t.Line=({index:e,scope:t})=>{const a=(0,s.useRef)(null),n=(0,s.useMemo)(()=>{if(t){const e=document.getElementsByClassName("iztro-astrolabe-theme-default")[0];return getComputedStyle(e).getPropertyValue(`--iztro-color-${t}`)}return"rgba(245,0,0)"},[t]);return(0,s.useEffect)(()=>{const t=e,r=a.current;if(!r||t<0)return;const{height:o,width:l}=r.getBoundingClientRect();r.width=l,r.height=o;const s=l/2,c=o/2,u=[[0,2*c],[0,1.5*c],[0,.5*c],[0,0],[.5*s,0],[1.5*s,0],[2*s,0],[2*s,.5*c],[2*s,1.5*c],[2*s,2*c],[1.5*s,2*c],[.5*s,2*c]],d=r.getContext("2d");if(!d)return;d.clearRect(0,0,r.width,r.height),d.strokeStyle=n,d.lineWidth=1,d.globalAlpha=.5;const m=(0,i.fixIndex)(t+6),f=(0,i.fixIndex)(t+4),h=(0,i.fixIndex)(t-4);d.beginPath(),d.moveTo(u[m][0],u[m][1]),d.lineTo(u[t][0],u[t][1]),d.lineTo(u[f][0],u[f][1]),d.lineTo(u[h][0],u[h][1]),d.lineTo(u[t][0],u[t][1]),d.stroke()},[e,n]),s.default.createElement("canvas",{id:"palace-line",className:`palace-line ${t||""}`,ref:a})}},7076:function(e,t,a){var n,r=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=n(e),l=0;l<a.length;l++)"default"!==a[l]&&r(t,e,a[l]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0});const s=l(a(6540));t.default=s.default.memo(({history:e,showHistoryModal:t,setShowHistoryModal:a,searchTerm:n,setSearchTerm:r,showPasswordInput:o,setShowPasswordInput:l,password:i,setPassword:c,isCloudStorageEnabled:u,isLoading:d,editingHistoryId:m,setEditingHistoryId:f,handlePasswordSubmit:h,handleDeleteHistory:p,handleClearHistory:g,onLoadHistory:y,onEditHistory:v,chartMode:b})=>{const E=(0,s.useCallback)(e=>{"Enter"===e.key&&h()},[h]);return t?s.default.createElement("div",{className:"history-modal-overlay",onClick:()=>a(!1)},s.default.createElement("div",{className:"history-modal",onClick:e=>e.stopPropagation()},s.default.createElement("div",{className:"history-modal-header"},s.default.createElement("h2",{className:"history-title",title:u?"云存储已启用":"点击输入密码启用云存储",onClick:()=>!u&&l(!o)},"历史记录 ",u&&"☁️")),o&&s.default.createElement("div",{className:"history-password-container"},s.default.createElement("input",{type:"password",className:"history-password-input",placeholder:"输入云存储密码",value:i,onChange:e=>c(e.target.value),onKeyDown:E,disabled:d}),s.default.createElement("button",{className:"history-password-button",onClick:h,disabled:d||!i.trim()},d?"验证中...":"确认")),s.default.createElement("div",{className:"history-search-container"},s.default.createElement("input",{type:"text",className:"history-search-input",placeholder:"搜索历史记录...",value:n,onChange:e=>r(e.target.value)})),s.default.createElement("div",{className:"history-modal-content"},0===e.length?s.default.createElement("div",{className:"history-empty"},"暂无历史记录"):s.default.createElement("div",{className:"history-list"},e.filter(e=>e.type===b).map(e=>{var t;return s.default.createElement("div",{key:e.id,className:"history-item"},s.default.createElement("div",{className:"history-item-content",onClick:()=>{y(e),a(!1)}},s.default.createElement("div",{className:"history-item-main"},s.default.createElement("span",{className:"history-item-name"},"single"===e.type?e.name:`${e.name} 和 ${(null===(t=e.person2)||void 0===t?void 0:t.name)||"第二个人"}`),s.default.createElement("span",{className:"history-item-info"},e.year,"-",e.month,"-",e.day)),s.default.createElement("div",{className:"history-item-actions"},s.default.createElement("button",{className:"history-action-button history-edit-icon",onClick:t=>{t.stopPropagation(),v(e),f(e.id),a(!1)},title:"编辑"},s.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},s.default.createElement("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),s.default.createElement("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"}))),s.default.createElement("button",{className:"history-action-button history-delete-icon",onClick:t=>{t.stopPropagation(),confirm("确定要删除这条历史记录吗？")&&p(e.id)},title:"删除"},s.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},s.default.createElement("polyline",{points:"3 6 5 6 21 6"}),s.default.createElement("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),s.default.createElement("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),s.default.createElement("line",{x1:"14",y1:"11",x2:"14",y2:"17"}))))))}))),s.default.createElement("div",{className:"history-modal-footer"},s.default.createElement("button",{className:"history-clear-button",onClick:g,disabled:u,title:u?"云存储已启用，无法清空历史记录":"清空所有历史记录"},"清空历史记录")))):null})},7256:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FormContainer=void 0;const r=n(a(6540)),o=a(5169);t.FormContainer=({chartMode:e,setChartMode:t,formData:a,synastryData:n,onFormChange:l,onSynastryChange:s,onRadioChange:i,onSynastryRadioChange:c,onSubmit:u,onSynastrySubmit:d,onShowHistory:m})=>{const f=e=>{const{name:t,value:n}=e.target;l(Object.assign(Object.assign({},a),{[t]:"birthTime"===t?parseInt(n):n}))},h=(e,t)=>{const{name:a,value:r}=t.target;s(e,Object.assign(Object.assign({},n[e]),{[a]:"birthTime"===a?parseInt(r):r}))};return r.default.createElement("div",{className:"form-section"},r.default.createElement("div",{className:"form-group form-group-segmented"},r.default.createElement(o.SegmentedControl,{name:"chartMode",options:[{label:"排盘",value:"single"},{label:"合盘",value:"synastry"}],value:e,onChange:e=>t(e)})),"single"===e&&r.default.createElement("form",{onSubmit:u},r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{htmlFor:"name"},"姓名（可选）"),r.default.createElement("input",{type:"text",id:"name",name:"name",value:a.name,onChange:f})),r.default.createElement("div",{className:"form-group-inline form-group-inline-mobile gender-date"},r.default.createElement("div",{className:"form-group"},r.default.createElement("label",null,"性别"),r.default.createElement(o.SegmentedControl,{name:"gender",options:[{label:"男",value:"male"},{label:"女",value:"female"}],value:a.gender,onChange:e=>i("gender",e)})),r.default.createElement("div",{className:"form-group"},r.default.createElement("label",null,"日期类型"),r.default.createElement(o.SegmentedControl,{name:"birthdayType",options:[{label:"阳历",value:"solar"},{label:"农历",value:"lunar"}],value:a.birthdayType,onChange:e=>i("birthdayType",e)}))),r.default.createElement("div",{className:"form-group-inline form-group-inline-mobile date-fields"},r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{htmlFor:"year"},"年"),r.default.createElement("input",{type:"number",id:"year",name:"year",value:a.year,onChange:f,min:"1900",max:"2100"})),r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{htmlFor:"month"},"月"),r.default.createElement("input",{type:"number",id:"month",name:"month",value:a.month,onChange:f,min:"1",max:"12"})),r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{htmlFor:"day"},"日"),r.default.createElement("input",{type:"number",id:"day",name:"day",value:a.day,onChange:f,min:"1",max:"31"}))),r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{htmlFor:"birthTime"},"出生时辰"),r.default.createElement("select",{id:"birthTime",name:"birthTime",value:a.birthTime,onChange:f},r.default.createElement("option",{value:0},"早子时(00:00~01:00)"),r.default.createElement("option",{value:1},"丑时(01:00~03:00)"),r.default.createElement("option",{value:2},"寅时(03:00~05:00)"),r.default.createElement("option",{value:3},"卯时(05:00~07:00)"),r.default.createElement("option",{value:4},"辰时(07:00~09:00)"),r.default.createElement("option",{value:5},"巳时(09:00~11:00)"),r.default.createElement("option",{value:6},"午时(11:00~13:00)"),r.default.createElement("option",{value:7},"未时(13:00~15:00)"),r.default.createElement("option",{value:8},"申时(15:00~17:00)"),r.default.createElement("option",{value:9},"酉时(17:00~19:00)"),r.default.createElement("option",{value:10},"戌时(19:00~21:00)"),r.default.createElement("option",{value:11},"亥时(21:00~23:00)"),r.default.createElement("option",{value:12},"晚子时(23:00~00:00)"))),r.default.createElement("button",{type:"submit"},"开始排盘"),r.default.createElement("button",{type:"button",className:"history-button",onClick:m},"历史记录")),"synastry"===e&&r.default.createElement("form",{onSubmit:d},r.default.createElement("div",{className:"form-group"},r.default.createElement("h3",null,"第一个人")),r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{htmlFor:"person1-name"},"姓名（可选）"),r.default.createElement("input",{type:"text",id:"person1-name",name:"name",value:n.person1.name,onChange:e=>h("person1",e)})),r.default.createElement("div",{className:"form-group-inline form-group-inline-mobile gender-date"},r.default.createElement("div",{className:"form-group"},r.default.createElement("label",null,"性别"),r.default.createElement(o.SegmentedControl,{name:"person1-gender",options:[{label:"男",value:"male"},{label:"女",value:"female"}],value:n.person1.gender,onChange:e=>c("person1","gender",e)})),r.default.createElement("div",{className:"form-group"},r.default.createElement("label",null,"日期类型"),r.default.createElement(o.SegmentedControl,{name:"person1-birthdayType",options:[{label:"阳历",value:"solar"},{label:"农历",value:"lunar"}],value:n.person1.birthdayType,onChange:e=>c("person1","birthdayType",e)}))),r.default.createElement("div",{className:"form-group-inline form-group-inline-mobile date-fields"},r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{htmlFor:"person1-year"},"年"),r.default.createElement("input",{type:"number",id:"person1-year",name:"year",value:n.person1.year,onChange:e=>h("person1",e),min:"1900",max:"2100"})),r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{htmlFor:"person1-month"},"月"),r.default.createElement("input",{type:"number",id:"person1-month",name:"month",value:n.person1.month,onChange:e=>h("person1",e),min:"1",max:"12"})),r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{htmlFor:"person1-day"},"日"),r.default.createElement("input",{type:"number",id:"person1-day",name:"day",value:n.person1.day,onChange:e=>h("person1",e),min:"1",max:"31"}))),r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{htmlFor:"person1-birthTime"},"出生时辰"),r.default.createElement("select",{id:"person1-birthTime",name:"birthTime",value:n.person1.birthTime,onChange:e=>h("person1",e)},r.default.createElement("option",{value:0},"早子时(00:00~01:00)"),r.default.createElement("option",{value:1},"丑时(01:00~03:00)"),r.default.createElement("option",{value:2},"寅时(03:00~05:00)"),r.default.createElement("option",{value:3},"卯时(05:00~07:00)"),r.default.createElement("option",{value:4},"辰时(07:00~09:00)"),r.default.createElement("option",{value:5},"巳时(09:00~11:00)"),r.default.createElement("option",{value:6},"午时(11:00~13:00)"),r.default.createElement("option",{value:7},"未时(13:00~15:00)"),r.default.createElement("option",{value:8},"申时(15:00~17:00)"),r.default.createElement("option",{value:9},"酉时(17:00~19:00)"),r.default.createElement("option",{value:10},"戌时(19:00~21:00)"),r.default.createElement("option",{value:11},"亥时(21:00~23:00)"),r.default.createElement("option",{value:12},"晚子时(23:00~00:00)"))),r.default.createElement("div",{className:"form-group"},r.default.createElement("h3",null,"第二个人")),r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{htmlFor:"person2-name"},"姓名（可选）"),r.default.createElement("input",{type:"text",id:"person2-name",name:"name",value:n.person2.name,onChange:e=>h("person2",e)})),r.default.createElement("div",{className:"form-group-inline form-group-inline-mobile gender-date"},r.default.createElement("div",{className:"form-group"},r.default.createElement("label",null,"性别"),r.default.createElement(o.SegmentedControl,{name:"person2-gender",options:[{label:"男",value:"male"},{label:"女",value:"female"}],value:n.person2.gender,onChange:e=>c("person2","gender",e)})),r.default.createElement("div",{className:"form-group"},r.default.createElement("label",null,"日期类型"),r.default.createElement(o.SegmentedControl,{name:"person2-birthdayType",options:[{label:"阳历",value:"solar"},{label:"农历",value:"lunar"}],value:n.person2.birthdayType,onChange:e=>c("person2","birthdayType",e)}))),r.default.createElement("div",{className:"form-group-inline form-group-inline-mobile date-fields"},r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{htmlFor:"person2-year"},"年"),r.default.createElement("input",{type:"number",id:"person2-year",name:"year",value:n.person2.year,onChange:e=>h("person2",e),min:"1900",max:"2100"})),r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{htmlFor:"person2-month"},"月"),r.default.createElement("input",{type:"number",id:"person2-month",name:"month",value:n.person2.month,onChange:e=>h("person2",e),min:"1",max:"12"})),r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{htmlFor:"person2-day"},"日"),r.default.createElement("input",{type:"number",id:"person2-day",name:"day",value:n.person2.day,onChange:e=>h("person2",e),min:"1",max:"31"}))),r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{htmlFor:"person2-birthTime"},"出生时辰"),r.default.createElement("select",{id:"person2-birthTime",name:"birthTime",value:n.person2.birthTime,onChange:e=>h("person2",e)},r.default.createElement("option",{value:0},"早子时(00:00~01:00)"),r.default.createElement("option",{value:1},"丑时(01:00~03:00)"),r.default.createElement("option",{value:2},"寅时(03:00~05:00)"),r.default.createElement("option",{value:3},"卯时(05:00~07:00)"),r.default.createElement("option",{value:4},"辰时(07:00~09:00)"),r.default.createElement("option",{value:5},"巳时(09:00~11:00)"),r.default.createElement("option",{value:6},"午时(11:00~13:00)"),r.default.createElement("option",{value:7},"未时(13:00~15:00)"),r.default.createElement("option",{value:8},"申时(15:00~17:00)"),r.default.createElement("option",{value:9},"酉时(17:00~19:00)"),r.default.createElement("option",{value:10},"戌时(19:00~21:00)"),r.default.createElement("option",{value:11},"亥时(21:00~23:00)"),r.default.createElement("option",{value:12},"晚子时(23:00~00:00)"))),r.default.createElement("button",{type:"submit"},"开始合盘"),r.default.createElement("button",{type:"button",className:"history-button",onClick:m},"历史记录")))},t.default=t.FormContainer},7314:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(a(6540));t.default=()=>r.default.createElement("div",{className:"typing-indicator"},r.default.createElement("span",{className:"typing-dot"}),r.default.createElement("span",{className:"typing-dot"}),r.default.createElement("span",{className:"typing-dot"}))},7362:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,o){function l(e){try{i(n.next(e))}catch(e){o(e)}}function s(e){try{i(n.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(l,s)}i((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.useAIChatRequest=t.useNetworkRequest=void 0;const r=a(6540);t.useNetworkRequest=(e={})=>{const{cacheKey:t,cacheTTL:a=3e5,maxRetries:o=2,retryDelay:l=1e3,retryBackoff:s=2}=e,[i,c]=(0,r.useState)(!1),[u,d]=(0,r.useState)(null),m=(0,r.useRef)(null),f=(0,r.useRef)(new Map),h=(0,r.useCallback)(e=>Date.now()-e.timestamp<a,[a]),p=(0,r.useCallback)(e=>{if(!t)return null;const a=`${t}:${e}`,n=f.current.get(a);return n&&h(n)?n.data:null},[t,h]),g=(0,r.useCallback)((e,a)=>{if(!t)return;const n=`${t}:${e}`;f.current.set(n,{data:a,timestamp:Date.now()})},[t]),y=(0,r.useCallback)(()=>{if(!t)return;const e=Array.from(f.current.keys());for(const a of e)a.startsWith(`${t}:`)&&f.current.delete(a)},[t]),v=(0,r.useCallback)(e=>new Promise(t=>setTimeout(t,e)),[]),b=(0,r.useCallback)((e,t)=>n(void 0,void 0,void 0,function*(){const{url:a,options:r={},body:i}=e,u=p(t||a);if(u)return u;m.current&&m.current.abort(),m.current=new AbortController,c(!0),d(null);let f=0,h=l;const y=()=>n(void 0,void 0,void 0,function*(){var e;try{const n=Object.assign(Object.assign({},r),{signal:null===(e=m.current)||void 0===e?void 0:e.signal});i&&(n.body=JSON.stringify(i),n.headers||(n.headers={}),n.headers["Content-Type"]="application/json");const o=yield fetch(a,n);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const l=yield o.json();return g(t||a,l),l}catch(e){if(e instanceof Error&&"AbortError"===e.name)throw e;if(f++,f>o)throw d(e),e;return yield v(h),h*=s,y()}});try{return yield y()}finally{c(!1)}}),[p,g,l,s,o,v]);return{isLoading:i,error:u,sendRequest:b,cancelRequest:(0,r.useCallback)(()=>{m.current&&(m.current.abort(),m.current=null),c(!1)},[]),clearCache:y}};t.useAIChatRequest=()=>{const{sendRequest:e,isLoading:a,error:o,clearCache:l}=(0,t.useNetworkRequest)({cacheKey:"ai-chat",cacheTTL:6e5,maxRetries:3,retryDelay:1e3,retryBackoff:1.5});return{isLoading:a,error:o,sendChatRequest:(0,r.useCallback)((t,...a)=>n(void 0,[t,...a],void 0,function*(t,a={}){const{model:n="sydf-v1-250520",temperature:r=.7,stream:o=!0}=a;return e({url:"https://flow.ovo.gs/ai",options:{method:"POST"},body:{model:n,messages:t,temperature:r,stream:o}},`chat:${JSON.stringify(t.slice(-5))}`)}),[e]),clearCache:l}}},7568:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Item=void 0;const r=n(a(6540)),o=n(a(2485));t.Item=({title:e,content:t})=>r.default.createElement("li",{className:(0,o.default)("iztro-palace-center-item")},r.default.createElement("label",null,e),r.default.createElement("span",null,t))},7761:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useChatLayout=void 0;const n=a(6540),r=a(4396);t.useChatLayout=()=>{const[e,t]=(0,n.useState)((0,r.getLayoutConfig)()),[a,o]=(0,n.useState)(!1),l=(0,n.useCallback)(a=>{const n=Object.assign(Object.assign({},e),a);t(n),(0,r.updateLayoutCSSVariables)(n)},[e]),s=(0,n.useCallback)(()=>{const e=(0,r.getLayoutConfig)();(0,r.updateLayoutCSSVariables)(e),t(e),o(!0)},[]),i=(0,n.useCallback)(()=>{const e=(0,r.getLayoutConfig)();l(e)},[l]),c=(0,n.useCallback)(()=>{e.isMobile&&(document.body.classList.add("mobile-chat"),document.documentElement.style.setProperty("--chat-font-size","16px"))},[e.isMobile]),u=(0,n.useCallback)(()=>{document.body.classList.remove("mobile-chat"),document.documentElement.style.setProperty("--chat-font-size","14px")},[]);(0,n.useEffect)(()=>{if(a)return;s();const t=(0,r.createLayoutObserver)(i);return t.observe(document.documentElement),window.addEventListener("resize",i),e.isMobile?c():u(),()=>{t.disconnect(),window.removeEventListener("resize",i)}},[a,s,i,e.isMobile,c,u]),(0,n.useEffect)(()=>{const t=()=>{const t=(0,r.isMobileDevice)();t!==e.isMobile&&l({isMobile:t})};return window.addEventListener("orientationchange",t),()=>{window.removeEventListener("orientationchange",t)}},[e.isMobile,l]);const d=(0,n.useCallback)(()=>{if(e.isMobile){return document.body.classList.contains("keyboard-visible")?{gridTemplateRows:"\n            var(--header-height)\n            minmax(0, 1fr)\n            var(--keyboard-height)\n            auto\n          "}:{gridTemplateRows:"\n          var(--header-height)\n          minmax(0, 1fr)\n          auto\n        "}}return{gridTemplateRows:"1fr auto"}},[e.isMobile]),m=(0,n.useCallback)(()=>{const t={display:"grid",height:"100%",minHeight:0,overflow:"hidden"};return e.isMobile?Object.assign(Object.assign(Object.assign({},t),{position:"fixed",top:0,left:0,right:0,bottom:0,height:"100dvh",width:"100%"}),d()):Object.assign(Object.assign({},t),d())},[e.isMobile,d]),f=(0,n.useCallback)(()=>{const t={overflowY:"auto",minHeight:0,scrollSnapType:"y proximity"};return e.isMobile?Object.assign(Object.assign({},t),{paddingTop:"var(--safe-area-top)",paddingBottom:"var(--safe-area-bottom)",marginTop:0,marginBottom:0}):Object.assign(Object.assign({},t),{padding:"15px"})},[e.isMobile]),h=(0,n.useCallback)(()=>{const t={flexShrink:0,backgroundColor:"var(--background-color)"};return e.isMobile?Object.assign(Object.assign({},t),{position:"sticky",bottom:0,zIndex:100,paddingBottom:"var(--safe-area-bottom)",borderTop:"1px solid var(--border-color)"}):Object.assign(Object.assign({},t),{padding:"10px"})},[e.isMobile]);return{layoutConfig:e,isInitialized:a,getContainerStyle:m,getMessagesContainerStyle:f,getInputContainerStyle:h,updateLayout:l}}},8577:function(e,t,a){var n,r=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=n(e),l=0;l<a.length;l++)"default"!==a[l]&&r(t,e,a[l]);return o(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=l(a(6540)),c=a(9755),u=a(9265),d=a(4483),m=a(206),f=a(103),h=s(a(9683)),p=s(a(7076));a(3186),a(5246),t.default=i.default.memo(function(){const[e,t]=(0,i.useState)("single"),[a,n]=(0,i.useState)({name:"",year:"",month:"",day:"",birthTime:0,birthdayType:"solar",gender:"male"}),[r,o]=(0,i.useState)({person1:{name:"",year:"",month:"",day:"",birthTime:0,birthdayType:"solar",gender:"male"},person2:{name:"",year:"",month:"",day:"",birthTime:0,birthdayType:"solar",gender:"female"}}),[l,s]=(0,i.useState)(!1),[g,y]=(0,i.useState)(!0),{history:v,showHistoryModal:b,setShowHistoryModal:E,searchTerm:w,setSearchTerm:S,showPasswordInput:O,setShowPasswordInput:_,password:C,setPassword:k,isCloudStorageEnabled:N,isLoading:M,editingHistoryId:j,setEditingHistoryId:P,handlePasswordSubmit:T,handleSaveHistory:D,handleDeleteHistory:x,handleClearHistory:H}=(0,f.useHistoryManager)(),{astrolabe:I}=(0,c.useIztro)({birthday:`${a.year}-${String(a.month).padStart(2,"0")}-${String(a.day).padStart(2,"0")}`,birthTime:a.birthTime,gender:a.gender,birthdayType:a.birthdayType}),{astrolabe:$}=(0,c.useIztro)({birthday:`${r.person1.year}-${String(r.person1.month).padStart(2,"0")}-${String(r.person1.day).padStart(2,"0")}`,birthTime:r.person1.birthTime,gender:r.person1.gender,birthdayType:r.person1.birthdayType}),{astrolabe:A}=(0,c.useIztro)({birthday:`${r.person2.year}-${String(r.person2.month).padStart(2,"0")}-${String(r.person2.day).padStart(2,"0")}`,birthTime:r.person2.birthTime,gender:r.person2.gender,birthdayType:r.person2.birthdayType});(0,i.useEffect)(()=>{const e=new URLSearchParams(window.location.search),t=e.get("n")||"",a=e.get("y")||"",r=e.get("m")||"",o=e.get("d")||"",l=e.get("t")?parseInt(e.get("t")||"1"):0,i=e.get("type")||"solar",c=e.get("g")||"male",u=!!(e.get("y")&&e.get("m")&&e.get("d"));n({name:t,year:a,month:r,day:o,birthTime:l,birthdayType:i,gender:c}),u?(s(!0),y(!1)):(s(!1),y(!0))},[]),(0,i.useEffect)(()=>{const e=e=>{const t=e?"#1B1B1B":"#ffffff";let a=document.querySelector("meta[name=theme-color]");a?a.setAttribute("content",t):(a=document.createElement("meta"),a.setAttribute("name","theme-color"),a.setAttribute("content",t),document.getElementsByTagName("head")[0].appendChild(a))},t=window.matchMedia("(prefers-color-scheme: dark)");e(t.matches);const a=t=>{e(t.matches)};return t.addEventListener("change",a),()=>{t.removeEventListener("change",a)}},[]);const L=(0,i.useCallback)(e=>{try{const t=new URLSearchParams;e.name&&t.set("n",e.name),t.set("y",e.year),t.set("m",e.month),t.set("d",e.day),t.set("t",e.birthTime.toString()),t.set("type",e.birthdayType),t.set("g",e.gender);const a=`${window.location.pathname}?${t.toString()}`;window.history.replaceState({},"",a)}catch(e){}},[]),R=(0,i.useCallback)(e=>{"single"===e.type?(n({name:e.name,year:e.year,month:e.month,day:e.day,birthTime:e.birthTime,birthdayType:e.birthdayType,gender:e.gender}),t("single"),L({name:e.name,year:e.year,month:e.month,day:e.day,birthTime:e.birthTime,birthdayType:e.birthdayType,gender:e.gender}),s(!0),y(!1)):(o({person1:{name:e.name,year:e.year,month:e.month,day:e.day,birthTime:e.birthTime,birthdayType:e.birthdayType,gender:e.gender},person2:e.person2||{name:"",year:"",month:"",day:"",birthTime:0,birthdayType:"solar",gender:"female"}}),t("synastry"),s(!0),y(!1))},[L]),z=(0,i.useCallback)(e=>{"single"===e.type?(n({name:e.name,year:e.year,month:e.month,day:e.day,birthTime:e.birthTime,birthdayType:e.birthdayType,gender:e.gender}),t("single")):(o({person1:{name:e.name,year:e.year,month:e.month,day:e.day,birthTime:e.birthTime,birthdayType:e.birthdayType,gender:e.gender},person2:e.person2||{name:"",year:"",month:"",day:"",birthTime:0,birthdayType:"solar",gender:"female"}}),t("synastry"))},[]),B=(0,i.useCallback)(()=>{y(!0),s(!1),window.history.replaceState({},"",window.location.pathname),P(null)},[]);return i.default.createElement(u.AppContainer,null,i.default.createElement(m.AIChatProvider,null,i.default.createElement("div",{className:"content"},g&&i.default.createElement(h.default,{chartMode:e,setChartMode:t,formData:a,synastryData:r,onFormChange:n,onSynastryChange:(e,t)=>o(Object.assign(Object.assign({},r),{[e]:t})),onRadioChange:(e,t)=>n(Object.assign(Object.assign({},a),{[e]:t})),onSynastryRadioChange:(e,t,a)=>o(Object.assign(Object.assign({},r),{[e]:Object.assign(Object.assign({},r[e]),{[t]:a})})),onShowHistory:()=>E(!0),onSubmit:e=>e.preventDefault(),onSynastrySubmit:e=>e.preventDefault(),onSaveHistory:D,updateUrlParams:L,setShowAstrolabe:s,setShowInputPanel:y}),i.default.createElement(p.default,{history:v,showHistoryModal:b,setShowHistoryModal:E,searchTerm:w,setSearchTerm:S,showPasswordInput:O,setShowPasswordInput:_,password:C,setPassword:k,isCloudStorageEnabled:N,isLoading:M,editingHistoryId:j,setEditingHistoryId:P,handlePasswordSubmit:T,handleDeleteHistory:x,handleClearHistory:H,onLoadHistory:R,onEditHistory:z,chartMode:e}),l&&i.default.createElement(d.ResultContainer,{chartMode:e,formData:a,synastryData:r,astrolabe:I,astrolabe1:$,astrolabe2:A,onShowInputPanel:B}))))})},8711:function(e,t,a){var n,r=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=n(e),l=0;l<a.length;l++)"default"!==a[l]&&r(t,e,a[l]);return o(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.IzpalaceCenter=void 0;const i=s(a(2485)),c=l(a(6540)),u=a(7568);a(3186);const d=a(6755),m=a(1887),f=a(5442),h=a(3914),p=a(8874);t.IzpalaceCenter=({astrolabe:e,horoscope:t,arrowIndex:a,arrowScope:n,horoscopeDate:r=new Date,horoscopeHour:o=0,setHoroscopeDate:l,setHoroscopeHour:s,centerPalaceAlign:g})=>{var y,v;const b=(0,c.useMemo)(()=>[{title:"五行局：",content:null==e?void 0:e.fiveElementsClass},{title:"年龄(虚岁)：",content:`${null==t?void 0:t.age.nominalAge} 岁`},{title:"四柱：",content:null==e?void 0:e.chineseDate},{title:"阳历：",content:null==e?void 0:e.solarDate},{title:"农历：",content:null==e?void 0:e.lunarDate},{title:"时辰：",content:`${null==e?void 0:e.time}(${null==e?void 0:e.timeRange})`},{title:"生肖：",content:null==e?void 0:e.zodiac},{title:"星座：",content:null==e?void 0:e.sign},{title:"命主：",content:null==e?void 0:e.soul},{title:"身主：",content:null==e?void 0:e.body},{title:"命宫：",content:null==e?void 0:e.earthlyBranchOfSoulPalace},{title:"身宫：",content:null==e?void 0:e.earthlyBranchOfBodyPalace}],[e,t]),E=(0,c.useMemo)(()=>{const e=null!=r?r:new Date,[t,a,n]=(0,f.normalizeDateStr)(e),o=new Date(t,a-1,n);return{solar:`${t}-${a}-${n}`,lunar:(0,f.solar2lunar)(e).toString(!0),prevDecadalDisabled:o.setFullYear(o.getFullYear()-1)}},[r]),w=(t,a)=>{if(!(null==e?void 0:e.solarDate))return!0;const[n,i,c]=(0,f.normalizeDateStr)(r),u=new Date(n,i-1,c),[d,m,h]=(0,f.normalizeDateStr)(e.solarDate),p=new Date(d,m-1,h);let g=o;switch(t){case"hourly":g=o+a,o+a>11?(u.setDate(u.getDate()+1),g=0):o+a<0&&(u.setDate(u.getDate()-1),g=11);break;case"daily":u.setDate(u.getDate()+a);break;case"monthly":u.setMonth(u.getMonth()+a);break;case"yearly":case"decadal":u.setFullYear(u.getFullYear()+a)}u.getTime()>=p.getTime()&&(null==l||l(u),null==s||s(g))},S=(0,c.useCallback)((t,a,n)=>{if(!(null==e?void 0:e.solarDate))return!0;const[r,l,s]=(0,f.normalizeDateStr)(t),i=new Date(r,l-1,s),[c,u,d]=(0,f.normalizeDateStr)(e.solarDate),m=new Date(c,u-1,d);switch(a){case"hourly":o+n>11?i.setDate(i.getDate()+1):o+n<0&&i.setDate(i.getDate()-1);break;case"daily":i.setDate(i.getDate()+n);break;case"monthly":i.setMonth(i.getMonth()+n);break;case"yearly":case"decadal":i.setFullYear(i.getFullYear()+n)}return i.getTime()<m.getTime()},[o,e]);return c.default.createElement("div",{className:(0,i.default)("iztro-center-palace",{"iztro-center-palace-centralize":g})},(null==e?void 0:e.earthlyBranchOfSoulPalace)&&c.default.createElement(d.Line,{scope:n,index:null!=a?a:(0,m.fixEarthlyBranchIndex)(e.earthlyBranchOfSoulPalace)}),c.default.createElement("h3",{className:"center-title"},c.default.createElement("span",{className:`gender gender-${(0,h.kot)(null!==(y=null==e?void 0:e.gender)&&void 0!==y?y:"")}`},"male"===(0,h.kot)(null!==(v=null==e?void 0:e.gender)&&void 0!==v?v:"")?"♂":"♀"),c.default.createElement("span",null,"基本信息")),c.default.createElement("ul",{className:"basic-info"},b.map((e,t)=>c.default.createElement(u.Item,Object.assign({key:t},e)))),c.default.createElement("h3",{className:"center-title"},"运限信息"),c.default.createElement("ul",{className:"basic-info"},c.default.createElement(u.Item,{title:"农历：",content:E.lunar}),c.default.createElement("div",{className:(0,i.default)("solar-horoscope",{"solar-horoscope-centralize":g})},c.default.createElement(u.Item,{title:"阳历：",content:E.solar}),c.default.createElement("span",{className:"today",onClick:()=>null==l?void 0:l(new Date)},"今"))),c.default.createElement("div",{className:"horo-buttons"},c.default.createElement("span",{className:(0,i.default)("center-button",{disabled:S(E.solar,"yearly",-10)}),onClick:()=>w("yearly",-10)},"◀限"),c.default.createElement("span",{className:(0,i.default)("center-button",{disabled:S(E.solar,"yearly",-1)}),onClick:()=>w("yearly",-1)},"◀年"),c.default.createElement("span",{className:(0,i.default)("center-button",{disabled:S(E.solar,"monthly",-1)}),onClick:()=>w("monthly",-1)},"◀月"),c.default.createElement("span",{className:(0,i.default)("center-button",{disabled:S(E.solar,"daily",-1)}),onClick:()=>w("daily",-1)},"◀日"),c.default.createElement("span",{className:(0,i.default)("center-button",{disabled:S(E.solar,"hourly",-1)}),onClick:()=>w("hourly",-1)},"◀时"),c.default.createElement("span",{className:"center-horo-hour"},(0,h.t)(p.CHINESE_TIME[o])),c.default.createElement("span",{className:(0,i.default)("center-button"),onClick:()=>w("hourly",1)},"时▶"),c.default.createElement("span",{className:(0,i.default)("center-button"),onClick:()=>w("daily",1)},"日▶"),c.default.createElement("span",{className:(0,i.default)("center-button"),onClick:()=>w("monthly",1)},"月▶"),c.default.createElement("span",{className:(0,i.default)("center-button"),onClick:()=>w("yearly",1)},"年▶"),c.default.createElement("span",{className:(0,i.default)("center-button"),onClick:()=>w("yearly",10)},"限▶")))}},8925:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(a(6540));t.default=r.default.memo(({isVisible:e,onClick:t})=>e?r.default.createElement("button",{className:"scroll-to-bottom-button "+(e?"visible":""),onClick:t,"aria-label":"滚动到底部"},r.default.createElement("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},r.default.createElement("polyline",{points:"6 9 12 15 18 9"}))):null)},9034:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(a(6540)),o=a(206);t.default=()=>{const{isGeneratingInBackground:e}=(0,o.useAIChat)();return e?r.default.createElement("div",{className:"background-ai-indicator"},r.default.createElement("div",{className:"indicator-content"},r.default.createElement("div",{className:"typing-indicator"},r.default.createElement("span",null),r.default.createElement("span",null),r.default.createElement("span",null)),r.default.createElement("span",{className:"indicator-text"},"AI正在后台生成..."))):null}},9265:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AppContainer=void 0;const r=n(a(6540)),o=a(9482);t.AppContainer=({children:e})=>{const{isKeyboardVisible:t}=(0,o.useKeyboardDetector)();(0,o.useSafeArea)();return r.default.createElement("div",{className:"App "+(t?"keyboard-visible":"")},e)},t.default=t.AppContainer},9277:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useMessageStorage=void 0;const n=a(6540);t.useMessageStorage=({maxMessagesInMemory:e=100,pageSize:t=20,storageKey:a="ai-chat-messages"}={})=>{const[r,o]=(0,n.useState)([]),[l,s]=(0,n.useState)([]),[i,c]=(0,n.useState)(1),[u,d]=(0,n.useState)(!1),[m,f]=(0,n.useState)(!0),h=(0,n.useCallback)(()=>{try{const e=localStorage.getItem(a);if(e){const t=JSON.parse(e);if(Array.isArray(t)&&t.every(e=>e&&"object"==typeof e&&("user"===e.role||"assistant"===e.role)&&"string"==typeof e.content))return t}}catch(e){}return[]},[a]),p=(0,n.useCallback)(t=>{try{localStorage.setItem(a,JSON.stringify(t))}catch(n){try{const n=t.slice(-e);localStorage.setItem(a,JSON.stringify(n))}catch(e){}}},[a,e]);(0,n.useEffect)(()=>{const e=h();o(e);const a=e.slice(-t);s(a),c(1),f(e.length>t)},[h,t]);const g=(0,n.useCallback)(t=>{o(a=>{const n=[...a,...t];if(n.length>e){const t=n.slice(-e);return p(t),t}return p(n),n}),s(e=>[...e,...t])},[e,p]),y=(0,n.useCallback)(()=>{!u&&m&&(d(!0),setTimeout(()=>{const e=i+1,a=Math.max(0,r.length-e*t),n=r.length-(e-1)*t;if(a<=0){const e=r.slice(0,n);s(e),f(!1)}else{const t=r.slice(a,n);s(e=>[...t,...e]),c(e)}d(!1)},0))},[r,i,m,u,t]),v=(0,n.useCallback)(()=>{o([]),s([]),c(1),f(!1);try{localStorage.removeItem(a)}catch(e){}},[a]),b=(0,n.useCallback)(()=>{const e=r.slice(-t);s(e),c(1),f(r.length>t)},[r,t]);return{allMessages:r,visibleMessages:l,currentPage:i,isLoading:u,hasMore:m,addMessages:g,loadMoreMessages:y,clearMessages:v,resetToLatest:b}}},9482:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useSafeArea=t.useKeyboardDetector=void 0;const n=a(6540);t.useKeyboardDetector=()=>{const[e,t]=(0,n.useState)(!1),[a,r]=(0,n.useState)(0);return(0,n.useEffect)(()=>{if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return;const e=()=>{var e,a;const n=(null===(e=window.visualViewport)||void 0===e?void 0:e.height)||window.innerHeight,o=window.innerHeight,l=(null===(a=window.screen)||void 0===a||a.height,o-n),s=l>100;t(s),r(s?l:0),document.documentElement.style.setProperty("--keyboard-height",`${s?l:0}px`),document.documentElement.style.setProperty("--is-keyboard-visible",s?"true":"false"),s?document.body.classList.add("keyboard-visible"):document.body.classList.remove("keyboard-visible")};e(),window.visualViewport?(window.visualViewport.addEventListener("resize",e),window.visualViewport.addEventListener("scroll",e)):window.addEventListener("resize",e);const a=t=>{const a=t.target;"INPUT"!==a.tagName&&"TEXTAREA"!==a.tagName||setTimeout(e,100)},n=t=>{const a=t.target;"INPUT"!==a.tagName&&"TEXTAREA"!==a.tagName||setTimeout(e,300)};return document.addEventListener("focusin",a),document.addEventListener("focusout",n),()=>{window.visualViewport?(window.visualViewport.removeEventListener("resize",e),window.visualViewport.removeEventListener("scroll",e)):window.removeEventListener("resize",e),document.removeEventListener("focusin",a),document.removeEventListener("focusout",n)}},[]),{isKeyboardVisible:e,keyboardHeight:a}};t.useSafeArea=()=>{const[e,t]=(0,n.useState)({top:0,right:0,bottom:0,left:0});return(0,n.useEffect)(()=>{const e=()=>{const e=document.createElement("div");e.style.position="absolute",e.style.top="-9999px",e.style.left="-9999px",document.body.appendChild(e);const a=window.getComputedStyle(e),n={top:parseInt(a.getPropertyValue("--safe-area-inset-top"))||0,right:parseInt(a.getPropertyValue("--safe-area-inset-right"))||0,bottom:parseInt(a.getPropertyValue("--safe-area-inset-bottom"))||0,left:parseInt(a.getPropertyValue("--safe-area-inset-left"))||0};document.body.removeChild(e),t(n)};return e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",e),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}},[]),e}},9683:function(e,t,a){var n,r=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=n(e),l=0;l<a.length;l++)"default"!==a[l]&&r(t,e,a[l]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0});const s=l(a(6540)),i=a(7256);t.default=s.default.memo(({chartMode:e,setChartMode:t,formData:a,synastryData:n,onFormChange:r,onSynastryChange:o,onRadioChange:l,onSynastryRadioChange:c,onShowHistory:u,onSubmit:d,onSynastrySubmit:m,onSaveHistory:f,updateUrlParams:h,setShowAstrolabe:p,setShowInputPanel:g})=>{const y=(0,s.useCallback)(e=>{e.preventDefault(),a.year&&a.month&&a.day?(a.name.trim()&&f(Object.assign(Object.assign({},a),{type:"single"})),h(a),p(!0),g(!1)):alert("请填写完整的日期信息（年、月、日）")},[a,f,h,p,g]),v=(0,s.useCallback)(e=>{e.preventDefault(),n.person1.year&&n.person1.month&&n.person1.day?n.person2.year&&n.person2.month&&n.person2.day?((n.person1.name.trim()||n.person2.name.trim())&&f(Object.assign(Object.assign({},n.person1),{type:"synastry",person2:n.person2})),p(!0),g(!1)):alert("请填写第二个人的完整日期信息（年、月、日）"):alert("请填写第一个人的完整日期信息（年、月、日）")},[n,f,p,g]);return s.default.createElement(i.FormContainer,{chartMode:e,setChartMode:t,formData:a,synastryData:n,onFormChange:r,onSynastryChange:o,onRadioChange:l,onSynastryRadioChange:c,onShowHistory:u,onSubmit:y,onSynastrySubmit:v})})}},e=>{e.O(0,[644,775,226,96],()=>{return t=3900,e(e.s=t);var t});e.O()}]);
//# sourceMappingURL=main.c225c06a8c7e009c5848.js.map