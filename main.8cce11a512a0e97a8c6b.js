"use strict";(self.webpackChunkreact_iztro=self.webpackChunkreact_iztro||[]).push([[792],{206:(e,t,a)=>{a.d(t,{S:()=>l,o:()=>i});var n=a(6540);const r="aiChatSessions",o="aiChatModel",s=(0,n.createContext)(void 0),l=({children:e})=>{const[t,a]=(0,n.useState)([]),[l,i]=(0,n.useState)(null),[c,m]=(0,n.useState)(!1),[d,u]=(0,n.useState)(!1),[h,y]=(0,n.useState)("sydf/v1-250520");(0,n.useEffect)(()=>{try{const e=localStorage.getItem(o);e&&y(e)}catch(e){}},[]),(0,n.useEffect)(()=>{try{const e=localStorage.getItem(r);if(e){const t=JSON.parse(e);t.length>0&&(a(t),i(t[0].id))}}catch(e){}},[]),(0,n.useEffect)(()=>{try{localStorage.setItem(r,JSON.stringify(t))}catch(e){}},[t]);const p=(0,n.useCallback)(()=>{const e={id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),title:"新的对话",messages:[],createdAt:Date.now()};return a(t=>[e,...t]),i(e.id),e},[]),g=(0,n.useCallback)(e=>{t.some(t=>t.id===e)&&i(e)},[t]),E=(0,n.useCallback)(e=>{a(t=>{const a=t.filter(t=>t.id!==e);return l===e&&i(a.length>0?a[0].id:null),a})},[l]),v=(0,n.useCallback)(()=>{a([]),i(null)},[]),b=(0,n.useCallback)((e,t)=>{a(a=>a.map(a=>a.id===e?{...a,messages:"function"==typeof t?t(a.messages):t}:a))},[]),S=(0,n.useCallback)(e=>{l&&b(l,e)},[l,b]),w=(0,n.useCallback)(e=>{l&&b(l,t=>[...t,e])},[l,b]),f=(0,n.useCallback)(e=>{l&&b(l,t=>{if(0===t.length||"assistant"!==t[t.length-1].role)return t;const a=[...t];return a[a.length-1]={...a[a.length-1],content:e},a})},[l,b]),C=(0,n.useCallback)(()=>{l&&b(l,[])},[l,b]),N=(0,n.useCallback)((e,t)=>{a(a=>a.map(a=>a.id===e?{...a,title:t}:a))},[]),T=(0,n.useCallback)(e=>{y(e);try{localStorage.setItem(o,e)}catch(e){}},[]),k=(0,n.useMemo)(()=>t.find(e=>e.id===l)??null,[t,l]),H={sessions:t,activeSessionId:l,activeSession:k,isLoading:c,isGeneratingInBackground:d,model:h,createSession:p,switchSession:g,deleteSession:E,setMessages:S,addMessage:w,updateLastMessage:f,updateSessionTitle:N,clearMessages:C,clearAllSessions:v,setModel:T,setIsLoading:m,setIsGeneratingInBackground:u};return n.createElement(s.Provider,{value:H},e)},i=()=>{const e=(0,n.useContext)(s);if(void 0===e)throw new Error("useAIChat must be used within an AIChatProvider");return e}},9083:(e,t,a)=>{var n=a(6540),r=a(5338),o=a(9755);const s=({children:e})=>{const{isKeyboardVisible:t}=(()=>{const[e,t]=(0,n.useState)(!1),[a,r]=(0,n.useState)(0);return(0,n.useEffect)(()=>{if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return;const e=()=>{const e=window.visualViewport?.height||window.innerHeight,a=window.innerHeight,n=(window.screen,a-e),o=n>100;t(o),r(o?n:0),document.documentElement.style.setProperty("--keyboard-height",`${o?n:0}px`),document.documentElement.style.setProperty("--is-keyboard-visible",o?"true":"false"),o?document.body.classList.add("keyboard-visible"):document.body.classList.remove("keyboard-visible")};e(),window.visualViewport?(window.visualViewport.addEventListener("resize",e),window.visualViewport.addEventListener("scroll",e)):window.addEventListener("resize",e);const a=t=>{const a=t.target;"INPUT"!==a.tagName&&"TEXTAREA"!==a.tagName||setTimeout(e,100)},n=t=>{const a=t.target;"INPUT"!==a.tagName&&"TEXTAREA"!==a.tagName||setTimeout(e,300)};return document.addEventListener("focusin",a),document.addEventListener("focusout",n),()=>{window.visualViewport?(window.visualViewport.removeEventListener("resize",e),window.visualViewport.removeEventListener("scroll",e)):window.removeEventListener("resize",e),document.removeEventListener("focusin",a),document.removeEventListener("focusout",n)}},[]),{isKeyboardVisible:e,keyboardHeight:a}})();(()=>{const[e,t]=(0,n.useState)({top:0,right:0,bottom:0,left:0});(0,n.useEffect)(()=>{const e=()=>{const e=document.createElement("div");e.style.position="absolute",e.style.top="-9999px",e.style.left="-9999px",document.body.appendChild(e);const a=window.getComputedStyle(e),n={top:parseInt(a.getPropertyValue("--safe-area-inset-top"))||0,right:parseInt(a.getPropertyValue("--safe-area-inset-right"))||0,bottom:parseInt(a.getPropertyValue("--safe-area-inset-bottom"))||0,left:parseInt(a.getPropertyValue("--safe-area-inset-left"))||0};document.body.removeChild(e),t(n)};return e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",e),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}},[])})();return n.createElement("div",{className:"App "+(t?"keyboard-visible":"")},e)};var l=a(6942),i=a.n(l),c=a(8874),m=a(3914),d=a(1887);const u=({horoscopeMutagens:e,activeHeavenlyStem:t,hoverHeavenlyStem:a,palaceHeavenlyStem:r,...o})=>{const s=(0,n.useMemo)(()=>{if(!t)return"";const e=(0,d.getMutagensByHeavenlyStem)((0,m.t)(t)).indexOf(o.name);return e<0?"":`iztro-star-mutagen-${e}`},[t,o.name]),l=(0,n.useMemo)(()=>{if(!a)return"";const e=(0,d.getMutagensByHeavenlyStem)((0,m.t)(a)).indexOf(o.name);return e<0?"":`iztro-star-hover-mutagen-${e}`},[a,o.name]),u=(0,n.useMemo)(()=>{if(!r||t||a)return;const e=(0,d.getMutagensByHeavenlyStem)((0,m.t)(r)).indexOf(o.name);return e<0?"":`iztro-star-self-mutagen-${e}`},[r,t,a]);return n.createElement("div",{className:i()("iztro-star",`iztro-star-${o.type}`)},n.createElement("span",{className:i()("star-with-mutagen",s,u,l,{"iztro-star-self-mutagen":!!u})},o.name),n.createElement("i",{className:i()("iztro-star-brightness")},o.brightness),o.mutagen&&n.createElement("span",{className:i()("iztro-star-mutagen",`mutagen-${c.MUTAGEN.indexOf((0,m.kot)(o.mutagen))}`)},o.mutagen),e?.map(e=>{if(e.mutagen.includes(o.name)&&e.show)return n.createElement("span",{key:e.scope,className:i()("iztro-star-mutagen",`mutagen-${e.scope}`)},(0,m.t)(c.MUTAGEN[e.mutagen.indexOf(o.name)]))}))},h=({index:e,taichiPalace:t,focusedIndex:a,onFocused:r,horoscope:o,activeHeavenlyStem:s,toggleActiveHeavenlyStem:l,hoverHeavenlyStem:c,setHoverHeavenlyStem:h,showDecadalScope:y=!1,showYearlyScope:p=!1,showMonthlyScope:g=!1,showDailyScope:E=!1,showHourlyScope:v=!1,toggleScope:b,toggleTaichiPoint:S,...w})=>{const f=(0,n.useMemo)(()=>{const t=[];return o?.decadal.index===e&&t.push({...o.decadal,scope:"decadal",show:y}),o?.yearly.index===e&&t.push({...o.yearly,scope:"yearly",show:p}),o?.monthly.index===e&&t.push({...o.monthly,scope:"monthly",show:g}),o?.daily.index===e&&t.push({...o.daily,scope:"daily",show:E}),o?.hourly.index===e&&t.push({...o.hourly,scope:"hourly",show:v}),o?.age.index===e&&t.push({name:o.age.name,heavenlyStem:void 0,scope:"age",show:!1}),t},[o,y,p,g,E,v]),C=(0,n.useMemo)(()=>o?[{mutagen:o.decadal.mutagen,scope:"decadal",show:y},{mutagen:o.yearly.mutagen,scope:"yearly",show:p},{mutagen:o.monthly.mutagen,scope:"monthly",show:g},{mutagen:o.daily.mutagen,scope:"daily",show:E},{mutagen:o.hourly.mutagen,scope:"hourly",show:v}]:[],[o,y,p,g,E,v]);return n.createElement("div",{className:i()(`iztro-palace g${e}`,{"focused-palace":a===e,"opposite-palace":null!=a&&e===(0,d.fixIndex)(a+6),"surrounded-palace":null!=a&&(e===(0,d.fixIndex)(a+4)||e===(0,d.fixIndex)(a-4))}),onMouseEnter:()=>r?.(e),onMouseLeave:()=>r?.(void 0)},n.createElement("div",{className:i()("iztro-palace-major")},w.majorStars.map(e=>n.createElement(u,{key:e.name,activeHeavenlyStem:s,hoverHeavenlyStem:c,palaceHeavenlyStem:(0,m.kot)(w.heavenlyStem,"Heavenly"),horoscopeMutagens:C,...e}))),n.createElement("div",{className:i()("iztro-palace-minor")},w.minorStars.map(e=>n.createElement(u,{key:e.name,activeHeavenlyStem:s,hoverHeavenlyStem:c,palaceHeavenlyStem:(0,m.kot)(w.heavenlyStem,"Heavenly"),horoscopeMutagens:C,...e}))),n.createElement("div",{className:i()("iztro-palace-adj")},n.createElement("div",null,w.adjectiveStars.slice(5).map(e=>n.createElement(u,{key:e.name,...e}))),n.createElement("div",null,w.adjectiveStars.slice(0,5).map(e=>n.createElement(u,{key:e.name,...e})))),n.createElement("div",{className:i()("iztro-palace-horo-star")},n.createElement("div",{className:i()("stars")},o?.decadal?.stars&&o?.decadal?.stars[e].map(e=>n.createElement(u,{key:e.name,...e}))),n.createElement("div",{className:i()("stars")},o?.yearly?.stars&&o?.yearly?.stars[e].map(e=>n.createElement(u,{key:e.name,...e})))),n.createElement("div",{className:i()("iztro-palace-fate")},f?.map(e=>n.createElement("span",{key:e.name,className:i()({[`iztro-palace-${e.scope}-active`]:e.show}),onClick:e.scope?()=>b?.(e.scope):void 0},e.name,e.heavenlyStem&&`·${e.heavenlyStem}`))),n.createElement("div",{className:i()("iztro-palace-footer")},n.createElement("div",null,n.createElement("div",{className:i()("iztro-palace-lft24")},n.createElement("div",null,w.changsheng12),n.createElement("div",null,w.boshi12)),n.createElement("div",{className:i()("iztro-palace-name"),onClick:()=>S?.(e)},n.createElement("span",{className:"iztro-palace-name-wrapper"},w.name,n.createElement("span",{className:"iztro-palace-name-taichi"},t&&((0,m.kot)(t)===(0,m.kot)("命宫")?"☯":t))),w.isBodyPalace&&n.createElement("span",{className:i()("iztro-palace-name-body")},"·",(0,m.t)("bodyPalace")))),n.createElement("div",null,n.createElement("div",{className:i()("iztro-palace-scope")},n.createElement("div",{className:i()("iztro-palace-scope-age")},w.ages.slice(0,7).join(" ")),n.createElement("div",{className:i()("iztro-palace-scope-decadal")},w.decadal.range.join(" - "))),n.createElement("div",{className:i()("iztro-palace-dynamic-name")},y&&n.createElement("span",{className:"iztro-palace-dynamic-name-decadal"},o?.decadal.palaceNames[e]),p&&n.createElement("span",{className:"iztro-palace-dynamic-name-yearly"},o?.yearly.palaceNames[e]),g&&n.createElement("span",{className:"iztro-palace-dynamic-name-monthly"},o?.monthly.palaceNames[e]),E&&n.createElement("span",{className:"iztro-palace-dynamic-name-daily"},o?.daily.palaceNames[e]),v&&n.createElement("span",{className:"iztro-palace-dynamic-name-hourly"},o?.hourly.palaceNames[e]))),n.createElement("div",null,n.createElement("div",{className:i()("iztro-palace-rgt24")},n.createElement("div",null,p?o?.yearly.yearlyDecStar.suiqian12[e]:w.suiqian12),n.createElement("div",null,p?o?.yearly.yearlyDecStar.jiangqian12[e]:w.jiangqian12)),n.createElement("div",{className:i()("iztro-palace-gz",{"iztro-palace-gz-active":s===(0,m.kot)(w.heavenlyStem,"Heavenly")}),onClick:()=>l?.((0,m.kot)(w.heavenlyStem,"Heavenly")),onMouseEnter:()=>h?.((0,m.kot)(w.heavenlyStem,"Heavenly")),onMouseLeave:()=>h?.(void 0)},n.createElement("span",{className:i()({"iztro-palace-gz-active":s===(0,m.kot)(w.heavenlyStem,"Heavenly")})},w.heavenlyStem,w.earthlyBranch)))))},y=({title:e,content:t})=>n.createElement("li",{className:i()("iztro-palace-center-item")},n.createElement("label",null,e),n.createElement("span",null,t)),p=({index:e,scope:t})=>{const a=(0,n.useRef)(null),r=(0,n.useMemo)(()=>{if(t){const e=document.getElementsByClassName("iztro-astrolabe-theme-default")[0];return getComputedStyle(e).getPropertyValue(`--iztro-color-${t}`)}return"rgba(245,0,0)"},[t]);return(0,n.useEffect)(()=>{const t=e,n=a.current;if(!n||t<0)return;const{height:o,width:s}=n.getBoundingClientRect();n.width=s,n.height=o;const l=s/2,i=o/2,c=[[0,2*i],[0,1.5*i],[0,.5*i],[0,0],[.5*l,0],[1.5*l,0],[2*l,0],[2*l,.5*i],[2*l,1.5*i],[2*l,2*i],[1.5*l,2*i],[.5*l,2*i]],m=n.getContext("2d");if(!m)return;m.clearRect(0,0,n.width,n.height),m.strokeStyle=r,m.lineWidth=1,m.globalAlpha=.5;const u=(0,d.fixIndex)(t+6),h=(0,d.fixIndex)(t+4),y=(0,d.fixIndex)(t-4);m.beginPath(),m.moveTo(c[u][0],c[u][1]),m.lineTo(c[t][0],c[t][1]),m.lineTo(c[h][0],c[h][1]),m.lineTo(c[y][0],c[y][1]),m.lineTo(c[t][0],c[t][1]),m.stroke()},[e,r]),n.createElement("canvas",{id:"palace-line",className:`palace-line ${t||""}`,ref:a})};var g=a(5442);const E=({astrolabe:e,horoscope:t,arrowIndex:a,arrowScope:r,horoscopeDate:o=new Date,horoscopeHour:s=0,setHoroscopeDate:l,setHoroscopeHour:u,centerPalaceAlign:h})=>{const E=(0,n.useMemo)(()=>[{title:"五行局：",content:e?.fiveElementsClass},{title:"年龄(虚岁)：",content:`${t?.age.nominalAge} 岁`},{title:"四柱：",content:e?.chineseDate},{title:"阳历：",content:e?.solarDate},{title:"农历：",content:e?.lunarDate},{title:"时辰：",content:`${e?.time}(${e?.timeRange})`},{title:"生肖：",content:e?.zodiac},{title:"星座：",content:e?.sign},{title:"命主：",content:e?.soul},{title:"身主：",content:e?.body},{title:"命宫：",content:e?.earthlyBranchOfSoulPalace},{title:"身宫：",content:e?.earthlyBranchOfBodyPalace}],[e,t]),v=(0,n.useMemo)(()=>{const e=o??new Date,[t,a,n]=(0,g.normalizeDateStr)(e),r=new Date(t,a-1,n);return{solar:`${t}-${a}-${n}`,lunar:(0,g.solar2lunar)(e).toString(!0),prevDecadalDisabled:r.setFullYear(r.getFullYear()-1)}},[o]),b=(t,a)=>{if(!e?.solarDate)return!0;const[n,r,i]=(0,g.normalizeDateStr)(o),c=new Date(n,r-1,i),[m,d,h]=(0,g.normalizeDateStr)(e.solarDate),y=new Date(m,d-1,h);let p=s;switch(t){case"hourly":p=s+a,s+a>11?(c.setDate(c.getDate()+1),p=0):s+a<0&&(c.setDate(c.getDate()-1),p=11);break;case"daily":c.setDate(c.getDate()+a);break;case"monthly":c.setMonth(c.getMonth()+a);break;case"yearly":case"decadal":c.setFullYear(c.getFullYear()+a)}c.getTime()>=y.getTime()&&(l?.(c),u?.(p))},S=(0,n.useCallback)((t,a,n)=>{if(!e?.solarDate)return!0;const[r,o,l]=(0,g.normalizeDateStr)(t),i=new Date(r,o-1,l),[c,m,d]=(0,g.normalizeDateStr)(e.solarDate),u=new Date(c,m-1,d);switch(a){case"hourly":s+n>11?i.setDate(i.getDate()+1):s+n<0&&i.setDate(i.getDate()-1);break;case"daily":i.setDate(i.getDate()+n);break;case"monthly":i.setMonth(i.getMonth()+n);break;case"yearly":case"decadal":i.setFullYear(i.getFullYear()+n)}return i.getTime()<u.getTime()},[s,e]);return n.createElement("div",{className:i()("iztro-center-palace",{"iztro-center-palace-centralize":h})},e?.earthlyBranchOfSoulPalace&&n.createElement(p,{scope:r,index:a??(0,d.fixEarthlyBranchIndex)(e.earthlyBranchOfSoulPalace)}),n.createElement("h3",{className:"center-title"},n.createElement("span",{className:`gender gender-${(0,m.kot)(e?.gender??"")}`},"male"===(0,m.kot)(e?.gender??"")?"♂":"♀"),n.createElement("span",null,"基本信息")),n.createElement("ul",{className:"basic-info"},E.map((e,t)=>n.createElement(y,{key:t,...e}))),n.createElement("h3",{className:"center-title"},"运限信息"),n.createElement("ul",{className:"basic-info"},n.createElement(y,{title:"农历：",content:v.lunar}),n.createElement("div",{className:i()("solar-horoscope",{"solar-horoscope-centralize":h})},n.createElement(y,{title:"阳历：",content:v.solar}),n.createElement("span",{className:"today",onClick:()=>l?.(new Date)},"今"))),n.createElement("div",{className:"horo-buttons"},n.createElement("span",{className:i()("center-button",{disabled:S(v.solar,"yearly",-10)}),onClick:()=>b("yearly",-10)},"◀限"),n.createElement("span",{className:i()("center-button",{disabled:S(v.solar,"yearly",-1)}),onClick:()=>b("yearly",-1)},"◀年"),n.createElement("span",{className:i()("center-button",{disabled:S(v.solar,"monthly",-1)}),onClick:()=>b("monthly",-1)},"◀月"),n.createElement("span",{className:i()("center-button",{disabled:S(v.solar,"daily",-1)}),onClick:()=>b("daily",-1)},"◀日"),n.createElement("span",{className:i()("center-button",{disabled:S(v.solar,"hourly",-1)}),onClick:()=>b("hourly",-1)},"◀时"),n.createElement("span",{className:"center-horo-hour"},(0,m.t)(c.CHINESE_TIME[s])),n.createElement("span",{className:i()("center-button"),onClick:()=>b("hourly",1)},"时▶"),n.createElement("span",{className:i()("center-button"),onClick:()=>b("daily",1)},"日▶"),n.createElement("span",{className:i()("center-button"),onClick:()=>b("monthly",1)},"月▶"),n.createElement("span",{className:i()("center-button"),onClick:()=>b("yearly",1)},"年▶"),n.createElement("span",{className:i()("center-button"),onClick:()=>b("yearly",10)},"限▶")))};var v=a(3877);const b=e=>{const[t,a]=(0,n.useState)(-1),[r,s]=(0,n.useState)(),[l,c]=(0,n.useState)(),[m,d]=(0,n.useState)(),[u,y]=(0,n.useState)(),[p,g]=(0,n.useState)(!1),[b,S]=(0,n.useState)(!1),[w,f]=(0,n.useState)(!1),[C,N]=(0,n.useState)(!1),[T,k]=(0,n.useState)(!1),[H,x]=(0,n.useState)(),[D,I]=(0,n.useState)(),{astrolabe:L,horoscope:z,setHoroscope:M}=(0,o.S)({birthday:e.birthday,birthTime:e.birthTime,gender:e.gender,birthdayType:e.birthdayType,fixLeap:e.fixLeap,isLeapMonth:e.isLeapMonth,lang:e.lang,astroType:e.astroType,options:e.options}),$=e=>{switch(e){case"decadal":g(!p);break;case"yearly":S(!b);break;case"monthly":f(!w);break;case"daily":N(!C);break;case"hourly":k(!T)}},A=e=>{c(e===l?void 0:e)},P=(0,n.useMemo)(()=>T?{arrowIndex:z?.hourly.index,arrowScope:"hourly"}:C?{arrowIndex:z?.daily.index,arrowScope:"daily"}:w?{arrowIndex:z?.monthly.index,arrowScope:"monthly"}:b?{arrowIndex:z?.yearly.index,arrowScope:"yearly"}:p?{arrowIndex:z?.decadal.index,arrowScope:"decadal"}:void 0,[p,b,w,C,T,z]);(0,n.useEffect)(()=>{x(e.horoscopeDate??new Date),I(e.horoscopeHour??0)},[e.horoscopeDate,e.horoscopeHour]),(0,n.useEffect)(()=>{M(H??new Date,D)},[H,D]),(0,n.useEffect)(()=>{if(t<0)s(void 0);else{const e=(0,v.getPalaceNames)(t);s(e)}},[t]);const O=e=>{a(t===e?-1:e)};return n.createElement("div",{className:i()("iztro-astrolabe","iztro-astrolabe-theme-default")},L?.palaces.map(e=>n.createElement(h,{key:e.earthlyBranch,focusedIndex:u,onFocused:y,horoscope:z,showDecadalScope:p,showYearlyScope:b,showMonthlyScope:w,showDailyScope:C,showHourlyScope:T,taichiPalace:r?.[e.index],toggleScope:$,activeHeavenlyStem:l,toggleActiveHeavenlyStem:A,hoverHeavenlyStem:m,setHoverHeavenlyStem:d,toggleTaichiPoint:O,...e})),n.createElement(E,{astrolabe:L,horoscope:z,horoscopeDate:H,horoscopeHour:D,setHoroscopeDate:x,setHoroscopeHour:I,centerPalaceAlign:e.centerPalaceAlign,...P}))},S=({name:e,options:t,value:a,onChange:r})=>{const o=(0,n.useRef)(null),s=(0,n.useRef)(null);(0,n.useEffect)(()=>{if(!o.current)return;const e=o.current.querySelector(".segmented-control-input:checked");if(!e)return;const t=e.nextElementSibling;if(!t||!s.current)return;const a=()=>{if(!o.current)return;const e=t.getBoundingClientRect(),a=o.current.getBoundingClientRect();s.current.style.width=`${e.width}px`,s.current.style.left=e.left-a.left+"px",s.current.style.opacity="1"};a();const n=requestAnimationFrame(a),r=new ResizeObserver(()=>{a()});return r.observe(o.current),()=>{cancelAnimationFrame(n),r.disconnect()}},[a,t]);const l=e=>t=>{t.preventDefault(),t.stopPropagation(),r(e)};return n.createElement("div",{className:"segmented-control",ref:o,onTouchStart:e=>{e.touches.length>1&&e.preventDefault(),e.stopPropagation();const t=e.touches[0];e.currentTarget.dataset.touchStartX=t.clientX.toString(),e.currentTarget.dataset.touchStartY=t.clientY.toString()},onTouchMove:e=>{e.touches.length>1&&e.preventDefault();const t=parseFloat(e.currentTarget.dataset.touchStartX||"0"),a=parseFloat(e.currentTarget.dataset.touchStartY||"0"),n=e.touches[0],r=Math.abs(n.clientX-t),o=Math.abs(n.clientY-a);(r>5||o>5)&&e.preventDefault(),e.stopPropagation()},onTouchEnd:e=>{e.stopPropagation(),delete e.currentTarget.dataset.touchStartX,delete e.currentTarget.dataset.touchStartY}},n.createElement("div",{className:"segmented-control-slider",ref:s}),t.map(t=>n.createElement("label",{key:t.value,className:"segmented-control-label"},n.createElement("input",{type:"radio",name:e,value:t.value,checked:a===t.value,onChange:()=>r(t.value),className:"segmented-control-input"}),n.createElement("span",{className:"segmented-control-button",onClick:l(t.value),onTouchEnd:l(t.value)},t.label))))};var w=a(206);const f=(0,n.lazy)(()=>a.e(617).then(a.bind(a,6617)).then(e=>({default:e.AIChat}))),C=(0,n.lazy)(()=>a.e(34).then(a.bind(a,9034))),N=(0,n.lazy)(()=>a.e(974).then(a.bind(a,1974))),T=({chartMode:e,formData:t,synastryData:a,astrolabe:r,astrolabe1:o,astrolabe2:s,onShowInputPanel:l})=>{const[i,c]=(0,n.useState)("ai"),{createSession:m,sessions:d,activeSessionId:u,switchSession:h,model:y,setModel:p}=(0,w.o)(),g=(0,n.useRef)(!0);(0,n.useEffect)(()=>{if(g.current)return g.current=!1,void(0===d.length&&m());m(),c("ai")},[t,a]);return n.createElement("div",{className:"result-section"},n.createElement("div",{className:"tab-navigation"},n.createElement("div",{className:"tab-navigation-spacer"}),n.createElement("div",{className:"tab-navigation-center"},n.createElement(S,{name:"activeTab",options:[{label:"星盘",value:"astrolabe"},{label:"AI 解读",value:"ai"},{label:"历史",value:"history"}],value:i,onChange:e=>c(e)})),n.createElement("div",{className:"tab-navigation-actions"},n.createElement("button",{onClick:()=>{m(),c("ai")},className:"new-chat-button","aria-label":"新建记录"},n.createElement("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n.createElement("path",{d:"M14.5 2H6C4.89543 2 4 2.89543 4 4V20C4 21.1046 4.89543 22 6 22H18C19.1046 22 20 21.1046 20 20V7.5L14.5 2Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),n.createElement("path",{d:"M14 2V8H20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),n.createElement("path",{d:"M12 18V12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),n.createElement("path",{d:"M9 15H15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))),n.createElement(n.Suspense,{fallback:null},n.createElement(C,null)))),n.createElement("div",{className:"tab-content"},"astrolabe"===i&&n.createElement("div",{className:"astrolabe-content"},n.createElement("div",{className:"astrolabe-container"},"single"===e?n.createElement(b,{birthday:`${t.year}-${String(t.month).padStart(2,"0")}-${String(t.day).padStart(2,"0")}`,birthTime:t.birthTime,birthdayType:t.birthdayType,gender:t.gender}):n.createElement("div",{className:"synastry-container"},n.createElement("div",{className:"synastry-person"},n.createElement("h3",null,a.person1.name||"第一个人"),n.createElement(b,{birthday:`${a.person1.year}-${String(a.person1.month).padStart(2,"0")}-${String(a.person1.day).padStart(2,"0")}`,birthTime:a.person1.birthTime,birthdayType:a.person1.birthdayType,gender:a.person1.gender})),n.createElement("div",{className:"synastry-person"},n.createElement("h3",null,a.person2.name||"第二个人"),n.createElement(b,{birthday:`${a.person2.year}-${String(a.person2.month).padStart(2,"0")}-${String(a.person2.day).padStart(2,"0")}`,birthTime:a.person2.birthTime,birthdayType:a.person2.birthdayType,gender:a.person2.gender}))),n.createElement("div",{className:"rechart-button-container"},n.createElement("button",{onClick:l,className:"rechart-button"},"single"===e?"重新排盘":"重新合盘")))),n.createElement("div",{className:"ai-content "+("ai"===i?"visible":"hidden")},n.createElement(n.Suspense,{fallback:n.createElement("div",{className:"loading-indicator"},"加载AI聊天功能中...")},n.createElement(f,{formData:"single"===e?t:a.person1,astrolabe:"single"===e?r:o,synastryAstrolabe:"synastry"===e?s:void 0,isSynastryMode:"synastry"===e,personNames:{person1:a.person1.name||"第一个人",person2:a.person2.name||"第二个人"},synastryData:"synastry"===e?a:void 0,isVisible:"ai"===i&&!!u}))),"history"===i&&n.createElement(n.Suspense,{fallback:n.createElement("div",{className:"loading-indicator"},"加载历史记录中...")},n.createElement(N,{onSelectSession:()=>c("ai")}))))},k=e=>n.createElement(w.S,null,n.createElement(T,{...e}));class H{static initialize(){}static isAuth(){return"true"===localStorage.getItem(this.CLOUD_ENABLED_KEY)}static async authenticate(e){try{return e===this.CLOUD_PASSWORD?(localStorage.setItem(this.CLOUD_ENABLED_KEY,"true"),!0):(localStorage.removeItem(this.CLOUD_ENABLED_KEY),!1)}catch(e){return!1}}static clearAuthentication(){localStorage.removeItem(this.CLOUD_ENABLED_KEY)}static async uploadHistoryItem(e){if(!this.isAuth())throw new Error("未认证，请先输入密码");try{const t=await fetch(`${this.WORKER_URL}/api/history/item`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.CLOUD_PASSWORD}`},body:JSON.stringify({item:e})});if(!t.ok)throw new Error(`上传失败: ${t.status} ${t.statusText}`);return(await t.json()).success}catch(e){throw e}}static async downloadHistoryItem(e){if(!this.isAuth())throw new Error("未认证，请先输入密码");try{const t=await fetch(`${this.WORKER_URL}/api/history/item/${e}`,{method:"GET",headers:{Authorization:`Bearer ${this.CLOUD_PASSWORD}`}});if(!t.ok)throw new Error(`下载失败: ${t.status} ${t.statusText}`);return(await t.json()).item}catch(e){throw e}}static async deleteHistoryItem(e){if(!this.isAuth())throw new Error("未认证，请先输入密码");try{const t=await fetch(`${this.WORKER_URL}/api/history/item/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${this.CLOUD_PASSWORD}`}});if(!t.ok)throw new Error(`删除失败: ${t.status} ${t.statusText}`);return(await t.json()).success}catch(e){throw e}}static async getHistoryIds(){if(!this.isAuth())throw new Error("未认证，请先输入密码");try{const e=await fetch(`${this.WORKER_URL}/api/history/ids`,{method:"GET",headers:{Authorization:`Bearer ${this.CLOUD_PASSWORD}`}});if(!e.ok)throw new Error(`获取ID列表失败: ${e.status} ${e.statusText}`);return(await e.json()).ids||[]}catch(e){throw e}}static async batchDownloadHistoryItems(e){if(!this.isAuth())throw new Error("未认证，请先输入密码");try{const t=await fetch(`${this.WORKER_URL}/api/history/batch`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.CLOUD_PASSWORD}`},body:JSON.stringify({ids:e})});if(!t.ok)throw new Error(`批量下载失败: ${t.status} ${t.statusText}`);return(await t.json()).items||[]}catch(e){throw e}}static async clearAllHistory(){if(!this.isAuth())throw new Error("未认证，请先输入密码");try{const e=await fetch(`${this.WORKER_URL}/api/history/clear`,{method:"DELETE",headers:{Authorization:`Bearer ${this.CLOUD_PASSWORD}`}});if(!e.ok)throw new Error(`清空失败: ${e.status} ${e.statusText}`);return(await e.json()).success}catch(e){throw e}}static async isOnline(){try{await fetch(`${this.WORKER_URL}/api/health`,{method:"GET",mode:"no-cors",cache:"no-cache"});return!0}catch{return!1}}}H.WORKER_URL="https://ziwei.sydf.cc",H.CLOUD_PASSWORD="ovo",H.CLOUD_ENABLED_KEY="iztro_cloud_enabled";class x{static initialize(){H.initialize(),this.isCloudEnabled=H.isAuth()}static async enableCloudStorage(e){try{return!!await H.authenticate(e)&&(this.isCloudEnabled=!0,!0)}catch(e){return!1}}static isCloudStorageEnabled(){return this.isCloudEnabled=H.isAuth(),this.isCloudEnabled}static disableCloudStorage(){this.isCloudEnabled=!1,H.clearAuthentication()}static async loadHistoryFromCloud(){if(this.isCloudStorageEnabled())try{const e=await H.getHistoryIds();if(0===e.length)return;const t=await H.batchDownloadHistoryItems(e);t.forEach((e,t)=>{});const a=this.getHistory(),n=this.mergeHistories(a,t);n.length>50&&n.splice(50),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n))}catch(e){}}static async saveHistoryToCloud(){if(this.isCloudEnabled)try{const e=this.getHistory();for(const t of e)await H.uploadHistoryItem(t)}catch(e){}}static mergeHistories(e,t){const a=new Map;t.forEach(e=>{a.set(e.id,e)}),e.forEach(e=>{const t=a.get(e.id);t?e.timestamp>t.timestamp&&a.set(e.id,e):a.set(e.id,e)});return Array.from(a.values()).sort((e,t)=>t.timestamp-e.timestamp)}static async saveHistory(e){try{const t=this.getHistory(),a={...e,id:this.generateId(),timestamp:Date.now()};t.unshift(a),t.length>50&&t.splice(50),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t)),this.isCloudStorageEnabled()&&await H.uploadHistoryItem(a)}catch(e){}}static getHistory(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):[]}catch(e){return[]}}static async getHistoryWithCloudSync(){this.isCloudStorageEnabled()&&await this.loadHistoryFromCloud();return this.getHistory()}static async updateHistory(e,t){try{const a=this.getHistory(),n=a.findIndex(t=>t.id===e);if(-1===n)return;a[n]={...t,id:e,timestamp:a[n].timestamp},localStorage.setItem(this.STORAGE_KEY,JSON.stringify(a)),this.isCloudStorageEnabled()&&(await H.deleteHistoryItem(e),await H.uploadHistoryItem(a[n]))}catch(e){}}static async deleteHistory(e){try{const t=this.getHistory().filter(t=>t.id!==e);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t)),this.isCloudStorageEnabled()&&await H.deleteHistoryItem(e)}catch(e){}}static async clearHistory(){try{localStorage.removeItem(this.STORAGE_KEY),this.isCloudStorageEnabled()&&await H.clearAllHistory()}catch(e){}}static generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}static formatDate(e){const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`}}x.STORAGE_KEY="iztro_history",x.isCloudEnabled=!1;const D=({chartMode:e,setChartMode:t,formData:a,synastryData:r,onFormChange:o,onSynastryChange:s,onRadioChange:l,onSynastryRadioChange:i,onSubmit:c,onSynastrySubmit:m,onShowHistory:d})=>{const u=e=>{const{name:t,value:n}=e.target;o({...a,[t]:"birthTime"===t?parseInt(n):n})},h=(e,t)=>{const{name:a,value:n}=t.target;s(e,{...r[e],[a]:"birthTime"===a?parseInt(n):n})};return n.createElement("div",{className:"form-section"},n.createElement("div",{className:"form-group form-group-segmented"},n.createElement(S,{name:"chartMode",options:[{label:"排盘",value:"single"},{label:"合盘",value:"synastry"}],value:e,onChange:e=>t(e)})),"single"===e&&n.createElement("form",{onSubmit:c},n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"name"},"姓名（可选）"),n.createElement("input",{type:"text",id:"name",name:"name",value:a.name,onChange:u})),n.createElement("div",{className:"form-group-inline form-group-inline-mobile gender-date"},n.createElement("div",{className:"form-group"},n.createElement("label",null,"性别"),n.createElement(S,{name:"gender",options:[{label:"男",value:"male"},{label:"女",value:"female"}],value:a.gender,onChange:e=>l("gender",e)})),n.createElement("div",{className:"form-group"},n.createElement("label",null,"日期类型"),n.createElement(S,{name:"birthdayType",options:[{label:"阳历",value:"solar"},{label:"农历",value:"lunar"}],value:a.birthdayType,onChange:e=>l("birthdayType",e)}))),n.createElement("div",{className:"form-group-inline form-group-inline-mobile date-fields"},n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"year"},"年"),n.createElement("input",{type:"number",id:"year",name:"year",value:a.year,onChange:u,min:"1900",max:"2100"})),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"month"},"月"),n.createElement("input",{type:"number",id:"month",name:"month",value:a.month,onChange:u,min:"1",max:"12"})),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"day"},"日"),n.createElement("input",{type:"number",id:"day",name:"day",value:a.day,onChange:u,min:"1",max:"31"}))),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"birthTime"},"出生时辰"),n.createElement("select",{id:"birthTime",name:"birthTime",value:a.birthTime,onChange:u},n.createElement("option",{value:0},"早子时(00:00~01:00)"),n.createElement("option",{value:1},"丑时(01:00~03:00)"),n.createElement("option",{value:2},"寅时(03:00~05:00)"),n.createElement("option",{value:3},"卯时(05:00~07:00)"),n.createElement("option",{value:4},"辰时(07:00~09:00)"),n.createElement("option",{value:5},"巳时(09:00~11:00)"),n.createElement("option",{value:6},"午时(11:00~13:00)"),n.createElement("option",{value:7},"未时(13:00~15:00)"),n.createElement("option",{value:8},"申时(15:00~17:00)"),n.createElement("option",{value:9},"酉时(17:00~19:00)"),n.createElement("option",{value:10},"戌时(19:00~21:00)"),n.createElement("option",{value:11},"亥时(21:00~23:00)"),n.createElement("option",{value:12},"晚子时(23:00~00:00)"))),n.createElement("button",{type:"submit"},"开始排盘"),n.createElement("button",{type:"button",className:"history-button",onClick:d},"历史记录")),"synastry"===e&&n.createElement("form",{onSubmit:m},n.createElement("div",{className:"form-group"},n.createElement("h3",null,"第一个人")),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"person1-name"},"姓名（可选）"),n.createElement("input",{type:"text",id:"person1-name",name:"name",value:r.person1.name,onChange:e=>h("person1",e)})),n.createElement("div",{className:"form-group-inline form-group-inline-mobile gender-date"},n.createElement("div",{className:"form-group"},n.createElement("label",null,"性别"),n.createElement(S,{name:"person1-gender",options:[{label:"男",value:"male"},{label:"女",value:"female"}],value:r.person1.gender,onChange:e=>i("person1","gender",e)})),n.createElement("div",{className:"form-group"},n.createElement("label",null,"日期类型"),n.createElement(S,{name:"person1-birthdayType",options:[{label:"阳历",value:"solar"},{label:"农历",value:"lunar"}],value:r.person1.birthdayType,onChange:e=>i("person1","birthdayType",e)}))),n.createElement("div",{className:"form-group-inline form-group-inline-mobile date-fields"},n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"person1-year"},"年"),n.createElement("input",{type:"number",id:"person1-year",name:"year",value:r.person1.year,onChange:e=>h("person1",e),min:"1900",max:"2100"})),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"person1-month"},"月"),n.createElement("input",{type:"number",id:"person1-month",name:"month",value:r.person1.month,onChange:e=>h("person1",e),min:"1",max:"12"})),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"person1-day"},"日"),n.createElement("input",{type:"number",id:"person1-day",name:"day",value:r.person1.day,onChange:e=>h("person1",e),min:"1",max:"31"}))),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"person1-birthTime"},"出生时辰"),n.createElement("select",{id:"person1-birthTime",name:"birthTime",value:r.person1.birthTime,onChange:e=>h("person1",e)},n.createElement("option",{value:0},"早子时(00:00~01:00)"),n.createElement("option",{value:1},"丑时(01:00~03:00)"),n.createElement("option",{value:2},"寅时(03:00~05:00)"),n.createElement("option",{value:3},"卯时(05:00~07:00)"),n.createElement("option",{value:4},"辰时(07:00~09:00)"),n.createElement("option",{value:5},"巳时(09:00~11:00)"),n.createElement("option",{value:6},"午时(11:00~13:00)"),n.createElement("option",{value:7},"未时(13:00~15:00)"),n.createElement("option",{value:8},"申时(15:00~17:00)"),n.createElement("option",{value:9},"酉时(17:00~19:00)"),n.createElement("option",{value:10},"戌时(19:00~21:00)"),n.createElement("option",{value:11},"亥时(21:00~23:00)"),n.createElement("option",{value:12},"晚子时(23:00~00:00)"))),n.createElement("div",{className:"form-group"},n.createElement("h3",null,"第二个人")),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"person2-name"},"姓名（可选）"),n.createElement("input",{type:"text",id:"person2-name",name:"name",value:r.person2.name,onChange:e=>h("person2",e)})),n.createElement("div",{className:"form-group-inline form-group-inline-mobile gender-date"},n.createElement("div",{className:"form-group"},n.createElement("label",null,"性别"),n.createElement(S,{name:"person2-gender",options:[{label:"男",value:"male"},{label:"女",value:"female"}],value:r.person2.gender,onChange:e=>i("person2","gender",e)})),n.createElement("div",{className:"form-group"},n.createElement("label",null,"日期类型"),n.createElement(S,{name:"person2-birthdayType",options:[{label:"阳历",value:"solar"},{label:"农历",value:"lunar"}],value:r.person2.birthdayType,onChange:e=>i("person2","birthdayType",e)}))),n.createElement("div",{className:"form-group-inline form-group-inline-mobile date-fields"},n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"person2-year"},"年"),n.createElement("input",{type:"number",id:"person2-year",name:"year",value:r.person2.year,onChange:e=>h("person2",e),min:"1900",max:"2100"})),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"person2-month"},"月"),n.createElement("input",{type:"number",id:"person2-month",name:"month",value:r.person2.month,onChange:e=>h("person2",e),min:"1",max:"12"})),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"person2-day"},"日"),n.createElement("input",{type:"number",id:"person2-day",name:"day",value:r.person2.day,onChange:e=>h("person2",e),min:"1",max:"31"}))),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"person2-birthTime"},"出生时辰"),n.createElement("select",{id:"person2-birthTime",name:"birthTime",value:r.person2.birthTime,onChange:e=>h("person2",e)},n.createElement("option",{value:0},"早子时(00:00~01:00)"),n.createElement("option",{value:1},"丑时(01:00~03:00)"),n.createElement("option",{value:2},"寅时(03:00~05:00)"),n.createElement("option",{value:3},"卯时(05:00~07:00)"),n.createElement("option",{value:4},"辰时(07:00~09:00)"),n.createElement("option",{value:5},"巳时(09:00~11:00)"),n.createElement("option",{value:6},"午时(11:00~13:00)"),n.createElement("option",{value:7},"未时(13:00~15:00)"),n.createElement("option",{value:8},"申时(15:00~17:00)"),n.createElement("option",{value:9},"酉时(17:00~19:00)"),n.createElement("option",{value:10},"戌时(19:00~21:00)"),n.createElement("option",{value:11},"亥时(21:00~23:00)"),n.createElement("option",{value:12},"晚子时(23:00~00:00)"))),n.createElement("button",{type:"submit"},"开始合盘"),n.createElement("button",{type:"button",className:"history-button",onClick:d},"历史记录")))},I=n.memo(({chartMode:e,setChartMode:t,formData:a,synastryData:r,onFormChange:o,onSynastryChange:s,onRadioChange:l,onSynastryRadioChange:i,onShowHistory:c,onSubmit:m,onSynastrySubmit:d,onSaveHistory:u,updateUrlParams:h,setShowAstrolabe:y,setShowInputPanel:p})=>{const g=(0,n.useCallback)(e=>{e.preventDefault(),a.year&&a.month&&a.day?(a.name.trim()&&u({...a,type:"single"}),h(a),y(!0),p(!1)):alert("请填写完整的日期信息（年、月、日）")},[a,u,h,y,p]),E=(0,n.useCallback)(e=>{e.preventDefault(),r.person1.year&&r.person1.month&&r.person1.day?r.person2.year&&r.person2.month&&r.person2.day?((r.person1.name.trim()||r.person2.name.trim())&&u({...r.person1,type:"synastry",person2:r.person2}),y(!0),p(!1)):alert("请填写第二个人的完整日期信息（年、月、日）"):alert("请填写第一个人的完整日期信息（年、月、日）")},[r,u,y,p]);return n.createElement(D,{chartMode:e,setChartMode:t,formData:a,synastryData:r,onFormChange:o,onSynastryChange:s,onRadioChange:l,onSynastryRadioChange:i,onShowHistory:c,onSubmit:g,onSynastrySubmit:E})}),L=n.memo(({history:e,showHistoryModal:t,setShowHistoryModal:a,searchTerm:r,setSearchTerm:o,showPasswordInput:s,setShowPasswordInput:l,password:i,setPassword:c,isCloudStorageEnabled:m,isLoading:d,editingHistoryId:u,setEditingHistoryId:h,handlePasswordSubmit:y,handleDeleteHistory:p,handleClearHistory:g,onLoadHistory:E,onEditHistory:v,chartMode:b})=>{const S=(0,n.useCallback)(e=>{"Enter"===e.key&&y()},[y]);return t?n.createElement("div",{className:"history-modal-overlay",onClick:()=>a(!1)},n.createElement("div",{className:"history-modal",onClick:e=>e.stopPropagation()},n.createElement("div",{className:"history-modal-header"},n.createElement("h2",{className:"history-title",title:m?"云存储已启用":"点击输入密码启用云存储",onClick:()=>!m&&l(!s)},"历史记录 ",m&&"☁️")),s&&n.createElement("div",{className:"history-password-container"},n.createElement("input",{type:"password",className:"history-password-input",placeholder:"输入云存储密码",value:i,onChange:e=>c(e.target.value),onKeyDown:S,disabled:d}),n.createElement("button",{className:"history-password-button",onClick:y,disabled:d||!i.trim()},d?"验证中...":"确认")),n.createElement("div",{className:"history-search-container"},n.createElement("input",{type:"text",className:"history-search-input",placeholder:"搜索历史记录...",value:r,onChange:e=>o(e.target.value)})),n.createElement("div",{className:"history-modal-content"},0===e.length?n.createElement("div",{className:"history-empty"},"暂无历史记录"):n.createElement("div",{className:"history-list"},e.filter(e=>e.type===b).map(e=>n.createElement("div",{key:e.id,className:"history-item"},n.createElement("div",{className:"history-item-content",onClick:()=>{E(e),a(!1)}},n.createElement("div",{className:"history-item-main"},n.createElement("span",{className:"history-item-name"},"single"===e.type?e.name:`${e.name} 和 ${e.person2?.name||"第二个人"}`),n.createElement("span",{className:"history-item-info"},e.year,"-",e.month,"-",e.day)),n.createElement("div",{className:"history-item-actions"},n.createElement("button",{className:"history-action-button history-edit-icon",onClick:t=>{t.stopPropagation(),v(e),h(e.id),a(!1)},title:"编辑"},n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},n.createElement("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),n.createElement("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"}))),n.createElement("button",{className:"history-action-button history-delete-icon",onClick:t=>{t.stopPropagation(),confirm("确定要删除这条历史记录吗？")&&p(e.id)},title:"删除"},n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},n.createElement("polyline",{points:"3 6 5 6 21 6"}),n.createElement("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),n.createElement("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),n.createElement("line",{x1:"14",y1:"11",x2:"14",y2:"17"}))))))))),n.createElement("div",{className:"history-modal-footer"},n.createElement("button",{className:"history-clear-button",onClick:g,disabled:m,title:m?"云存储已启用，无法清空历史记录":"清空所有历史记录"},"清空历史记录")))):null});const z=n.memo(function(){const[e,t]=(0,n.useState)("single"),[a,r]=(0,n.useState)({name:"",year:"",month:"",day:"",birthTime:0,birthdayType:"solar",gender:"male"}),[l,i]=(0,n.useState)({person1:{name:"",year:"",month:"",day:"",birthTime:0,birthdayType:"solar",gender:"male"},person2:{name:"",year:"",month:"",day:"",birthTime:0,birthdayType:"solar",gender:"female"}}),[c,m]=(0,n.useState)(!1),[d,u]=(0,n.useState)(!0),{history:h,showHistoryModal:y,setShowHistoryModal:p,searchTerm:g,setSearchTerm:E,showPasswordInput:v,setShowPasswordInput:b,password:S,setPassword:f,isCloudStorageEnabled:C,isLoading:N,editingHistoryId:T,setEditingHistoryId:H,handlePasswordSubmit:D,handleSaveHistory:z,handleDeleteHistory:M,handleClearHistory:$}=(()=>{const[e,t]=(0,n.useState)([]),[a,r]=(0,n.useState)(!1),[o,s]=(0,n.useState)(""),[l,i]=(0,n.useState)(!1),[c,m]=(0,n.useState)(""),[d,u]=(0,n.useState)(!1),[h,y]=(0,n.useState)(!1),[p,g]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{x.initialize();const e=await x.getHistoryWithCloudSync();t(e),u(x.isCloudStorageEnabled())})()},[]);const E=(0,n.useCallback)(async()=>{if(c.trim()){y(!0);try{if(await x.enableCloudStorage(c)){u(!0),i(!1),m("");const e=await x.getHistoryWithCloudSync();t(e)}else alert("密码错误，请重试")}catch(e){alert("启用云存储失败，请稍后再试")}finally{y(!1)}}},[c]),v=(0,n.useCallback)(async e=>{p?(await x.updateHistory(p,e),g(null)):await x.saveHistory(e),t(x.getHistory())},[p]),b=(0,n.useCallback)(async e=>{await x.deleteHistory(e),t(x.getHistory())},[]),S=(0,n.useCallback)(async()=>{d?alert("云存储已启用，无法清空历史记录"):confirm("确定要清空所有历史记录吗？")&&(await x.clearHistory(),t([]))},[d]);return{history:e.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||"synastry"===e.type&&e.person2?.name.toLowerCase().includes(o.toLowerCase())||`${e.year}-${e.month}-${e.day}`.includes(o)),showHistoryModal:a,setShowHistoryModal:r,searchTerm:o,setSearchTerm:s,showPasswordInput:l,setShowPasswordInput:i,password:c,setPassword:m,isCloudStorageEnabled:d,isLoading:h,editingHistoryId:p,setEditingHistoryId:g,handlePasswordSubmit:E,handleSaveHistory:v,handleDeleteHistory:b,handleClearHistory:S}})(),{astrolabe:A}=(0,o.S)({birthday:`${a.year}-${String(a.month).padStart(2,"0")}-${String(a.day).padStart(2,"0")}`,birthTime:a.birthTime,gender:a.gender,birthdayType:a.birthdayType}),{astrolabe:P}=(0,o.S)({birthday:`${l.person1.year}-${String(l.person1.month).padStart(2,"0")}-${String(l.person1.day).padStart(2,"0")}`,birthTime:l.person1.birthTime,gender:l.person1.gender,birthdayType:l.person1.birthdayType}),{astrolabe:O}=(0,o.S)({birthday:`${l.person2.year}-${String(l.person2.month).padStart(2,"0")}-${String(l.person2.day).padStart(2,"0")}`,birthTime:l.person2.birthTime,gender:l.person2.gender,birthdayType:l.person2.birthdayType});(0,n.useEffect)(()=>{const e=new URLSearchParams(window.location.search),t=e.get("n")||"",a=e.get("y")||"",n=e.get("m")||"",o=e.get("d")||"",s=e.get("t")?parseInt(e.get("t")||"1"):0,l=e.get("type")||"solar",i=e.get("g")||"male",c=!!(e.get("y")&&e.get("m")&&e.get("d"));r({name:t,year:a,month:n,day:o,birthTime:s,birthdayType:l,gender:i}),c?(m(!0),u(!1)):(m(!1),u(!0))},[]),(0,n.useEffect)(()=>{const e=e=>{const t=e?"#1B1B1B":"#ffffff";let a=document.querySelector("meta[name=theme-color]");a?a.setAttribute("content",t):(a=document.createElement("meta"),a.setAttribute("name","theme-color"),a.setAttribute("content",t),document.getElementsByTagName("head")[0].appendChild(a))},t=window.matchMedia("(prefers-color-scheme: dark)");e(t.matches);const a=t=>{e(t.matches)};return t.addEventListener("change",a),()=>{t.removeEventListener("change",a)}},[]);const R=(0,n.useCallback)(e=>{try{const t=new URLSearchParams;e.name&&t.set("n",e.name),t.set("y",e.year),t.set("m",e.month),t.set("d",e.day),t.set("t",e.birthTime.toString()),t.set("type",e.birthdayType),t.set("g",e.gender);const a=`${window.location.pathname}?${t.toString()}`;window.history.replaceState({},"",a)}catch(e){}},[]),B=(0,n.useCallback)(e=>{"single"===e.type?(r({name:e.name,year:e.year,month:e.month,day:e.day,birthTime:e.birthTime,birthdayType:e.birthdayType,gender:e.gender}),t("single"),R({name:e.name,year:e.year,month:e.month,day:e.day,birthTime:e.birthTime,birthdayType:e.birthdayType,gender:e.gender}),m(!0),u(!1)):(i({person1:{name:e.name,year:e.year,month:e.month,day:e.day,birthTime:e.birthTime,birthdayType:e.birthdayType,gender:e.gender},person2:e.person2||{name:"",year:"",month:"",day:"",birthTime:0,birthdayType:"solar",gender:"female"}}),t("synastry"),m(!0),u(!1))},[R]),_=(0,n.useCallback)(e=>{"single"===e.type?(r({name:e.name,year:e.year,month:e.month,day:e.day,birthTime:e.birthTime,birthdayType:e.birthdayType,gender:e.gender}),t("single")):(i({person1:{name:e.name,year:e.year,month:e.month,day:e.day,birthTime:e.birthTime,birthdayType:e.birthdayType,gender:e.gender},person2:e.person2||{name:"",year:"",month:"",day:"",birthTime:0,birthdayType:"solar",gender:"female"}}),t("synastry"))},[]),F=(0,n.useCallback)(()=>{u(!0),m(!1),window.history.replaceState({},"",window.location.pathname),H(null)},[]);return n.createElement(s,null,n.createElement(w.S,null,n.createElement("div",{className:"content"},d&&n.createElement(I,{chartMode:e,setChartMode:t,formData:a,synastryData:l,onFormChange:r,onSynastryChange:(e,t)=>i({...l,[e]:t}),onRadioChange:(e,t)=>r({...a,[e]:t}),onSynastryRadioChange:(e,t,a)=>i({...l,[e]:{...l[e],[t]:a}}),onShowHistory:()=>p(!0),onSubmit:e=>e.preventDefault(),onSynastrySubmit:e=>e.preventDefault(),onSaveHistory:z,updateUrlParams:R,setShowAstrolabe:m,setShowInputPanel:u}),n.createElement(L,{history:h,showHistoryModal:y,setShowHistoryModal:p,searchTerm:g,setSearchTerm:E,showPasswordInput:v,setShowPasswordInput:b,password:S,setPassword:f,isCloudStorageEnabled:C,isLoading:N,editingHistoryId:T,setEditingHistoryId:H,handlePasswordSubmit:D,handleDeleteHistory:M,handleClearHistory:$,onLoadHistory:B,onEditHistory:_,chartMode:e}),c&&n.createElement(k,{chartMode:e,formData:a,synastryData:l,astrolabe:A,astrolabe1:P,astrolabe2:O,onShowInputPanel:F}))))});r.createRoot(document.getElementById("root")).render(n.createElement(n.StrictMode,null,n.createElement(z,null))),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(e=>{}).catch(e=>{})})}},e=>{e.O(0,[644,775,96],()=>{return t=9083,e(e.s=t);var t});e.O()}]);
//# sourceMappingURL=main.8cce11a512a0e97a8c6b.js.map